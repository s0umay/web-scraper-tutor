{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13612043", "self": "https://issues.apache.org/jira/rest/api/2/issue/13612043", "key": "ZOOKEEPER-4907", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12355230", "id": "12355230", "description": "", "name": "3.9.4", "archived": false, "released": true, "releaseDate": "2025-08-29"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fujian1115", "name": "fujian1115", "key": "fujian1115", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "fujian", "active": true, "timeZone": "Etc/UTC"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312382", "id": "12312382", "name": "server", "description": "General issues with the ZooKeeper server."}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fujian1115", "name": "fujian1115", "key": "fujian1115", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "fujian", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fujian1115", "name": "fujian1115", "key": "fujian1115", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "fujian", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 6000, "total": 6000, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 6000, "total": 6000, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4907/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 10, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/961993", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "jiafu1115 opened a new pull request, #2236:\nURL: https://github.com/apache/zookeeper/pull/2236\n\n   Refer to [ZOOKEEPER-4907](https://issues.apache.org/jira/browse/ZOOKEEPER-4907)\r\n   \r\n   We got the error:\r\n   \r\n   2024-11-07 19:03:01,414 [myid:14] - WARN [nioEventLoopGroup-7-25:NettyServerCnxn@537] - Closing connection to /135.224.186.250:47051\r\n   java.io.IOException: **Len error** 794913900\r\n   at org.apache.zookeeper.server.NettyServerCnxn.receiveMessage(NettyServerCnxn.java:521)\r\n   at org.apache.zookeeper.server.NettyServerCnxn.processMessage(NettyServerCnxn.java:374)\r\n   at org.apache.zookeeper.server.NettyServerCnxnFactory$CnxnChannelHandler.channelRead(NettyServerCnxnFactory.java:357)\r\n   at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n   at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n   at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead\r\n   \r\n   It cause us very confused about it whether we write some big data into zookeeper. Thus. After trouble shooting, we found that it is just the log/issue when closing the server caused by reelecting the leader sometimes. In actually. We don't send any big data.\r\n   \r\n   So I think we can do one tiny code change to avoid throw the error which causing confusion to reduce trouble shooting effort.\n\n\n", "created": "2025-03-17T10:09:25.954+0000", "updated": "2025-03-17T10:09:25.954+0000", "started": "2025-03-17T10:09:25.953+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961993", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/961994", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "jiafu1115 commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2728913907\n\n   the root cause for the error throw is cause by:\r\n   when closing the server. the follow code don't have chance to get executed.\r\n     bb = ByteBuffer.allocate(len); \r\n   so the remain message (body) will be taken as the head msg again and parsed again for the header. \r\n   the body length is not right now. sometimes it over the max size.\r\n   So I move the server status check before the length check.\n\n\n", "created": "2025-03-17T10:13:50.871+0000", "updated": "2025-03-17T10:13:50.871+0000", "started": "2025-03-17T10:13:50.870+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961994", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/962981", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2746005109\n\n   > The root cause for the error throw is caused by follow logic:\r\n   when closing the server. the follow code don't have chance to get executed:\r\n   bb = ByteBuffer.allocate(len); //line 552\r\n   so the remain message (body) will be taken as the head msg again and parsed again as the header.\r\n   then body length is not right now. sometimes it over the max size.\r\n   So I move the server status check before the length check.\r\n   \r\n   Seems that there are multiple incoming packets during server close. Since `processMessage` is called sequential in event loop thread, I would suggest to guard against `closingChannel` before decoding the packet inside `processMessage`. That is we should not even reading the packet.\n\n\n", "created": "2025-03-23T03:55:11.449+0000", "updated": "2025-03-23T03:55:11.449+0000", "started": "2025-03-23T03:55:11.448+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "962981", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963045", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "jiafu1115 commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2747282001\n\n   @kezhuw thanks for comment. I update the code according to your suggestion. You can help to double check. thanks\n\n\n", "created": "2025-03-24T08:28:04.762+0000", "updated": "2025-03-24T08:28:04.762+0000", "started": "2025-03-24T08:28:04.762+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963045", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963060", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "jiafu1115 commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2747493642\n\n   test fail? no relationshiop with this commit? \r\n   08:43:08  [ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 4.045 s <<< FAILURE! - in org.apache.zookeeper.server.admin.RestoreQuorumTest\r\n   08:43:08  [ERROR] testRestoreAfterQuorumLost  Time elapsed: 3.805 s  <<< ERROR!\r\n   08:43:08  java.net.ConnectException: Connection refused (Connection refused)\r\n   08:43:08  \tat java.net.PlainSocketImpl.socketConnect(Native Method)\r\n   08:43:08  \tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\r\n   08:43:08  \tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\r\n   08:43:08  \tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\r\n   08:43:08  \tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\r\n   08:43:08  \tat java.net.Socket.connect(Socket.java:607)\r\n   08:43:08  \tat java.net.Socket.connect(Socket.java:556)\r\n   08:43:08  \tat java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480)\r\n   08:43:08  \tat org.apache.zookeeper.server.admin.SnapshotAndRestoreCommandTest.takeSnapshotAndValidate(SnapshotAndRestoreCommandTest.java:413)\r\n   08:43:08  \tat org.apache.zookeeper.server.admin.RestoreQuorumTest.testRestoreAfterQuorumLost(RestoreQuorumTest.java:56)\n\n\n", "created": "2025-03-24T09:43:51.199+0000", "updated": "2025-03-24T09:43:51.199+0000", "started": "2025-03-24T09:43:51.199+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963060", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963175", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#discussion_r2010479529\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/NettyServerCnxn.java:\n##########\n@@ -366,7 +366,12 @@ private void appendToQueuedBuffer(ByteBuf buf) {\n     void processMessage(ByteBuf buf) {\n         checkIsInEventLoop(\"processMessage\");\n         LOG.debug(\"0x{} queuedBuffer: {}\", Long.toHexString(sessionId), queuedBuffer);\n-\n+        \n+        if (closingChannel) {\n+            LOG.info(\"Closing connection to {}\", getRemoteSocketAddress());\n+            return;\n+        }\n+        \n\nReview Comment:\n   ```suggestion\r\n   \r\n           if (closingChannel) {\r\n               LOG.debug(\"Drop incoming message during connection closing for session 0x{}\", Long.toHexString(sessionId));\r\n               return;\r\n           }\r\n   \r\n   ```\r\n   \r\n   I am not sure `getRemoteSocketAddress` is safe after channel closed. Also, postmortem log probably don't deserve `LOG.info`.\r\n   \r\n   Connection is closing, any postmortem\n\n\n\n", "created": "2025-03-24T16:03:14.543+0000", "updated": "2025-03-24T16:03:14.543+0000", "started": "2025-03-24T16:03:14.543+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963175", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963179", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#discussion_r2010479529\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/NettyServerCnxn.java:\n##########\n@@ -366,7 +366,12 @@ private void appendToQueuedBuffer(ByteBuf buf) {\n     void processMessage(ByteBuf buf) {\n         checkIsInEventLoop(\"processMessage\");\n         LOG.debug(\"0x{} queuedBuffer: {}\", Long.toHexString(sessionId), queuedBuffer);\n-\n+        \n+        if (closingChannel) {\n+            LOG.info(\"Closing connection to {}\", getRemoteSocketAddress());\n+            return;\n+        }\n+        \n\nReview Comment:\n   ```suggestion\r\n   \r\n           if (closingChannel) {\r\n               LOG.debug(\"Drop incoming message during connection closing for session 0x{}\", Long.toHexString(sessionId));\r\n               return;\r\n           }\r\n   \r\n   ```\r\n   \r\n   I am not sure `getRemoteSocketAddress` is safe after channel closed. Also, postmortem log probably don't deserve `LOG.info`.\n\n\n\n", "created": "2025-03-24T16:06:45.802+0000", "updated": "2025-03-24T16:06:45.802+0000", "started": "2025-03-24T16:06:45.802+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963179", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963322", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw merged PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236\n\n\n", "created": "2025-03-25T10:39:55.804+0000", "updated": "2025-03-25T10:39:55.804+0000", "started": "2025-03-25T10:39:55.803+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963322", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963323", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2750833641\n\n   @jiafu1115 Thank you for your contribution! Merged to master and backported to branch-3.9.\n\n\n", "created": "2025-03-25T10:42:31.118+0000", "updated": "2025-03-25T10:42:31.118+0000", "started": "2025-03-25T10:42:31.118+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963323", "issueId": "13612043"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/worklog/963668", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "jiafu1115 commented on PR #2236:\nURL: https://github.com/apache/zookeeper/pull/2236#issuecomment-2757762116\n\n   > @jiafu1115 Thank you for your contribution! Merged to master and backported to branch-3.9.\r\n   \r\n   Thanks ! It is my pleasure ! @kezhuw @tisonkun \n\n\n", "created": "2025-03-27T11:51:33.038+0000", "updated": "2025-03-27T11:51:33.038+0000", "started": "2025-03-27T11:51:33.037+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963668", "issueId": "13612043"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": 6000, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@73ee8f58[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@675e597b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@e2ab6a1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1baaa39e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17374683[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@55a87d00[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@e6c46aa[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@4094b2aa[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6dbaf765[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@7b6cd7af[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17d9977e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@72bd66cd[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 6000, "customfield_12312520": null, "customfield_12312521": "Tue Mar 25 10:40:38 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-03-25T10:40:38.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4907/watchers", "watchCount": 1, "isWatching": false}, "created": "2025-03-17T09:56:48.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-29T21:29:01.000+0000", "timeoriginalestimate": null, "description": "We got the error:\r\n \r\n{code:java}\r\n2024-11-07 19:03:01,414 [myid:14] - WARN [nioEventLoopGroup-7-25:NettyServerCnxn@537] - Closing connection to /135.224.186.250:47051\r\n\r\n\r\njava.io.IOException: Len error 794913900\r\nat org.apache.zookeeper.server.NettyServerCnxn.receiveMessage(NettyServerCnxn.java:521)\r\nat org.apache.zookeeper.server.NettyServerCnxn.processMessage(NettyServerCnxn.java:374)\r\nat org.apache.zookeeper.server.NettyServerCnxnFactory$CnxnChannelHandler.channelRead(NettyServerCnxnFactory.java:357)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead\r\n {code}\r\nIt cause us very confused about it : if we write some big data into zookeeper. Thus. we found, in actual. it is just the log/issue when closing the server when reelecting the leader sometime. We don't send any big data.\r\nSo I think we can do one tiny code change to avoid throw the error which causing confuse with big size's data to reduce trouble shooting effort.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "1h 40m", "remainingEstimateSeconds": 0, "timeSpentSeconds": 6000}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Shouldn't throw \"Len error\" when server closing cause confusion", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/comment/17936131", "id": "17936131", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fujian1115", "name": "fujian1115", "key": "fujian1115", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "fujian", "active": true, "timeZone": "Etc/UTC"}, "body": "[https://github.com/apache/zookeeper/pull/2236]\r\nattach the PR. ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=fujian1115", "name": "fujian1115", "key": "fujian1115", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "fujian", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-03-17T10:10:01.945+0000", "updated": "2025-03-17T10:10:01.945+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13612043/comment/17938173", "id": "17938173", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "Issue resolved by pull request 2236\n[https://github.com/apache/zookeeper/pull/2236]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-03-25T10:40:38.166+0000", "updated": "2025-03-25T10:40:38.166+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "customfield_12311820": "0|z1ut8g:", "customfield_12314139": null}}