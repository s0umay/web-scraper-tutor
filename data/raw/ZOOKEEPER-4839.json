{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13582975", "self": "https://issues.apache.org/jira/rest/api/2/issue/13582975", "key": "ZOOKEEPER-4839", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12354432", "id": "12354432", "description": "", "name": "3.9.3", "archived": false, "released": true, "releaseDate": "2024-10-24"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "1.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12349434", "id": "12349434", "name": "3.5.10", "archived": false, "released": true, "releaseDate": "2022-06-04"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353694", "id": "12353694", "description": "", "name": "3.9.2", "archived": false, "released": true, "releaseDate": "2024-03-12"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12329414", "id": "12329414", "name": "security"}, {"self": "https://issues.apache.org/jira/rest/api/2/component/12312382", "id": "12312382", "name": "server", "description": "General issues with the ZooKeeper server."}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wstcjmg", "name": "wstcjmg", "key": "JIRAUSER305844", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "wstcjmg", "active": true, "timeZone": "Asia/Shanghai"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wstcjmg", "name": "wstcjmg", "key": "JIRAUSER305844", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "wstcjmg", "active": true, "timeZone": "Asia/Shanghai"}, "aggregateprogress": {"progress": 16200, "total": 16200, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 16200, "total": 16200, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4839/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 27, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/925860", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2227632688\n\n   @maoling Can you take a look on this fix\n\n\n", "created": "2024-07-15T03:10:45.287+0000", "updated": "2024-07-15T03:10:45.287+0000", "started": "2024-07-15T03:10:45.287+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "925860", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/928838", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1704913717\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/auth/SaslServerCallbackHandler.java:\n##########\n@@ -90,6 +90,11 @@ private void handleNameCallback(NameCallback nc) {\n         // check to see if this user is in the user password database.\n         if (credentials.get(nc.getDefaultName()) == null) {\n             LOG.warn(\"User '{}' not found in list of DIGEST-MD5 authenticateable users.\", nc.getDefaultName());\n+            // ZOOKEEPER-4839\n+            // Incorrect usernames also need to be stored\n+            // in order to clear the usernames of previously\n+            // successfully logged-in users.\n+            userName = nc.getDefaultName();\n\nReview Comment:\n   I saw one `SaslServerCallbackHandler` was shared among multiple concurrent `ServerCnxn`s. I think we probably should resort to some form of copy/clone to not share mutable state among multiple `ServerCnxn`s.\r\n   \r\n   This applies to `SaslQuorumServerCallbackHandler` too.\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/server/auth/SaslServerCallbackHandlerTest.java:\n##########\n@@ -0,0 +1,43 @@\n+package org.apache.zookeeper.server.auth;\n+\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.security.auth.callback.Callback;\n+import javax.security.auth.callback.NameCallback;\n+import javax.security.auth.callback.PasswordCallback;\n+import javax.security.auth.callback.UnsupportedCallbackException;\n+import javax.security.auth.login.AppConfigurationEntry;\n+import javax.security.auth.login.AppConfigurationEntry.LoginModuleControlFlag;\n+import javax.security.auth.login.Configuration;\n+import org.junit.Test;\n+\n+public class SaslServerCallbackHandlerTest {\n+\n+    @Test\n+    public void wrongUserNameShouldClearUserCredential() throws IOException, UnsupportedCallbackException {\n+        Configuration configuration = mock(Configuration.class);\n+        Map<String, String> userCredentials = new HashMap<>();\n+        userCredentials.put(\"user_exist_user\", \"password\");\n+        AppConfigurationEntry appConfigurationEntry = new AppConfigurationEntry(\"test-module\", LoginModuleControlFlag.REQUIRED, userCredentials);\n+        when(configuration.getAppConfigurationEntry(\"Server\")).thenReturn(new AppConfigurationEntry[]{appConfigurationEntry});\n\nReview Comment:\n   It would be nice to avoid mock. I saw multiple \"Sasl*Test\". I think they might be helpful.\n\n\n\n", "created": "2024-08-06T05:18:49.533+0000", "updated": "2024-08-06T05:18:49.533+0000", "started": "2024-08-06T05:18:49.532+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "928838", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/929061", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1706551114\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/auth/SaslServerCallbackHandler.java:\n##########\n@@ -90,6 +90,11 @@ private void handleNameCallback(NameCallback nc) {\n         // check to see if this user is in the user password database.\n         if (credentials.get(nc.getDefaultName()) == null) {\n             LOG.warn(\"User '{}' not found in list of DIGEST-MD5 authenticateable users.\", nc.getDefaultName());\n+            // ZOOKEEPER-4839\n+            // Incorrect usernames also need to be stored\n+            // in order to clear the usernames of previously\n+            // successfully logged-in users.\n+            userName = nc.getDefaultName();\n\nReview Comment:\n   Thank you for your review. I have some ideas about your comments.\r\n   \r\n   1. It would be better for the `Login` to store a factory object that can supply `SaslServerCallbackHandler`, in order to avoid the `SaslServerCallbackHandler` being shared among multiple concurrent `ServerCnxn`s.\r\n   2. We should apply the change to the `SaslQuorumServerCallbackHandler`.\r\n   \r\n   Is it correct?\n\n\n\n", "created": "2024-08-07T07:52:50.868+0000", "updated": "2024-08-07T07:52:50.868+0000", "started": "2024-08-07T07:52:50.867+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "929061", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/929062", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1706552769\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/server/auth/SaslServerCallbackHandlerTest.java:\n##########\n@@ -0,0 +1,43 @@\n+package org.apache.zookeeper.server.auth;\n+\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.security.auth.callback.Callback;\n+import javax.security.auth.callback.NameCallback;\n+import javax.security.auth.callback.PasswordCallback;\n+import javax.security.auth.callback.UnsupportedCallbackException;\n+import javax.security.auth.login.AppConfigurationEntry;\n+import javax.security.auth.login.AppConfigurationEntry.LoginModuleControlFlag;\n+import javax.security.auth.login.Configuration;\n+import org.junit.Test;\n+\n+public class SaslServerCallbackHandlerTest {\n+\n+    @Test\n+    public void wrongUserNameShouldClearUserCredential() throws IOException, UnsupportedCallbackException {\n+        Configuration configuration = mock(Configuration.class);\n+        Map<String, String> userCredentials = new HashMap<>();\n+        userCredentials.put(\"user_exist_user\", \"password\");\n+        AppConfigurationEntry appConfigurationEntry = new AppConfigurationEntry(\"test-module\", LoginModuleControlFlag.REQUIRED, userCredentials);\n+        when(configuration.getAppConfigurationEntry(\"Server\")).thenReturn(new AppConfigurationEntry[]{appConfigurationEntry});\n\nReview Comment:\n   I'll give it a try.\n\n\n\n", "created": "2024-08-07T07:53:59.332+0000", "updated": "2024-08-07T07:53:59.332+0000", "started": "2024-08-07T07:53:59.332+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "929062", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/929079", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1706693861\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/auth/SaslServerCallbackHandler.java:\n##########\n@@ -90,6 +90,11 @@ private void handleNameCallback(NameCallback nc) {\n         // check to see if this user is in the user password database.\n         if (credentials.get(nc.getDefaultName()) == null) {\n             LOG.warn(\"User '{}' not found in list of DIGEST-MD5 authenticateable users.\", nc.getDefaultName());\n+            // ZOOKEEPER-4839\n+            // Incorrect usernames also need to be stored\n+            // in order to clear the usernames of previously\n+            // successfully logged-in users.\n+            userName = nc.getDefaultName();\n\nReview Comment:\n   Sounds viable to me.\n\n\n\n", "created": "2024-08-07T09:31:57.603+0000", "updated": "2024-08-07T09:31:57.603+0000", "started": "2024-08-07T09:31:57.602+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "929079", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/933286", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2330529339\n\n   Hi, @kezhuw \r\n   I push a new commit to resolve the CallbackHandler shared in multiple connections, can you give me some feed backs.\n\n\n", "created": "2024-09-05T03:35:20.848+0000", "updated": "2024-09-05T03:35:20.848+0000", "started": "2024-09-05T03:35:20.848+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "933286", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/933889", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1746588998\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -36,10 +42,14 @@\n import org.ietf.jgss.GSSName;\n import org.ietf.jgss.Oid;\n import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public final class SecurityUtils {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(SecurityUtils.class);\n+\n     public static final String QUORUM_HOSTNAME_PATTERN = \"_HOST\";\n+    private static final String USER_PREFIX = \"user_\";\n\nReview Comment:\n   How about `DIGEST_MD5_USER_PREFIX` ?\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -254,15 +264,67 @@ public SaslServer run() {\n         return null;\n     }\n \n+    /**\n+     * get specific section from configuration or thrown\n+     * an IOException when no section exists in configuration\n+     *\n+     * @param configuration Configuration instance\n+     * @param section section name\n+     * @return AppConfigurationEntry list\n+     */\n+    public static AppConfigurationEntry[] getAppConfigurationEntryWithSection(Configuration configuration, String section) throws IOException {\n+        AppConfigurationEntry[] configurationEntries = configuration.getAppConfigurationEntry(section);\n+        if (configurationEntries == null) {\n+            String errorMessage = \"Could not find a '\" + section + \"' entry in this configuration: Server cannot start.\";\n+            LOG.error(errorMessage);\n+            throw new IOException(errorMessage);\n+        }\n+        return configurationEntries;\n+    }\n+\n+\n+     /**\n+     * make server credentials map from configuration's server section.\n+     * @param configuration Configuration instance\n+     * @return Server credentials map\n+     */\n+    public static Map<String, String> getServerCredentials(Configuration configuration) throws IOException {\n\nReview Comment:\n   How about naming it \"getDigestMd5Credentials\" ?\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/SaslAuthRequiredMultiClientTest.java:\n##########\n@@ -0,0 +1,102 @@\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import javax.security.auth.login.Configuration;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.KeeperException;\n+import org.apache.zookeeper.ZooDefs.Ids;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+\n+public class SaslAuthRequiredMultiClientTest extends ClientBase {\n+\n+    @BeforeAll\n+    public static void setUpBeforeClass() {\n+        System.setProperty(SaslTestUtil.requireSASLAuthProperty, \"true\");\n+        System.setProperty(SaslTestUtil.authProviderProperty, SaslTestUtil.authProvider);\n+        System.setProperty(SaslTestUtil.jaasConfig, SaslTestUtil.createJAASConfigFile(\"jaas.conf\", \"test\"));\n+    }\n+\n+    @AfterAll\n+    public static void tearDownAfterClass() {\n+        System.clearProperty(SaslTestUtil.requireSASLAuthProperty);\n+        System.clearProperty(SaslTestUtil.authProviderProperty);\n+        System.clearProperty(SaslTestUtil.jaasConfig);\n+    }\n+\n+    @Test\n+    public void testClientOpWithInvalidSASLUserAuthAfterSuccessLogin() throws Exception {\n+        resetJaasConfiguration(\"jaas.conf\", \"super\", \"test\");\n+        ZooKeeper zk = null;\n+        CountdownWatcher watcher = new CountdownWatcher();\n+        try {\n+            zk = createClient(watcher);\n+            zk.create(\"/foobar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n+        } catch (KeeperException e) {\n+            fail(\"Client operation should succeed with valid SASL configuration.\");\n+        } finally {\n+            if (zk != null) {\n+                zk.close();\n+            }\n+        }\n\nReview Comment:\n   ```suggestion\r\n           try  (ZooKeeper zk = createClient()) {\r\n               zk.create(\"/foobar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\r\n           } catch (KeeperException e) {\r\n               fail(\"Client operation should succeed with valid SASL configuration.\");\r\n           }\r\n   ```\r\n   \r\n   Much of ZooKeeper codes are written in decade ago. I think we can avoid old style in new age.\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/SaslAuthRequiredMultiClientTest.java:\n##########\n@@ -0,0 +1,102 @@\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import javax.security.auth.login.Configuration;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.KeeperException;\n+import org.apache.zookeeper.ZooDefs.Ids;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+\n+public class SaslAuthRequiredMultiClientTest extends ClientBase {\n+\n+    @BeforeAll\n+    public static void setUpBeforeClass() {\n+        System.setProperty(SaslTestUtil.requireSASLAuthProperty, \"true\");\n+        System.setProperty(SaslTestUtil.authProviderProperty, SaslTestUtil.authProvider);\n+        System.setProperty(SaslTestUtil.jaasConfig, SaslTestUtil.createJAASConfigFile(\"jaas.conf\", \"test\"));\n+    }\n+\n+    @AfterAll\n+    public static void tearDownAfterClass() {\n+        System.clearProperty(SaslTestUtil.requireSASLAuthProperty);\n+        System.clearProperty(SaslTestUtil.authProviderProperty);\n+        System.clearProperty(SaslTestUtil.jaasConfig);\n+    }\n+\n+    @Test\n+    public void testClientOpWithInvalidSASLUserAuthAfterSuccessLogin() throws Exception {\n+        resetJaasConfiguration(\"jaas.conf\", \"super\", \"test\");\n+        ZooKeeper zk = null;\n+        CountdownWatcher watcher = new CountdownWatcher();\n+        try {\n+            zk = createClient(watcher);\n+            zk.create(\"/foobar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n+        } catch (KeeperException e) {\n+            fail(\"Client operation should succeed with valid SASL configuration.\");\n+        } finally {\n+            if (zk != null) {\n+                zk.close();\n+            }\n+        }\n+\n+        resetJaasConfiguration(\"jaas.conf\", \"super_wrong\", \"test\");\n+        ZooKeeper wrongUserZk = null;\n+        CountdownWatcher wrongUserZkWatch = new CountdownWatcher();\n+        try {\n+            wrongUserZk = createClient(wrongUserZkWatch);\n+            wrongUserZk.create(\"/bar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n+            fail(\"Client with wrong SASL config should not pass SASL authentication.\");\n+        } catch (KeeperException e) {\n+            assertTrue(e.code() == KeeperException.Code.AUTHFAILED);\n\nReview Comment:\n   ```suggestion\r\n               assertEquals(KeeperException.Code.AUTHFAILED, e.code());\r\n   ```\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/SaslAuthRequiredMultiClientTest.java:\n##########\n@@ -0,0 +1,102 @@\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import javax.security.auth.login.Configuration;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.KeeperException;\n+import org.apache.zookeeper.ZooDefs.Ids;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+\n+public class SaslAuthRequiredMultiClientTest extends ClientBase {\n+\n+    @BeforeAll\n+    public static void setUpBeforeClass() {\n+        System.setProperty(SaslTestUtil.requireSASLAuthProperty, \"true\");\n+        System.setProperty(SaslTestUtil.authProviderProperty, SaslTestUtil.authProvider);\n+        System.setProperty(SaslTestUtil.jaasConfig, SaslTestUtil.createJAASConfigFile(\"jaas.conf\", \"test\"));\n+    }\n+\n+    @AfterAll\n+    public static void tearDownAfterClass() {\n+        System.clearProperty(SaslTestUtil.requireSASLAuthProperty);\n+        System.clearProperty(SaslTestUtil.authProviderProperty);\n+        System.clearProperty(SaslTestUtil.jaasConfig);\n+    }\n+\n+    @Test\n+    public void testClientOpWithInvalidSASLUserAuthAfterSuccessLogin() throws Exception {\n+        resetJaasConfiguration(\"jaas.conf\", \"super\", \"test\");\n+        ZooKeeper zk = null;\n+        CountdownWatcher watcher = new CountdownWatcher();\n+        try {\n+            zk = createClient(watcher);\n+            zk.create(\"/foobar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n+        } catch (KeeperException e) {\n+            fail(\"Client operation should succeed with valid SASL configuration.\");\n+        } finally {\n+            if (zk != null) {\n+                zk.close();\n+            }\n+        }\n+\n+        resetJaasConfiguration(\"jaas.conf\", \"super_wrong\", \"test\");\n+        ZooKeeper wrongUserZk = null;\n+        CountdownWatcher wrongUserZkWatch = new CountdownWatcher();\n+        try {\n+            wrongUserZk = createClient(wrongUserZkWatch);\n+            wrongUserZk.create(\"/bar\", null, Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n+            fail(\"Client with wrong SASL config should not pass SASL authentication.\");\n+        } catch (KeeperException e) {\n+            assertTrue(e.code() == KeeperException.Code.AUTHFAILED);\n+            // Verify that \"eventually\" this client closes the connection between itself and the server.\n+            watcher.waitForDisconnected(SaslTestUtil.CLIENT_DISCONNECT_TIMEOUT);\n\nReview Comment:\n   I think we can eliminate this as it is covered by other tests.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -254,15 +264,67 @@ public SaslServer run() {\n         return null;\n     }\n \n+    /**\n+     * get specific section from configuration or thrown\n+     * an IOException when no section exists in configuration\n+     *\n+     * @param configuration Configuration instance\n+     * @param section section name\n+     * @return AppConfigurationEntry list\n+     */\n+    public static AppConfigurationEntry[] getAppConfigurationEntryWithSection(Configuration configuration, String section) throws IOException {\n+        AppConfigurationEntry[] configurationEntries = configuration.getAppConfigurationEntry(section);\n+        if (configurationEntries == null) {\n+            String errorMessage = \"Could not find a '\" + section + \"' entry in this configuration: Server cannot start.\";\n+            LOG.error(errorMessage);\n+            throw new IOException(errorMessage);\n+        }\n+        return configurationEntries;\n+    }\n+\n+\n+     /**\n+     * make server credentials map from configuration's server section.\n+     * @param configuration Configuration instance\n+     * @return Server credentials map\n+     */\n+    public static Map<String, String> getServerCredentials(Configuration configuration) throws IOException {\n+        AppConfigurationEntry[] serverAppConfigurationEntry = getServerAppConfigurationEntry(configuration);\n+        Map<String, String> credentials = new HashMap<>();\n+        for (AppConfigurationEntry entry : serverAppConfigurationEntry) {\n+            Map<String, ?> options = entry.getOptions();\n+            // Populate DIGEST-MD5 user -> password map with JAAS configuration entries from the \"Server\" section.\n\nReview Comment:\n   backlog: I suspect we should do similar to ZOOKEEPER-4753(https://github.com/apache/zookeeper/commit/e2070bed85d8b0c98a5a0045bf92421f473c412e#diff-04a0c58edb7731a3998fcaa021b8e2190d8c3947dfc87606bfe8f5a0e9423434R71) here, but this should be a separate issue.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -55,12 +65,12 @@ public final class SecurityUtils {\n      * @throws SaslException\n      */\n     public static SaslClient createSaslClient(\n-        final Subject subject,\n-        final String servicePrincipal,\n-        final String protocol,\n-        final String serverName,\n-        final Logger LOG,\n-        final String entity) throws SaslException {\n+            final Subject subject,\n+            final String servicePrincipal,\n+            final String protocol,\n+            final String serverName,\n+            final Logger LOG,\n+            final String entity) throws SaslException {\n\nReview Comment:\n   It is better to not reformat unrelated code. Same as other places.\n\n\n\n", "created": "2024-09-10T00:45:47.207+0000", "updated": "2024-09-10T00:45:47.207+0000", "started": "2024-09-10T00:45:47.207+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "933889", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934412", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2345427276\n\n   Hi, @kezhuw\n\n\n", "created": "2024-09-12T07:01:26.712+0000", "updated": "2024-09-12T07:01:26.712+0000", "started": "2024-09-12T07:01:26.711+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934412", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934415", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2345430926\n\n   @kezhuw, thanks for your review. I will take a look and push a new commit later.\n\n\n", "created": "2024-09-12T07:03:38.675+0000", "updated": "2024-09-12T07:03:38.675+0000", "started": "2024-09-12T07:03:38.674+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934415", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934678", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2348573923\n\n   Hi, @kezhuw. I push a new commit to improve the codes with your suggestions. Can you take a look.\n\n\n", "created": "2024-09-13T10:12:04.219+0000", "updated": "2024-09-13T10:12:04.219+0000", "started": "2024-09-13T10:12:04.219+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934678", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934679", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1758593177\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -254,15 +264,67 @@ public SaslServer run() {\n         return null;\n     }\n \n+    /**\n+     * get specific section from configuration or thrown\n+     * an IOException when no section exists in configuration\n+     *\n+     * @param configuration Configuration instance\n+     * @param section section name\n+     * @return AppConfigurationEntry list\n+     */\n+    public static AppConfigurationEntry[] getAppConfigurationEntryWithSection(Configuration configuration, String section) throws IOException {\n+        AppConfigurationEntry[] configurationEntries = configuration.getAppConfigurationEntry(section);\n+        if (configurationEntries == null) {\n+            String errorMessage = \"Could not find a '\" + section + \"' entry in this configuration: Server cannot start.\";\n+            LOG.error(errorMessage);\n+            throw new IOException(errorMessage);\n+        }\n+        return configurationEntries;\n+    }\n+\n+\n+     /**\n+     * make server credentials map from configuration's server section.\n+     * @param configuration Configuration instance\n+     * @return Server credentials map\n+     */\n+    public static Map<String, String> getServerCredentials(Configuration configuration) throws IOException {\n+        AppConfigurationEntry[] serverAppConfigurationEntry = getServerAppConfigurationEntry(configuration);\n+        Map<String, String> credentials = new HashMap<>();\n+        for (AppConfigurationEntry entry : serverAppConfigurationEntry) {\n+            Map<String, ?> options = entry.getOptions();\n+            // Populate DIGEST-MD5 user -> password map with JAAS configuration entries from the \"Server\" section.\n\nReview Comment:\n   I will make a new pull request to resolve it.\n\n\n\n", "created": "2024-09-13T10:13:12.144+0000", "updated": "2024-09-13T10:13:12.144+0000", "started": "2024-09-13T10:13:12.144+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934679", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934719", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#discussion_r1758876160\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/auth/SaslQuorumAuthLearner.java:\n##########\n@@ -62,9 +64,13 @@ public SaslQuorumAuthLearner(\n                     \"SASL-authentication failed because the specified JAAS configuration section '%s' could not be found.\",\n                     loginContext));\n             }\n+\n+            Supplier<CallbackHandler> callBackSupplier = () -> {\n+                return new SaslClientCallbackHandler(null, \"QuorumLearner\");\n+            };\n             this.learnerLogin = new Login(\n                 loginContext,\n-                new SaslClientCallbackHandler(null, \"QuorumLearner\"),\n+                callBackSupplier,\n\nReview Comment:\n   ```suggestion\r\n                   callbackSupplier,\r\n   ```\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/Login.java:\n##########\n@@ -48,7 +49,7 @@ public class Login {\n     private static final String KINIT_COMMAND_DEFAULT = \"/usr/bin/kinit\";\n     private static final Logger LOG = LoggerFactory.getLogger(Login.class);\n     public static final String SYSTEM_USER = System.getProperty(\"user.name\", \"<NA>\");\n-    public CallbackHandler callbackHandler;\n+    private Supplier<CallbackHandler> callbackHandlerSupplier;\n\nReview Comment:\n   ```suggestion\r\n       private final Supplier<CallbackHandler> callbackHandlerSupplier;\r\n   ```\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/util/SecurityUtils.java:\n##########\n@@ -36,10 +42,14 @@\n import org.ietf.jgss.GSSName;\n import org.ietf.jgss.Oid;\n import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public final class SecurityUtils {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(SecurityUtils.class);\n\nReview Comment:\n   How about follow the pattern of `createSaslClient`/`createSaslServer` to accept a log parameter ? This will allow callers to log in their contexts.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/auth/SaslQuorumAuthLearner.java:\n##########\n@@ -62,9 +64,13 @@ public SaslQuorumAuthLearner(\n                     \"SASL-authentication failed because the specified JAAS configuration section '%s' could not be found.\",\n                     loginContext));\n             }\n+\n+            Supplier<CallbackHandler> callBackSupplier = () -> {\n\nReview Comment:\n   ```suggestion\r\n               Supplier<CallbackHandler> callbackSupplier = () -> {\r\n   ```\n\n\n\n", "created": "2024-09-13T13:45:02.525+0000", "updated": "2024-09-13T13:45:02.525+0000", "started": "2024-09-13T13:45:02.525+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934719", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/934834", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2351004638\n\n   All commonts have been resolved, and fix some spelling and license check errors. Can you take a look? @kezhuw \n\n\n", "created": "2024-09-14T14:07:42.137+0000", "updated": "2024-09-14T14:07:42.137+0000", "started": "2024-09-14T14:07:42.136+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "934834", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935256", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2359836342\n\n   The cpp-unit-test failed and I find an issue maybe associate with the failure [4746](https://issues.apache.org/jira/projects/ZOOKEEPER/issues/ZOOKEEPER-4746?filter=allopenissues&orderby=created+DESC%2C+priority+DESC%2C+updated+DESC). Let me take a look on it.\n\n\n", "created": "2024-09-19T02:10:20.863+0000", "updated": "2024-09-19T02:10:20.863+0000", "started": "2024-09-19T02:10:20.862+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935256", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935271", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2360001928\n\n   > The cpp-unit-test failed and I find an issue maybe associate with the failure [ZOOKEEPER-4746](https://issues.apache.org/jira/projects/ZOOKEEPER/issues/ZOOKEEPER-4746?filter=allopenissues&orderby=created+DESC%2C+priority+DESC%2C+updated+DESC). Let me take a look on it.\r\n   \r\n   That does not matter, it will not block this pr. I forgot it entirely and created ZOOKEEPER-4859 with attached log.\n\n\n", "created": "2024-09-19T05:21:48.408+0000", "updated": "2024-09-19T05:21:48.408+0000", "started": "2024-09-19T05:21:48.408+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935271", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935278", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2360152099\n\n   @anmolnar @tisonkun @eolivelli Would you mind take a look ?\n\n\n", "created": "2024-09-19T07:01:38.363+0000", "updated": "2024-09-19T07:01:38.363+0000", "started": "2024-09-19T07:01:38.362+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935278", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935449", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2362868693\n\n   > Excellent candidate for 3.9.3 release. Thanks!\r\n   > \r\n   > Question: why have you moved logic out of the class to static class `SecurityUtils` while you're not using it anywhere else. For instance `getAppConfigurationEntryWithSection()` is only used in `SaslQuorumAuthServer`, so it should be a private method of it.\r\n   \r\n   getAppConfigurationEntryWithSection alway used in SecurityUtilss other methods. SecurityUtils::getDigestMd5Credentials -> SecurityUtils::getServerAppConfigurationEntry -> SecurityUtils::getAppConfigurationEntryWithSection. \n\n\n", "created": "2024-09-20T05:41:59.842+0000", "updated": "2024-09-20T05:41:59.842+0000", "started": "2024-09-20T05:41:59.842+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935449", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935631", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2364629073\n\n   > > Excellent candidate for 3.9.3 release. Thanks!\r\n   > > Question: why have you moved logic out of the class to static class `SecurityUtils` while you're not using it anywhere else. For instance `getAppConfigurationEntryWithSection()` is only used in `SaslQuorumAuthServer`, so it should be a private method of it.\r\n   > \r\n   > getAppConfigurationEntryWithSection is also used in SecurityUtilss other methods. SecurityUtils::getDigestMd5Credentials -> SecurityUtils::getServerAppConfigurationEntry -> SecurityUtils::getAppConfigurationEntryWithSection.\r\n   \r\n   Following the call chain it still seems to me that every method is used only in `ServerCnxnFactory` abstract class, but correct me if I'm wrong. All of these methods should belong to there. You can still make them visible for testing.\n\n\n", "created": "2024-09-20T21:16:59.840+0000", "updated": "2024-09-20T21:16:59.840+0000", "started": "2024-09-20T21:16:59.839+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935631", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935654", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2364959646\n\n   > > > Excellent candidate for 3.9.3 release. Thanks!\r\n   > > > Question: why have you moved logic out of the class to static class `SecurityUtils` while you're not using it anywhere else. For instance `getAppConfigurationEntryWithSection()` is only used in `SaslQuorumAuthServer`, so it should be a private method of it.\r\n   > > \r\n   > > \r\n   > > getAppConfigurationEntryWithSection is also used in SecurityUtilss other methods. SecurityUtils::getDigestMd5Credentials -> SecurityUtils::getServerAppConfigurationEntry -> SecurityUtils::getAppConfigurationEntryWithSection.\r\n   > \r\n   > Following the call chain it still seems to me that every method is used only in `ServerCnxnFactory` abstract class, but correct me if I'm wrong. All of these methods should belong to there. You can still make them visible for testing.\r\n   \r\n   Thanks for your reply! I find some dup codes in my pr, let me fix it.\n\n\n", "created": "2024-09-21T02:53:16.394+0000", "updated": "2024-09-21T02:53:16.394+0000", "started": "2024-09-21T02:53:16.392+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935654", "issueId": "13582975"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/worklog/935664", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2176:\nURL: https://github.com/apache/zookeeper/pull/2176#issuecomment-2365007130\n\n   Hi, @kezhuw @anmolnar  I find something confused me.\r\n   \r\n   [[SaslQuorumServerCallbackHandler](https://github.com/apache/zookeeper/blob/bc9afbf8ef1bc6156643d3d05c87fcf8411e9d8f/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/auth/SaslQuorumServerCallbackHandler.java#L82)](https://github.com/apache/zookeeper/blob/bc9afbf8ef1bc6156643d3d05c87fcf8411e9d8f/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/auth/SaslQuorumServerCallbackHandler.java#L82)\r\n   \r\n   The codes here are correct ?\r\n   \r\n   I think if a section contains a module that is DigestLoginModule, we can set isDigestAuthn to true.\r\n   \r\n   So i think the correct codes are\r\n   \r\n   ```java\r\n   boolean isDigestAuthn = false;\r\n   for (AppConfigurationEntry entry : configurationEntries) {\r\n   \t\tif (entry.getLoginModuleName().equals(DigestLoginModule.class.getName())) {\r\n         Map<String, ?> options = entry.getOptions();\r\n         // Populate DIGEST-MD5 user -> password map with JAAS configuration entries from the \"QuorumServer\" section.\r\n         // Usernames are distinguished from other options by prefixing the username with a \"user_\" prefix.\r\n         for (Map.Entry<String, ?> pair : options.entrySet()) {\r\n             String key = pair.getKey();\r\n             if (key.startsWith(USER_PREFIX)) {\r\n                 String userName = key.substring(USER_PREFIX.length());\r\n                 credentials.put(userName, (String) pair.getValue());\r\n             }\r\n         }\r\n         isDigestAuthn = true;\r\n      }\r\n   }\r\n   ```\r\n   \r\n    Am I right?\n\n\n", "created": "2024-09-21T05:18:15.005+0000", "updated": "2024-09-21T05:18:15.005+0000", "started": "2024-09-21T05:18:15.005+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935664", "issueId": "13582975"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": 16200, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6ab4248a[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@72b2aa7d[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f90298e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@28168343[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@26cf5aac[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@7cb16f89[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@32a3f5c8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@2e336444[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@72f55114[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@54fb5e4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@286f0d30[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@1d4b5d3d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 16200, "customfield_12312520": null, "customfield_12312521": "Wed Sep 25 00:47:01 UTC 2024", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2024-09-25T00:47:01.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4839/watchers", "watchCount": 3, "isWatching": false}, "created": "2024-06-18T03:27:21.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2024-10-24T20:09:31.000+0000", "timeoriginalestimate": null, "description": "When DigestMD5 is used to enable mandatory client authentication. Consider the following scenario: After successfully logging in with the correct user and password for the first time, change the user to keep the correct password for the last time, and you can still log in normally. I looked at both versions 3.5.10 and 3.9.2. See the class SaslServerCallbackHandler server-side code. A global private variable called userName is defined, but in the handleNameCallback method, if the given user name is not configured, it simply returns without updating userName. This results in the handlePasswordCallback method still using the userName of the last successful login to retrieve, and naturally can find the last password, and the comparison is correct.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "4.5h", "remainingEstimateSeconds": 0, "timeSpentSeconds": 16200}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [{"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069597", "id": "13069597", "filename": "image-2024-06-19-11-04-14-140.png", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wstcjmg", "name": "wstcjmg", "key": "JIRAUSER305844", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "wstcjmg", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-06-19T03:04:17.140+0000", "size": 180813, "mimeType": "image/png", "content": "https://issues.apache.org/jira/secure/attachment/13069597/image-2024-06-19-11-04-14-140.png"}], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "When DigestMD5 is used to enable mandatory client authentication,Users that do not exist can log in", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/comment/17856113", "id": "17856113", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wstcjmg", "name": "wstcjmg", "key": "JIRAUSER305844", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "wstcjmg", "active": true, "timeZone": "Asia/Shanghai"}, "body": "!image-2024-06-19-11-04-14-140.png!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wstcjmg", "name": "wstcjmg", "key": "JIRAUSER305844", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34050", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34050", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34050", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34050"}, "displayName": "wstcjmg", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-06-19T03:04:19.009+0000", "updated": "2024-06-19T03:04:19.009+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/comment/17864866", "id": "17864866", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "body": "There is an uncovered condition when processing users that are not on the credential list. When a user is not contained in the credentials, we should invoke the appropriate method to handle this scenario. we should call the method\r\n{code:java}\r\npc.clearPassword(); {code}\r\nwhen user not in credentials. Let me try to fix it!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "created": "2024-07-11T02:16:31.020+0000", "updated": "2024-07-11T02:16:31.020+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/comment/17865755", "id": "17865755", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "body": "I have created a pr to resolve it.\r\n\r\n[Clear user credentials when userName non-exist in sasl login module by luoxiner  Pull Request #2176  apache/zookeeper (github.com)|https://github.com/apache/zookeeper/pull/2176]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "created": "2024-07-14T08:17:49.685+0000", "updated": "2024-07-14T08:17:49.685+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13582975/comment/17884470", "id": "17884470", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "Issue resolved by pull request 2176\n[https://github.com/apache/zookeeper/pull/2176]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2024-09-25T00:47:01.604+0000", "updated": "2024-09-25T00:47:01.604+0000"}], "maxResults": 4, "total": 4, "startAt": 0}, "customfield_12311820": "0|z1puts:", "customfield_12314139": null}}