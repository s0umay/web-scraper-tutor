{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13567704", "self": "https://issues.apache.org/jira/rest/api/2/issue/13567704", "key": "ZOOKEEPER-4801", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353480", "id": "12353480", "name": "3.9.1", "archived": false, "released": true, "releaseDate": "2023-10-09"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312382", "id": "12312382", "name": "server", "description": "General issues with the ZooKeeper server."}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=horizonzy", "name": "horizonzy", "key": "horizonzy", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Yan Zhao", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=horizonzy", "name": "horizonzy", "key": "horizonzy", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Yan Zhao", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 4200, "total": 4200, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 4200, "total": 4200, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4801/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 7, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/904022", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "horizonzy opened a new pull request, #2130:\nURL: https://github.com/apache/zookeeper/pull/2130\n\n   (no comment)\n\n\n", "created": "2024-02-07T08:35:13.551+0000", "updated": "2024-02-07T08:35:13.551+0000", "started": "2024-02-07T08:35:13.550+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "904022", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/935966", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#issuecomment-2369642515\n\n   @kezhuw This one if waiting for 3.9.3 release. Please help in review.\n\n\n", "created": "2024-09-23T22:31:05.646+0000", "updated": "2024-09-23T22:31:05.646+0000", "started": "2024-09-23T22:31:05.646+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935966", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/935977", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#discussion_r1772400231\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -92,9 +93,16 @@ public class ZKDatabase {\n     public static final String COMMIT_LOG_COUNT = \"zookeeper.commitLogCount\";\n     public static final int DEFAULT_COMMIT_LOG_COUNT = 500;\n     public int commitLogCount;\n+    public static final String COMMIT_LOG_SIZE = \"zookeeper.commitLogSize\";\n+    public static final double DEFAULT_COMMIT_LOG_SIZE = Runtime.getRuntime().maxMemory() * 0.2;\n\nReview Comment:\n   Is it evaluated as bytes ? Should it better to be `long` ?\n\n\n\n", "created": "2024-09-24T01:05:14.754+0000", "updated": "2024-09-24T01:05:14.754+0000", "started": "2024-09-24T01:05:14.754+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935977", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/935985", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#discussion_r1772415584\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -151,7 +158,24 @@ public ZKDatabase(FileTxnSnapLog snapLog) {\n                 DEFAULT_COMMIT_LOG_COUNT);\n             commitLogCount = DEFAULT_COMMIT_LOG_COUNT;\n         }\n-        LOG.info(\"{}={}\", COMMIT_LOG_COUNT, commitLogCount);\n+        try {\n+            commitLogSize = Double.parseDouble(\n\nReview Comment:\n   backlog: I think we cloud introduce something similar to [Time::parseTimeInterval](https://github.com/apache/zookeeper/pull/2178/files#diff-f88e4ed3bd32bdaf079b8114bf957308b9d5dedef10aa65a347888468678ce84R60) in a later time. The size may look large in case of bytes.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -92,9 +93,16 @@ public class ZKDatabase {\n     public static final String COMMIT_LOG_COUNT = \"zookeeper.commitLogCount\";\n     public static final int DEFAULT_COMMIT_LOG_COUNT = 500;\n     public int commitLogCount;\n+    public static final String COMMIT_LOG_SIZE = \"zookeeper.commitLogSize\";\n+    public static final double DEFAULT_COMMIT_LOG_SIZE = Runtime.getRuntime().maxMemory() * 0.2;\n+    public double commitLogSize;\n     protected Queue<Proposal> committedLog = new ArrayDeque<>();\n     protected ReentrantReadWriteLock logLock = new ReentrantReadWriteLock();\n     private volatile boolean initialized = false;\n+    /**\n+     * committedLog bytes size.\n+     */\n+    private AtomicLong totalCommittLogSize = new AtomicLong(0);\n\nReview Comment:\n   typo: Should be `totalCommitLogSize` ?\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -320,17 +345,24 @@ public void addCommittedProposal(Request request) {\n         WriteLock wl = logLock.writeLock();\n         try {\n             wl.lock();\n-            if (committedLog.size() > commitLogCount) {\n-                committedLog.remove();\n-                minCommittedLog = committedLog.peek().getZxid();\n-            }\n             if (committedLog.isEmpty()) {\n                 minCommittedLog = request.zxid;\n-                maxCommittedLog = request.zxid;\n             }\n             PureRequestProposal p = new PureRequestProposal(request);\n             committedLog.add(p);\n             maxCommittedLog = p.getZxid();\n+            totalCommittLogSize.addAndGet(request.getApproximateSize());\n+            while (committedLog.size() > 0\n\nReview Comment:\n   `!committedLog.isEmpty()` ?\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -92,9 +93,16 @@ public class ZKDatabase {\n     public static final String COMMIT_LOG_COUNT = \"zookeeper.commitLogCount\";\n     public static final int DEFAULT_COMMIT_LOG_COUNT = 500;\n     public int commitLogCount;\n+    public static final String COMMIT_LOG_SIZE = \"zookeeper.commitLogSize\";\n+    public static final double DEFAULT_COMMIT_LOG_SIZE = Runtime.getRuntime().maxMemory() * 0.2;\n+    public double commitLogSize;\n     protected Queue<Proposal> committedLog = new ArrayDeque<>();\n     protected ReentrantReadWriteLock logLock = new ReentrantReadWriteLock();\n     private volatile boolean initialized = false;\n+    /**\n+     * committedLog bytes size.\n+     */\n+    private AtomicLong totalCommittLogSize = new AtomicLong(0);\n\nReview Comment:\n   And `long` is enough ?\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -92,9 +93,16 @@ public class ZKDatabase {\n     public static final String COMMIT_LOG_COUNT = \"zookeeper.commitLogCount\";\n     public static final int DEFAULT_COMMIT_LOG_COUNT = 500;\n     public int commitLogCount;\n+    public static final String COMMIT_LOG_SIZE = \"zookeeper.commitLogSize\";\n\nReview Comment:\n   We should document this in `zookeeperAdmin.md`.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -320,17 +345,24 @@ public void addCommittedProposal(Request request) {\n         WriteLock wl = logLock.writeLock();\n         try {\n             wl.lock();\n-            if (committedLog.size() > commitLogCount) {\n-                committedLog.remove();\n-                minCommittedLog = committedLog.peek().getZxid();\n-            }\n             if (committedLog.isEmpty()) {\n                 minCommittedLog = request.zxid;\n-                maxCommittedLog = request.zxid;\n             }\n             PureRequestProposal p = new PureRequestProposal(request);\n             committedLog.add(p);\n             maxCommittedLog = p.getZxid();\n+            totalCommittLogSize.addAndGet(request.getApproximateSize());\n+            while (committedLog.size() > 0\n+                    && (committedLog.size() > commitLogCount || totalCommittLogSize.get() > commitLogSize)) {\n+                committedLog.remove();\n+                Proposal peek = committedLog.peek();\n+                if (peek == null) {\n+                    minCommittedLog = 0;\n+                    maxCommittedLog = 0;\n+                } else {\n+                    minCommittedLog = p.getZxid();\n\nReview Comment:\n   Should be `peek.getZxid()` ?\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -137,12 +145,11 @@ public ZKDatabase(FileTxnSnapLog snapLog) {\n             commitLogCount = Integer.parseInt(\n                     System.getProperty(COMMIT_LOG_COUNT,\n                             Integer.toString(DEFAULT_COMMIT_LOG_COUNT)));\n-            if (commitLogCount < DEFAULT_COMMIT_LOG_COUNT) {\n\nReview Comment:\n   > The default value is 500 which is the recommended minimum. (https://zookeeper.apache.org/doc/r3.9.2/zookeeperAdmin.html)\r\n   \r\n   I do think `500` is pretty small for ZooKeeper already. It is meaningless to support `1` as minimum. Is it better to rename  `DEFAULT_COMMIT_LOG_COUNT` to `MIN_COMMIT_LOG_COUNT` ?\n\n\n\n", "created": "2024-09-24T03:04:47.047+0000", "updated": "2024-09-24T03:04:47.047+0000", "started": "2024-09-24T03:04:47.046+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "935985", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/936217", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#discussion_r1774102691\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -137,12 +145,11 @@ public ZKDatabase(FileTxnSnapLog snapLog) {\n             commitLogCount = Integer.parseInt(\n                     System.getProperty(COMMIT_LOG_COUNT,\n                             Integer.toString(DEFAULT_COMMIT_LOG_COUNT)));\n-            if (commitLogCount < DEFAULT_COMMIT_LOG_COUNT) {\n\nReview Comment:\n   What would be the default then?\n\n\n\n", "created": "2024-09-24T21:15:38.627+0000", "updated": "2024-09-24T21:15:38.627+0000", "started": "2024-09-24T21:15:38.626+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "936217", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/936218", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#discussion_r1774106580\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -151,7 +158,24 @@ public ZKDatabase(FileTxnSnapLog snapLog) {\n                 DEFAULT_COMMIT_LOG_COUNT);\n             commitLogCount = DEFAULT_COMMIT_LOG_COUNT;\n         }\n-        LOG.info(\"{}={}\", COMMIT_LOG_COUNT, commitLogCount);\n+        try {\n+            commitLogSize = Double.parseDouble(\n\nReview Comment:\n   Makes sense to me and I think it's doable in this PR too since we're already touching this part. The parser is already merged and could be easily shared.\n\n\n\n", "created": "2024-09-24T21:19:49.887+0000", "updated": "2024-09-24T21:19:49.887+0000", "started": "2024-09-24T21:19:49.886+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "936218", "issueId": "13567704"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13567704/worklog/936219", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2130:\nURL: https://github.com/apache/zookeeper/pull/2130#discussion_r1774108172\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java:\n##########\n@@ -151,7 +158,24 @@ public ZKDatabase(FileTxnSnapLog snapLog) {\n                 DEFAULT_COMMIT_LOG_COUNT);\n             commitLogCount = DEFAULT_COMMIT_LOG_COUNT;\n         }\n-        LOG.info(\"{}={}\", COMMIT_LOG_COUNT, commitLogCount);\n+        try {\n+            commitLogSize = Double.parseDouble(\n\nReview Comment:\n   Will `Double.parseDouble()` accept floating point numbers from the config?\r\n   Shouldn't we prevent that?\n\n\n\n", "created": "2024-09-24T21:22:58.117+0000", "updated": "2024-09-24T21:22:58.117+0000", "started": "2024-09-24T21:22:58.117+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "936219", "issueId": "13567704"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}, "timespent": 4200, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@167db58f[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@d361e79[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@458bb7a6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@78f3bcb8[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4b42e947[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@78b10c33[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@601fb204[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5ecc4c3[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@59b81de8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@29985278[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@340a5add[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@57a35a43[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 4200, "customfield_12312520": null, "customfield_12312521": "2024-02-07 08:34:50.0", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4801/watchers", "watchCount": 1, "isWatching": false}, "created": "2024-02-07T08:34:50.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2024-10-01T18:15:47.000+0000", "timeoriginalestimate": null, "description": "The ZkDataBase support commit log count to limit the memory, which is not precise, some request payloads may be huge, it will cost lots of heap memory.\r\nSo support payload size limitation will be better.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "1h 10m", "remainingEstimateSeconds": 0, "timeSpentSeconds": 4200}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Add memory size limitation policy for ZkDataBase#committedLog", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "customfield_12311820": "0|z1n9m0:", "customfield_12314139": null}}