{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13632190", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632190", "key": "HIVE-29286", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": [], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "1.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12356025", "id": "12356025", "name": "4.2.0", "archived": false, "released": false}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [{"id": "12710303", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12710303", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "outwardIssue": {"id": "12850056", "key": "HIVE-11402", "self": "https://issues.apache.org/jira/rest/api/2/issue/12850056", "fields": {"summary": "HS2 - add an option to disallow parallel query execution within a single Session", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}}}}, {"id": "12710302", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12710302", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "outwardIssue": {"id": "12989134", "key": "HIVE-14227", "self": "https://issues.apache.org/jira/rest/api/2/issue/12989134", "fields": {"summary": "Investigate invalid SessionHandle and invalid OperationHandle", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/10002", "description": "A patch for this issue has been uploaded to JIRA by a contributor.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/document.png", "name": "Patch Available", "id": "10002", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4", "id": 4, "key": "indeterminate", "colorName": "yellow", "name": "In Progress"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}}}}, {"id": "12710307", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12710307", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "inwardIssue": {"id": "13574098", "key": "HIVE-28168", "self": "https://issues.apache.org/jira/rest/api/2/issue/13574098", "fields": {"summary": "new command to implement kill session on HS2", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}}}}], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12320408", "id": "12320408", "name": "HiveServer2", "description": "Tracks issues related to HiveServer2"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29286/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@15861f02[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@56f3e59b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7fe16eb8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@36f783e2[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7e987b6d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@748ffdd8[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6fc95f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@a8db223[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3773e30c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3c19a907[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4242aaea[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2539042b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310843", "id": "12310843", "key": "HIVE", "name": "Hive", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292", "id": "10292", "description": "Scalable Distributed Computing", "name": "Hadoop"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Wed Oct 22 11:04:17 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29286/watchers", "watchCount": 2, "isWatching": false}, "created": "2025-10-22T10:41:03.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-10-22T11:11:12.000+0000", "timeoriginalestimate": null, "description": "Consider the following scenario where three clients/threads interact with HiveServer2 (HS2) using directly (not via JDBC/ODBC) the Thrift APIs. To showcase the problem we assume that the following properties are set.\r\n{code:sql}\r\nset hive.driver.parallel.compilation=true;\r\nset hive.driver.parallel.compilation.global.limit=1;\r\nset hive.server2.compile.lock.timeout=0s; \r\n{code}\r\n * C1: Connect with HS2 and start session with handle S1\r\n * C1: Send Q1, a slow-compilation query, using S1\r\n * HS2: Obtain the compilation lock and start compiling Q1\r\n * C2: Connect with HS2 and start session with handle S2\r\n * C2: Send Q2, a fast-compilation query, using S2\r\n * HS2: Q2 blocks, waiting for the compilation lock to become available.\r\n * C3: Connect with HS2 and close session with handle S2\r\n\r\nC1, C2, C3 are different Thrift connections so they are handled by separate HS2 threads. C3 will successfully close/kill/stop the session. However, since Q2 was blocked in compilation it can't be stopped immediately. When C2 finally obtains the compilation lock and finishes, the operation will error out since various session related entries have been cleared out.\r\n\r\nThread-152 handles the requests from C2, and it reaches the end of compilation it throws the following errors.\r\n{noformat}\r\n2025-10-22T03:05:32,929 ERROR [87a053ce-f5d8-4baa-bdbc-8fd7bc1eef31 HiveServer2-Handler-Pool: Thread-152] thrift.ThriftCLIService: Failed to execute statement [request: TExecuteStatementReq(sessionHandle:TSessionHandle(sessionId:THandleIdentifier(guid:87 A0 53 CE F5 D8 4B AA BD BC \r\n8F D7 BC 1E EF 31, secret:C5 A3 62 BB 51 0B 4A 76 B6 7A 04 0B 38 5C 0A 5A)), statement:EXPLAIN SELECT AVG(age) FROM person GROUP BY name, confOverlay:{}, runAsync:false, queryTimeout:0)]\r\njava.lang.RuntimeException: java.lang.NullPointerException: Cannot invoke \"org.apache.hadoop.hive.ql.session.SessionState.getSessionId()\" because the return value of \"org.apache.hive.service.cli.session.HiveSession.getSessionState()\" is null\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:89) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy$1.run(HiveSessionProxy.java:63) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:714) ~[?:?]\r\n        at java.base/javax.security.auth.Subject.doAs(Subject.java:525) ~[?:?]\r\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1953) ~[hadoop-common-3.4.1.jar:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:59) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at jdk.proxy2/jdk.proxy2.$Proxy43.executeStatement(Unknown Source) ~[?:?]\r\n        at org.apache.hive.service.cli.CLIService.executeStatement(CLIService.java:281) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:651) ~[hive-service-4.2.0-SNAPSHOT.jar:?]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1670) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1650) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:250) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]\r\n        at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]\r\nCaused by: java.lang.NullPointerException: Cannot invoke \"org.apache.hadoop.hive.ql.session.SessionState.getSessionId()\" because the return value of \"org.apache.hive.service.cli.session.HiveSession.getSessionState()\" is null\r\n        at org.apache.hive.service.cli.operation.Operation.afterRun(Operation.java:270) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.operation.Operation.run(Operation.java:288) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:558) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatement(HiveSessionImpl.java:532) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[?:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:78) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        ... 17 more\r\n2025-10-22T03:05:32,930 ERROR [87a053ce-f5d8-4baa-bdbc-8fd7bc1eef31 HiveServer2-Handler-Pool: Thread-152] thrift.ThriftCLIService: Failed to close the session\r\norg.apache.hive.service.cli.HiveSQLException: Session does not exist: SessionHandle [87a053ce-f5d8-4baa-bdbc-8fd7bc1eef31]\r\n        at org.apache.hive.service.cli.session.SessionManager.closeSession(SessionManager.java:625) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.CLIService.closeSession(CLIService.java:240) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.CloseSession(ThriftCLIService.java:611) ~[hive-service-4.2.0-SNAPSHOT.jar:?]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$CloseSession.getResult(TCLIService.java:1620) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$CloseSession.getResult(TCLIService.java:1600) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:250) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]\r\n        at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]\r\n{noformat}\r\nThe fact that C3 closes the session that is open by another client leads to race conditions and may also cause resource leaks. The error may not always be the same with the one reported above since it really depends at which stage of compilation/execution a session is closed/killed.\r\n\r\nWhen the queries are over ACID tables the abrupt session termination of S2 will fail to close the transaction that is opened for Q2 leading to a transaction leak.\r\n\r\nThe scenario is inspired from [Hue|https://gethue.com/] workflows where session close can be initiated by user request or [configuration settings|https://docs.gethue.com/administrator/configuration/server/#idle-session-timeout].", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12310320": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [{"self": "https://issues.apache.org/jira/rest/api/2/attachment/13078906", "id": "13078906", "filename": "session-close-txn-leak.patch", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-22T10:44:26.263+0000", "size": 8852, "mimeType": "text/x-patch", "content": "https://issues.apache.org/jira/secure/attachment/13078906/session-close-txn-leak.patch"}], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Session close from different clients/threads leaks resources", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13632190/comment/18032038", "id": "18032038", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "body": "The [^session-close-txn-leak.patch] contains a unit test that reproduces the problem on current master (commit ad55d58eadd6c1aabc7fed51e25dfffe158a44f6).", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-22T10:47:23.843+0000", "updated": "2025-10-22T10:47:23.843+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13632190/comment/18032042", "id": "18032042", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "body": "As explained also under HIVE-11402 the objects that are handling the sessions in HS2 are not really thread safe and there are many assumptions that only one thread is making use of the session at every point in time. The scenario described above violates these assumptions since we have many threads/clients operating on the same session thus the use-case is not officially supported by HS2. \r\n\r\nHIVE-14227, is very similar to this issue reporting issues when sessions are used by different Thrift connections. The respective patch was never merged since there was no consensus to move forward.\r\n\r\nOverall, there is a general agreement that clients should avoid using sessions from different connections since the results in most cases are unpredictable.\r\n\r\n ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-22T11:04:17.959+0000", "updated": "2025-10-22T11:04:17.959+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "customfield_12311820": "0|z1y96o:", "customfield_12314139": null}}