{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13573337", "self": "https://issues.apache.org/jira/rest/api/2/issue/13573337", "key": "ZOOKEEPER-4819", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12355230", "id": "12355230", "description": "", "name": "3.9.4", "archived": false, "released": true, "releaseDate": "2025-08-29"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353693", "id": "12353693", "description": "", "name": "3.8.4", "archived": false, "released": true, "releaseDate": "2024-03-05"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353694", "id": "12353694", "description": "", "name": "3.9.2", "archived": false, "released": true, "releaseDate": "2024-03-12"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312381", "id": "12312381", "name": "java client", "description": "The java client interface for ZooKeeper"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "aggregateprogress": {"progress": 12000, "total": 12000, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 12000, "total": 12000, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4819/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 20, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/937438", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner opened a new pull request, #2200:\nURL: https://github.com/apache/zookeeper/pull/2200\n\n   ClientCnxn::pingRwServer uses raw socket to issue \"isro\" 4lw command. This results in unsuccessful handshake to tls server. Use SSLSocket when zookeeper.client.secure is set to true.\r\n   \r\n   associated jira issue [ZOOKEEPER-4819](https://issues.apache.org/jira/browse/ZOOKEEPER-4819)\n\n\n", "created": "2024-10-10T14:39:03.220+0000", "updated": "2024-10-10T14:39:03.220+0000", "started": "2024-10-10T14:39:03.220+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "937438", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/937721", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#issuecomment-2408396452\n\n   Great! I think we need tests.\n\n\n", "created": "2024-10-12T05:18:48.096+0000", "updated": "2024-10-12T05:18:48.096+0000", "started": "2024-10-12T05:18:48.096+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "937721", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/937760", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#issuecomment-2408810881\n\n   > Great! I think we need tests.\r\n   \r\n   Hi @kezhuw, I added a test case based on the ReadOnlyModeTest. Please take a look.\n\n\n", "created": "2024-10-13T04:03:10.716+0000", "updated": "2024-10-13T04:03:10.716+0000", "started": "2024-10-13T04:03:10.715+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "937760", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/937767", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1798176480\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java:\n##########\n@@ -1348,6 +1351,28 @@ private void pingRwServer() throws RWServerFoundException {\n             }\n         }\n \n+        private Socket newSocket(InetSocketAddress addr) throws IOException, X509Exception.SSLContextException {\n+            boolean useSecure = clientConfig.getBoolean(ZKClientConfig.SECURE_CLIENT);\n+            Socket sock;\n+            if (useSecure) {\n+                try (X509Util util = new ClientX509Util()) {\n+                    SSLContext sslContext = util.createSSLContext(clientConfig);\n+                    SSLSocketFactory socketFactory = sslContext.getSocketFactory();\n+                    SSLSocket sslSock = (SSLSocket) socketFactory.createSocket();\n+                    sslSock.connect(addr);\n\nReview Comment:\n   This could throw exception and leak `sslSock`.\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper;\n\nReview Comment:\n   ```suggestion\r\n   package org.apache.zookeeper.test;\r\n   ```\n\n\n\n", "created": "2024-10-13T09:05:28.850+0000", "updated": "2024-10-13T09:05:28.850+0000", "started": "2024-10-13T09:05:28.850+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "937767", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/937888", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#issuecomment-2411455245\n\n   @kezhuw  @eolivelli  Thank you for your reply. I have changed my code based on the suggestions. Please take a look.\n\n\n", "created": "2024-10-14T14:37:46.068+0000", "updated": "2024-10-14T14:37:46.068+0000", "started": "2024-10-14T14:37:46.068+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "937888", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938004", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1800328858\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   These properties are mixed between client and server. I think we should build a `ZKClientConfig` for client usage prior to set them up for server(there is ZOOKEEPER-2139 counterpart in server) as  `ZKClientConfig` will inherit properties from system.\r\n   \r\n   https://github.com/apache/zookeeper/blob/75884ec1f4a680f46bcc0a6257df413955eda4e8/zookeeper-server/src/main/java/org/apache/zookeeper/common/ZKConfig.java#L95-L136\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java:\n##########\n@@ -1301,44 +1300,19 @@ private void cleanAndNotifyState() {\n         private void pingRwServer() throws RWServerFoundException {\n             String result = null;\n             InetSocketAddress addr = hostProvider.next(0);\n+            boolean useSecure = clientConfig.getBoolean(ZKClientConfig.SECURE_CLIENT);\n \n             LOG.info(\"Checking server {} for being r/w. Timeout {}\", addr, pingRwTimeout);\n-\n-            Socket sock = null;\n-            BufferedReader br = null;\n             try {\n-                sock = new Socket(addr.getHostString(), addr.getPort());\n-                sock.setSoLinger(false, -1);\n-                sock.setSoTimeout(1000);\n-                sock.setTcpNoDelay(true);\n-                sock.getOutputStream().write(\"isro\".getBytes());\n-                sock.getOutputStream().flush();\n-                sock.shutdownOutput();\n-                br = new BufferedReader(new InputStreamReader(sock.getInputStream()));\n-                result = br.readLine();\n+                result = FourLetterWordMain.send4LetterWord(addr.getHostString(), addr.getPort(), \"isro\", useSecure, 1000);\n\nReview Comment:\n   I think we should add a overloading `send4LetterWord` to accept `ZKConfig`, so we can sure that we are not mixed with external properties. Currently, `send4LetterWord` uses `new ZkConfig` which is not suitable for `ClientCnxn` after ZOOKEEPER-2139.\r\n   \r\n   https://github.com/apache/zookeeper/blob/75884ec1f4a680f46bcc0a6257df413955eda4e8/zookeeper-server/src/main/java/org/apache/zookeeper/common/X509Util.java#L340-L347\n\n\n\n", "created": "2024-10-15T02:45:20.384+0000", "updated": "2024-10-15T02:45:20.384+0000", "started": "2024-10-15T02:45:20.384+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938004", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938005", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1800361169\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   The test passed since `send4LetterWord` will inherit these properties in `setUp` for server side. I would be really good to not populate any properties for this test. But it is not possible currently. I created ZOOKEEPER-4875 instead.\n\n\n\n", "created": "2024-10-15T03:05:43.310+0000", "updated": "2024-10-15T03:05:43.310+0000", "started": "2024-10-15T03:05:43.309+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938005", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938006", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1800361169\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   The test passed since `send4LetterWord` will inherit these properties in `setUp` for server side. It would be really good to not populate any properties for this test. But it is not possible currently. I created ZOOKEEPER-4875 instead.\n\n\n\n", "created": "2024-10-15T03:06:23.686+0000", "updated": "2024-10-15T03:06:23.686+0000", "started": "2024-10-15T03:06:23.686+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938006", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938096", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1800971332\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   Is it preferable to prioritize the use of ClientConfig over system properties？ If the properties are not already set in the ClientConfig, then we can retrieve them from the system properties. We can also maintain backward compatibility and ensure that properties in ClientConfig remain isolated in this manner.\n\n\n\n", "created": "2024-10-15T11:16:31.730+0000", "updated": "2024-10-15T11:16:31.730+0000", "started": "2024-10-15T11:16:31.730+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938096", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938155", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1801233489\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   > Is it preferable to prioritize the use of ClientConfig over system properties？\r\n   \r\n   Client should use `ZKClientConfig` instead system properties after constructed. It not, it is a bug. So, https://github.com/apache/zookeeper/commit/33c19e370d78a7bc0ab4a9e8b085b4cf8191123d#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1307 is buggy as it does not use the one in constructor but the `new ZkConfig()`. These two are necessary to have same properties. It should use `ClientCnxn.clientConfig` which means https://github.com/apache/zookeeper/commit/b13e1966efc8006f7b5be813329751939a83c26b#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1359 is correct.\r\n   \r\n   https://github.com/apache/zookeeper/blob/b99714543db86ca081a5d648c565f0d9cb4c82c2/zookeeper-server/src/main/java/org/apache/zookeeper/ZooKeeper.java#L1099\r\n   \r\n   > If the properties are not already set in the ClientConfig, then we can retrieve them from the system properties.\r\n   \r\n   This is already done in construction of a `ZKConfig`.\n\n\n\n", "created": "2024-10-15T13:59:49.333+0000", "updated": "2024-10-15T13:59:49.333+0000", "started": "2024-10-15T13:59:49.332+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938155", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938156", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1801233489\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   > Is it preferable to prioritize the use of ClientConfig over system properties？\r\n   \r\n   Client should use `ZKClientConfig` instead system properties after constructed. If not, it is a bug. So, https://github.com/apache/zookeeper/commit/33c19e370d78a7bc0ab4a9e8b085b4cf8191123d#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1307 is buggy as it does not use the one in constructor but the `new ZkConfig()`. These two are necessary to have same properties. It should use `ClientCnxn.clientConfig` which means https://github.com/apache/zookeeper/commit/b13e1966efc8006f7b5be813329751939a83c26b#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1359 is correct.\r\n   \r\n   https://github.com/apache/zookeeper/blob/b99714543db86ca081a5d648c565f0d9cb4c82c2/zookeeper-server/src/main/java/org/apache/zookeeper/ZooKeeper.java#L1099\r\n   \r\n   > If the properties are not already set in the ClientConfig, then we can retrieve them from the system properties.\r\n   \r\n   This is already done in construction of a `ZKConfig`.\n\n\n\n", "created": "2024-10-15T14:00:04.791+0000", "updated": "2024-10-15T14:00:04.791+0000", "started": "2024-10-15T14:00:04.791+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938156", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938157", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1801233489\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   > Is it preferable to prioritize the use of ClientConfig over system properties？\r\n   \r\n   Client should use `ZKClientConfig` instead system properties after constructed. If not, it is a bug. So, https://github.com/apache/zookeeper/commit/33c19e370d78a7bc0ab4a9e8b085b4cf8191123d#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1307 is buggy as it does not use the one in constructor but the `new ZkConfig()`. These two are not necessary to have same properties. It should use `ClientCnxn.clientConfig` which means https://github.com/apache/zookeeper/commit/b13e1966efc8006f7b5be813329751939a83c26b#diff-9657d4a14708c9ec1df56fd01581a442e10ef70cae39c7223d4f979b0ae54263R1359 is correct.\r\n   \r\n   https://github.com/apache/zookeeper/blob/b99714543db86ca081a5d648c565f0d9cb4c82c2/zookeeper-server/src/main/java/org/apache/zookeeper/ZooKeeper.java#L1099\r\n   \r\n   > If the properties are not already set in the ClientConfig, then we can retrieve them from the system properties.\r\n   \r\n   This is already done in construction of a `ZKConfig`.\n\n\n\n", "created": "2024-10-15T14:00:25.520+0000", "updated": "2024-10-15T14:00:25.520+0000", "started": "2024-10-15T14:00:25.519+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938157", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938159", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1801237954\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   > Client should use ZKClientConfig instead system properties after constructed. If not, it is a bug. \r\n   \r\n   This is the whole point of ZOOKEEPER-2139.\n\n\n\n", "created": "2024-10-15T14:02:09.826+0000", "updated": "2024-10-15T14:02:09.826+0000", "started": "2024-10-15T14:02:09.825+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938159", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938538", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "luoxiner commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1804038938\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   Yes, I realize that ZKConfig#init is only called when we construct ZKConfig with empty parameters. I had missed this before. I will fix it based on your comments later.\n\n\n\n", "created": "2024-10-17T02:58:07.281+0000", "updated": "2024-10-17T02:58:07.281+0000", "started": "2024-10-17T02:58:07.281+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938538", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/938594", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1804267468\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java:\n##########\n@@ -1303,42 +1302,16 @@ private void pingRwServer() throws RWServerFoundException {\n             InetSocketAddress addr = hostProvider.next(0);\n \n             LOG.info(\"Checking server {} for being r/w. Timeout {}\", addr, pingRwTimeout);\n-\n-            Socket sock = null;\n-            BufferedReader br = null;\n             try {\n-                sock = new Socket(addr.getHostString(), addr.getPort());\n-                sock.setSoLinger(false, -1);\n-                sock.setSoTimeout(1000);\n-                sock.setTcpNoDelay(true);\n\nReview Comment:\n   The other two sock options are also suitable for `send4LetterWord`.\n\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/client/FourLetterWordMain.java:\n##########\n@@ -94,6 +94,33 @@ public static String send4LetterWord(\n         return send4LetterWord(host, port, cmd, secure, timeout, null);\n     }\n \n+    /**\n+     * Send the 4letterword\n+     * @param host the destination host\n+     * @param port the destination port\n+     * @param cmd the 4letterword\n+     * @param timeout in milliseconds, maximum time to wait while connecting/reading data\n+     * @param clientConfig client config\n+     * @return server response\n+     * @throws SSLContextException\n+     * @throws IOException\n+     */\n+    public static String send4LetterWord(\n+            String host,\n+            int port,\n+            String cmd,\n+            int timeout,\n+            ZKClientConfig clientConfig) throws SSLContextException, IOException {\n\nReview Comment:\n   Keep `timeout` the last to consistent with `String send4LetterWord(String host, int port, String cmd, boolean secure, int timeout)` ?\n\n\n\n##########\nzookeeper-server/src/test/java/org/apache/zookeeper/test/ReadOnlyModeWithSSLTest.java:\n##########\n@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.zookeeper.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import java.io.ByteArrayOutputStream;\n+import java.io.LineNumberReader;\n+import java.io.StringReader;\n+import java.util.regex.Pattern;\n+import org.apache.zookeeper.CreateMode;\n+import org.apache.zookeeper.ZKTestCase;\n+import org.apache.zookeeper.ZooDefs;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.client.ZKClientConfig;\n+import org.apache.zookeeper.common.ClientX509Util;\n+import org.apache.zookeeper.common.StringUtils;\n+import org.apache.zookeeper.server.NettyServerCnxnFactory;\n+import org.apache.zookeeper.server.ServerCnxnFactory;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n+import org.slf4j.LoggerFactory;\n+\n+public class ReadOnlyModeWithSSLTest extends ZKTestCase {\n+\n+    private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(ReadOnlyModeWithSSLTest.class);\n+    private static int CONNECTION_TIMEOUT = QuorumBase.CONNECTION_TIMEOUT;\n+    private QuorumUtil qu = new QuorumUtil(1);\n+    private ClientX509Util clientX509Util;\n+\n+    @BeforeEach\n+    public void setUp() throws Exception {\n+        System.setProperty(\"readonlymode.enabled\", \"true\");\n+        System.setProperty(NettyServerCnxnFactory.PORT_UNIFICATION_KEY, Boolean.TRUE.toString());\n+        clientX509Util = new ClientX509Util();\n+        String testDataPath = System.getProperty(\"test.data.dir\", \"src/test/resources/data\");\n+        System.setProperty(ServerCnxnFactory.ZOOKEEPER_SERVER_CNXN_FACTORY, \"org.apache.zookeeper.server.NettyServerCnxnFactory\");\n+        System.setProperty(ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET, \"org.apache.zookeeper.ClientCnxnSocketNetty\");\n+        System.setProperty(ZKClientConfig.SECURE_CLIENT, \"true\");\n+        System.setProperty(clientX509Util.getSslKeystoreLocationProperty(), testDataPath + \"/ssl/testKeyStore.jks\");\n\nReview Comment:\n   We can revise here once ZOOKEEPER-4875 delivered.\n\n\n\n", "created": "2024-10-17T07:42:53.476+0000", "updated": "2024-10-17T07:42:53.476+0000", "started": "2024-10-17T07:42:53.476+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "938594", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/939233", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1809047490\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/client/FourLetterWordMain.java:\n##########\n@@ -137,7 +195,9 @@ public static String send4LetterWord(\n                 sock = new Socket();\n                 sock.connect(hostaddress, timeout);\n             }\n+            sock.setSoLinger(soLingerOn, soLinger);\n             sock.setSoTimeout(timeout);\n+            sock.setTcpNoDelay(tcpNoDelay);\n\nReview Comment:\n   ```suggestion\r\n               sock.setSoLinger(false, -1);\r\n               sock.setSoTimeout(timeout);\r\n               sock.setTcpNoDelay(true);\r\n   ```\r\n   \r\n   Sorry for my distractive review comments. I means these two options are suitable for `send4LetterWord` for reasons:\r\n   1. `send4LetterWord` is one-shot, it is better to send request immediately and return immediately once got response to not block caller.\r\n   2. `sock.setTcpNoDelay(true)` tells kernel to not delay any send operations.\r\n   3. `sock.setSoLinger(false, -1)` tells kernel to not block `close`.\r\n   \r\n   I think there is little chance for people to configure them if any.\n\n\n\n", "created": "2024-10-21T15:31:03.336+0000", "updated": "2024-10-21T15:31:03.336+0000", "started": "2024-10-21T15:31:03.336+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "939233", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/939617", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#discussion_r1811842648\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/client/FourLetterWordMain.java:\n##########\n@@ -94,6 +94,33 @@ public static String send4LetterWord(\n         return send4LetterWord(host, port, cmd, secure, timeout, null);\n     }\n \n+    /**\n+     * Send the 4letterword\n+     * @param host the destination host\n+     * @param port the destination port\n+     * @param cmd the 4letterword\n+     * @param timeout in milliseconds, maximum time to wait while connecting/reading data\n+     * @param clientConfig client config\n\nReview Comment:\n   ```suggestion\r\n        * @param clientConfig client config\r\n        * @param timeout in milliseconds, maximum time to wait while connecting/reading data\r\n   ```\n\n\n\n", "created": "2024-10-23T04:58:52.561+0000", "updated": "2024-10-23T04:58:52.561+0000", "started": "2024-10-23T04:58:52.561+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "939617", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/939618", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#issuecomment-2430906324\n\n   Looks good from my side.\r\n   \r\n   @eolivelli Would you want take another look ?\n\n\n", "created": "2024-10-23T05:00:27.222+0000", "updated": "2024-10-23T05:00:27.222+0000", "started": "2024-10-23T05:00:27.222+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "939618", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/945785", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw merged PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200\n\n\n", "created": "2024-11-27T01:21:48.522+0000", "updated": "2024-11-27T01:21:48.522+0000", "started": "2024-11-27T01:21:48.521+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "945785", "issueId": "13573337"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/worklog/945786", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2200:\nURL: https://github.com/apache/zookeeper/pull/2200#issuecomment-2502487118\n\n   @luoxiner Thank you for your contribution! Merged.\n\n\n", "created": "2024-11-27T01:55:50.953+0000", "updated": "2024-11-27T01:55:50.953+0000", "started": "2024-11-27T01:55:50.952+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "945786", "issueId": "13573337"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": 12000, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@772ceaf[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@582c3ac0[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@9178ea2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@30d44f7a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@365cbc10[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@27292a04[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12fec2dd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@c3f067[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@53ac6053[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3d3b1928[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5937cc78[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@46e84ff1[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 12000, "customfield_12312520": null, "customfield_12312521": "Wed Nov 27 01:55:21 UTC 2024", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2024-11-27T01:55:21.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4819/watchers", "watchCount": 2, "isWatching": false}, "created": "2024-03-26T12:15:19.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-29T21:29:01.000+0000", "timeoriginalestimate": null, "description": "{{[ClientCnxn::pingRwServer|https://github.com/apache/zookeeper/blob/d12aba599233b0fcba0b9b945ed3d2f45d4016f0/zookeeper-server/src/main/java/org/apache/zookeeper/ClientCnxn.java#L1280]}} uses raw socket to issue \"isro\" 4lw command. This results in unsuccessful handshake to tls server.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "3h 20m", "remainingEstimateSeconds": 0, "timeSpentSeconds": 12000}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Can't seek for writable tls server if connected to readonly server", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/comment/17885867", "id": "17885867", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "body": "[~kezhuw]  I can take a look and resolve it. Can you assign this issue to me ?\r\n\r\nIt seems we should make a socket from SSLSocketFactory with specified trustStore info when zookeeper.client.secure=true", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "created": "2024-09-30T11:43:01.619+0000", "updated": "2024-09-30T11:43:01.619+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/comment/17888310", "id": "17888310", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~kezhuw] \r\n\r\nI submit a pr to resolve it, can you take a look?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=luoxin", "name": "luoxin", "key": "JIRAUSER299934", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "luoxin", "active": true, "timeZone": "Etc/UTC"}, "created": "2024-10-10T14:40:29.151+0000", "updated": "2024-10-10T14:40:29.151+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573337/comment/17901352", "id": "17901352", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "master: 75f9781ecc3cde9fa5a032fa8cfa8c79b69ef879\r\nbranch-3.9: 644dcdbc9ac2b5e4a00dcaca7de4db26e923b59f", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2024-11-27T01:55:21.272+0000", "updated": "2024-11-27T01:55:21.272+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "customfield_12311820": "0|z1o7wg:", "customfield_12314139": null}}