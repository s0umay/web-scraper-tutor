{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13629296", "self": "https://issues.apache.org/jira/rest/api/2/issue/13629296", "key": "HIVE-29213", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/2", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg", "name": "Critical", "id": "2"}, "labels": [], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353994", "id": "12353994", "description": "", "name": "4.1.0", "archived": false, "released": true, "releaseDate": "2025-07-30"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [{"id": "12710661", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12710661", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "outwardIssue": {"id": "13558516", "key": "HIVE-27887", "self": "https://issues.apache.org/jira/rest/api/2/issue/13558516", "fields": {"summary": "Provide reasonable defaults for ResultSetMetaData", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}}}}, {"id": "12710691", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12710691", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "inwardIssue": {"id": "13632825", "key": "HIVE-29296", "self": "https://issues.apache.org/jira/rest/api/2/issue/13632825", "fields": {"summary": "Remove getPrimaryKeys codes from beeline module", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/10002", "description": "A patch for this issue has been uploaded to JIRA by a contributor.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/document.png", "name": "Patch Available", "id": "10002", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4", "id": 4, "key": "indeterminate", "colorName": "yellow", "name": "In Progress"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}}}}], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12324409", "id": "12324409", "name": "Beeline"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29213/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@36aaa767[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@379981f3[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ac5a8bd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@5128320f[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6f425161[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1b7aa7cd[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1c7d745f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@c558595[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@71e10427[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3feb9119[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48c3d537[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@689a8897[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310843", "id": "12310843", "key": "HIVE", "name": "Hive", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292", "id": "10292", "description": "Scalable Distributed Computing", "name": "Hadoop"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Fri Oct 31 10:24:59 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29213/watchers", "watchCount": 4, "isWatching": false}, "created": "2025-09-18T08:58:24.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-10-31T10:24:59.000+0000", "timeoriginalestimate": null, "description": "HIVE-19996 fixed a performance issue related to beeline. However, this fix causes a warning exception \"Failed to get primary keys\" to appear in the HS2 logs when using a beeline client that does not include this patch (such as Hive 4.1.0) to submit SQL queries to Hive 4.2.0.\r\n\r\n \r\n\r\nHere is a simple test procedure:\r\n # Use the Hive 4.1.0 beeline client to connect to the latest version of Hive 4.2.0 (which includes HIVE-19996).\r\n\r\n// Create a test table\r\ncreate table testdb.test12(id int);\r\n\r\n{color:#de350b}*// Query this table, and you will notice the following exception: Failed to get primary keys ..*{color}\r\nselect * from testdb.test12;\r\n{code:java}\r\n2025-09-18T16:22:34,121 ERROR [HiveServer2-Handler-Pool: Thread-166] thrift.ThriftCLIService: Failed to get primary keys [request: TGetPrimaryKeysReq(sessionHandle:TSessionHandle(sessionId:THandleIdentifier(guid:56 22 37 10 00 2D 4B BB B6 FE 42 49 E2 25 75 1F, secret:C7 E6 BF 96 D1 82 4E F5 82 36 AC A7 A1 3E 7A A6)), catalogName:, tableName:test12)]\r\norg.apache.hive.service.cli.HiveSQLException: org.apache.thrift.protocol.TProtocolException: Required field 'db_name' is unset! Struct:PrimaryKeysRequest(db_name:null, tbl_name:test12, catName:hive)\r\n        at org.apache.hive.service.cli.operation.GetPrimaryKeysOperation.runInternal(GetPrimaryKeysOperation.java:120) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.operation.Operation.run(Operation.java:286) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionImpl.getPrimaryKeys(HiveSessionImpl.java:998) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[?:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:78) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy$1.run(HiveSessionProxy.java:63) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:714) ~[?:?]\r\n        at java.base/javax.security.auth.Subject.doAs(Subject.java:525) ~[?:?]\r\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1953) ~[hadoop-common-3.4.1.jar:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:59) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at jdk.proxy2/jdk.proxy2.$Proxy41.getPrimaryKeys(Unknown Source) ~[?:?]\r\n        at org.apache.hive.service.cli.CLIService.getPrimaryKeys(CLIService.java:416) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.GetPrimaryKeys(ThriftCLIService.java:919) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$GetPrimaryKeys.getResult(TCLIService.java:1870) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$GetPrimaryKeys.getResult(TCLIService.java:1850) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:250) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]\r\n        at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]\r\nCaused by: org.apache.thrift.protocol.TProtocolException: Required field 'db_name' is unset! Struct:PrimaryKeysRequest(db_name:null, tbl_name:test12, catName:hive)\r\n        at org.apache.hadoop.hive.metastore.api.PrimaryKeysRequest.validate(PrimaryKeysRequest.java:591) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$get_primary_keys_args.validate(ThriftHiveMetastore.java) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$get_primary_keys_args$get_primary_keys_argsStandardScheme.write(ThriftHiveMetastore.java) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$get_primary_keys_args$get_primary_keys_argsStandardScheme.write(ThriftHiveMetastore.java) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$get_primary_keys_args.write(ThriftHiveMetastore.java) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TServiceClient.sendBase(TServiceClient.java:71) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TServiceClient.sendBase(TServiceClient.java:62) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.send_get_primary_keys(ThriftHiveMetastore.java:4926) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.get_primary_keys(ThriftHiveMetastore.java:4918) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.ThriftHiveMetaStoreClient.getPrimaryKeys(ThriftHiveMetaStoreClient.java:2393) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.getPrimaryKeys(MetaStoreClientWrapper.java:1081) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT] {code}\r\n*{color:#de350b}// show  tables， then you will find new exceptions：client.ThriftHiveMetaStoreClient: Got error flushing the cache org.apache.thrift.TApplicationException: Unrecognized type -128{color}*\r\n\r\n\r\nshow tables;\r\n{code:java}\r\n2025-09-18T16:22:39,771  INFO [56223710-002d-4bbb-b6fe-4249e225751f HiveServer2-Handler-Pool: Thread-166] ql.Driver: Compiling command(queryId=hive_20250918162239_69ae0c6e-309f-4b87-a2c4-8093ae4700e8): show tables\r\n2025-09-18T16:22:39,771  WARN [56223710-002d-4bbb-b6fe-4249e225751f HiveServer2-Handler-Pool: Thread-166] client.ThriftHiveMetaStoreClient: Got error flushing the cache\r\norg.apache.thrift.TApplicationException: Unrecognized type -128\r\n        at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:79) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.recv_flushCache(ThriftHiveMetastore.java:7493) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.flushCache(ThriftHiveMetastore.java:7481) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.ThriftHiveMetaStoreClient.flushCache(ThriftHiveMetaStoreClient.java:2541) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.flushCache(MetaStoreClientWrapper.java:1043) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.flushCache(MetaStoreClientWrapper.java:1043) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.flushCache(MetaStoreClientWrapper.java:1043) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[?:?]\r\n        at org.apache.hadoop.hive.metastore.client.SynchronizedMetaStoreClient$SynchronizedHandler.invoke(SynchronizedMetaStoreClient.java:69) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at jdk.proxy2/jdk.proxy2.$Proxy32.flushCache(Unknown Source) ~[?:?]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.flushCache(MetaStoreClientWrapper.java:1043) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[?:?]\r\n        at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.invoke(RetryingMetaStoreClient.java:232) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at jdk.proxy2/jdk.proxy2.$Proxy32.flushCache(Unknown Source) ~[?:?]\r\n        at org.apache.hadoop.hive.ql.Compiler.analyze(Compiler.java:198) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.Compiler.compile(Compiler.java:109) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:498) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:450) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:414) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:408) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:126) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:205) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:268) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.operation.Operation.run(Operation.java:286) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:558) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:543) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[?:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:78) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy$1.run(HiveSessionProxy.java:63) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:714) ~[?:?]\r\n        at java.base/javax.security.auth.Subject.doAs(Subject.java:525) ~[?:?]\r\n        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1953) ~[hadoop-common-3.4.1.jar:?]\r\n        at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:59) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at jdk.proxy2/jdk.proxy2.$Proxy41.executeStatementAsync(Unknown Source) ~[?:?]\r\n        at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:315) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:652) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1670) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:1650) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:38) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:56) ~[hive-service-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:250) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]\r\n        at java.base/java.lang.Thread.run(Thread.java:1583) [?:?]\r\n2025-09-18T16:22:39,773  WARN [56223710-002d-4bbb-b6fe-4249e225751f HiveServer2-Handler-Pool: Thread-166] metastore.RetryingMetaStoreClient: MetaStoreClient lost connection. Attempting to reconnect (1 of 1) after 1s. getDatabase\r\norg.apache.thrift.transport.TTransportException: Socket is closed by peer.\r\n        at org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:184) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.transport.TTransport.readAll(TTransport.java:109) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:464) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:362) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:245) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:77) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.recv_get_database_req(ThriftHiveMetastore.java:1497) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.get_database_req(ThriftHiveMetastore.java:1484) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.ThriftHiveMetaStoreClient.getDatabase(ThriftHiveMetaStoreClient.java:1979) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.getDatabase(MetaStoreClientWrapper.java:211) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.getDatabase(SessionHiveMetaStoreClient.java:2281) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at org.apache.hadoop.hive.metastore.client.MetaStoreClientWrapper.getDatabase(MetaStoreClientWrapper.java:211) ~[hive-exec-4.2.0-SNAPSHOT.jar:4.2.0-SNAPSHOT]\r\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[?:?]\r\n {code}\r\n \r\n\r\n \r\n\r\n{color:#172b4d}HIVE-19996 may have broken the backward compatibility of beeline. Accessing Hive 4.2 through the Hive 4.1 beeline client should theoretically not present compatibility issues. We need to ensure backward compatibility as much as possible to provide users with a smooth experience.{color}", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12310320": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12356025", "id": "12356025", "name": "4.2.0", "archived": false, "released": false}], "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "HS2 report 'Failed to get primary keys' if using old beeline client", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18032804", "id": "18032804", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "body": "[~zhangbutao] is that a backward incompatibility issue? older beeline clients are unable to perform any SELECT operations?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-24T15:36:00.846+0000", "updated": "2025-10-24T15:47:24.932+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18032805", "id": "18032805", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "body": "cc [~InvisibleProgrammer]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-24T15:39:01.558+0000", "updated": "2025-10-24T15:39:01.558+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18032906", "id": "18032906", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "{code:java}\r\nis that a backward incompatibility issue? older beeline clients are unable to perform any SELECT operations?{code}\r\n \r\n\r\n[~dkuzmenko] I think this is a backward incompatibility issue.  For older beeline clients(4.1.0), while they can perform SELECT query operations, the query latency is significantly higher compared to new beeline clients(4.2.0). For example, when executing a query like `SELECT * FROM table` using `FETCH TASK` (with `set hive.fetch.task.conversion=more`), the old client takes over 1 second to return results, and error messages appear in the HS2 logs. In contrast, the new client only requires 0.1 seconds to return results. When using the old client, this creates a misconception for users that Hive is experiencing performance issues.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-25T02:45:42.521+0000", "updated": "2025-10-25T02:45:42.521+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033184", "id": "18033184", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "body": "Regarding the two exceptions reported above, is it confirmed that both are caused by HIVE-19996? Does reverting HIVE-19996 make all errors go away?\r\n\r\nGenerally mixing older vs newer binaries is not something really recommended and its not officially supported either. To exaggerate a bit someone may come and say that Beeline 0.11.0 cannot connect to HS2 4.2.0 but I don't think we would consider this a big deal. In a perfect world, everything should be backward and forward compatible but this is rarely the case in most software releases.\r\n\r\nAnyways, if somebody sees an easy way to fix the issue reported here then we can definitely do it and include it in the release but personally I wouldn't consider this a release blocker.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zabetak", "name": "zabetak", "key": "zabetak", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zabetak&avatarId=36449", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zabetak&avatarId=36449", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zabetak&avatarId=36449", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zabetak&avatarId=36449"}, "displayName": "Stamatis Zampetakis", "active": true, "timeZone": "Europe/Paris"}, "created": "2025-10-27T11:09:27.822+0000", "updated": "2025-10-27T11:09:27.822+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033210", "id": "18033210", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "body": "Introducing backward incompatibility in MINOR releases doesn’t seem appropriate", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dkuzmenko", "name": "dkuzmenko", "key": "dkuzmenko", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Denys Kuzmenko", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-27T12:19:30.395+0000", "updated": "2025-10-27T12:19:30.395+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033342", "id": "18033342", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=InvisibleProgrammer", "name": "InvisibleProgrammer", "key": "JIRAUSER290460", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Zsolt Miskolczi", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi, I tried to reproduce the issue but couldn't: \r\n * Picked up a 4.1.0 beeline client\r\n * Built the current master\r\n * ran minihs2 cluter\r\n * ran the scripts provided (as an extra, created the database testdb)\r\n\r\nGot no error at all. It worked fine, no errors. \r\n\r\n\r\n{noformat}\r\nConnecting to jdbc:hive2://localhost:10000/\r\nConnected to: Apache Hive (version 4.2.0-SNAPSHOT)\r\nDriver: Hive JDBC (version 4.1.0)\r\nTransaction isolation: TRANSACTION_REPEATABLE_READ\r\nBeeline version 4.1.0 by Apache Hive{noformat}", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=InvisibleProgrammer", "name": "InvisibleProgrammer", "key": "JIRAUSER290460", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Zsolt Miskolczi", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-27T21:54:32.604+0000", "updated": "2025-10-27T21:54:32.604+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033397", "id": "18033397", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "[~InvisibleProgrammer] I did not use the minihs2 cluster mode; I used the standard local deployment mode, with the backend metadata stored in MySQL. I'm not sure if the deployment differences are causing this. But I have tested many times and this issue persists.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-28T01:30:34.981+0000", "updated": "2025-10-28T01:30:34.981+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033398", "id": "18033398", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "[~zabetak] You make a valid point. It seems we never explicitly promised that older beeline clients would be fully compatible with newer versions of the HS2 cluster. However, I believe that in practice, many users will still use older beeline clients to access newer HS2 versions, as users generally assume that beeline clients offer compatibility guarantees—similar to how MySQL clients can typically connect to different versions of MySQL servers. Therefore, I think we should strive to ensure that beeline clients can access different versions of HS2 as compatibly as possible, in order to provide a better user experience.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-28T01:39:25.945+0000", "updated": "2025-10-28T01:39:25.945+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033412", "id": "18033412", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "Sorry, this issue might be related to my mixed use of HMS metadata from versions 4.1.0 and 4.2.0. Since I assumed that no new metadata fields were added in the recent 4.2.0 release, I deployed both 4.1.0 and 4.2.0 clusters sharing a single metadata database (version 4.2.0). This might have caused some anomalies. Therefore, you folks can temporarily set this issue aside and i will continue investigating my local metadata configuration. If it’s confirmed to be solely due to the mixed use of metadata, I will update and close this ticket.\r\n\r\nAdditionally, this ticket does not block the release of version 4.2.0, so you can skip this issue for now. Thank you.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-28T03:29:47.854+0000", "updated": "2025-10-28T03:29:47.854+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033761", "id": "18033761", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "I have deployed Hive 4.0.1, 4.1.0, and 4.2.0 locally, each using its own HMS metadata to avoid issues caused by mixed metadata usage. After debugging the beeline/jdbc modules of these three versions, I finally identified the root cause of this issue.\r\n\r\nPrior to version 4.1.0, the *Rows::isPrimaryKey* method would call `{*}HiveResultSetMetaData::getTableName{*}` to retrieve the table name:  \r\n[https://github.com/apache/hive/blob/2d1405e7feed176aeed337581292b8438cf13326/beeline/src/java/org/apache/hive/beeline/Rows.java#L86] \r\n\r\nHowever, before version 4.1.0, the `HiveResultSetMetaData::getTableName` method was not implemented:  \r\n[https://github.com/apache/hive/blob/2d1405e7feed176aeed337581292b8438cf13326/jdbc/src/java/org/apache/hive/jdbc/HiveResultSetMetaData.java#L102] \r\n\r\nAs a result, the `{*}Rows::isPrimaryKey{*}` method would catch an exception and terminate, without sending a Thrift RPC request to call `{*}HiveDatabaseMetaData::getPrimaryKeys(String catalog, String schema, String table)`{*} to retrieve primary key information related to the table. In other words, before version 4.1.0, the beeline client never actually executed the `HiveDatabaseMetaData::getPrimaryKeys` method.  \r\n{color:#de350b}It is worth noting that HIVE-19996  mentions \"Beeline performance poor with drivers having slow DatabaseMetaData.getPrimaryKeys impl.\" I believe this issue should not have existed before version 4.1.0, as I mentioned above{*},{*} the beeline client never actually executed the `HiveDatabaseMetaData::getPrimaryKeys` method.{color}\r\n\r\nIn version 4.1.0, HIVE-27887 implemented `{*}HiveResultSetMetaData::getTableName{*}`:  \r\n[https://github.com/apache/hive/blob/75e40b7537c91a70ccaa31c397d21823c7528eeb/jdbc/src/java/org/apache/hive/jdbc/HiveResultSetMetaData.java#L113] \r\n\r\nThus, the `{*}Rows::isPrimaryKey{*}` method executed normally and sent a Thrift RPC request to call `{*}HiveDatabaseMetaData::getPrimaryKeys(String catalog, String schema, String table){*}` to retrieve primary key information related to the table:  \r\n[https://github.com/apache/hive/blob/75e40b7537c91a70ccaa31c397d21823c7528eeb/beeline/src/java/org/apache/hive/beeline/Rows.java#L92] \r\n\r\nHowever, in the Beeline module, there is currently no way to retrieve the catalog and schema. The catalog is an empty string, and the schema (i.e., db_name) is null. A null schema (db_name) causes the RPC method call to throw an exception because the Thrift definition prohibits db_name from being null:  \r\n[https://github.com/apache/hive/blob/75e40b7537c91a70ccaa31c397d21823c7528eeb/standalone-metastore/metastore-common/src/main/thrift/hive_metastore.thrift#L754] \r\n\r\nThe error message is as follows:  \r\n{code:java}\r\n2025-09-18T16:22:34,121 ERROR [HiveServer2-Handler-Pool: Thread-166] thrift.ThriftCLIService: Failed to get primary keys [request: TGetPrimaryKeysReq(sessionHandle:TSessionHandle(sessionId:THandleIdentifier(guid:56 22 37 10 00 2D 4B BB B6 FE 42 49 E2 25 75 1F, secret:C7 E6 BF 96 D1 82 4E F5 82 36 AC A7 A1 3E 7A A6)), catalogName:, tableName:test12)]\r\norg.apache.hive.service.cli.HiveSQLException: org.apache.thrift.protocol.TProtocolException: Required field 'db_name' is unset! Struct:PrimaryKeysRequest(db_name:null, tbl_name:test12, catName:hive){code}\r\n*Therefore, in version 4.1.0, HIVE-27887 inadvertently triggered the execution of `HiveDatabaseMetaData::getPrimaryKeys`, leading to this exception.*\r\n\r\n \r\n\r\nThen, in version 4.2.0, HIVE-29118 optimized the method call of `{*}Rows::isPrimaryKey{*}`, ensuring that `{*}Rows::isPrimaryKey{*}` and `{*}HiveDatabaseMetaData::getPrimaryKeys{*}` are only triggered when the `--color` option is specified, i.e.:  \r\n{code:java}\r\n./apache-hive-4.2.0-bin/bin/beeline -u jdbc:hive2://127.0.0.1:10000/default hive --color=true{code}\r\n{color:#de350b}*Thus, in version 4.2.0, if you use `beeline --color` to execute a SELECT query, the same exception will occur.*{color}\r\n\r\n \r\n\r\nIn summary, before version 4.1.0 (HIVE-27887), we never actually retrieved the primary key of a table on the beeline side. After version 4.1.0 (HIVE-27887), since we cannot retrieve the actual db_name and catalog on the beeline side, the call to `{*}HiveDatabaseMetaData::getPrimaryKeys(String catalog, String schema, String table){*}` throws an exception. I believe retrieving the primary key of a table on the beeline side is meaningless (the original purpose was only for coloring the beeline output). {color:#de350b}*We do not need to investigate how to retrieve the correct db_name to ensure the method executes properly. I believe removing this code logic would suffice.*{color}", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-29T08:04:41.195+0000", "updated": "2025-10-29T08:04:41.195+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18033798", "id": "18033798", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "Let me continue with some additional points. I just noticed that it's not only Hive that uses the Beeline client; other components like Impala and HBase also utilize the Beeline component. Therefore, the relevant primary key code in Beeline—specifically `DatabaseMetaData.getPrimaryKeys`—though never used by Hive prior to Hive 4.1.0, might have been consistently used by HBase. This could very well be the source of the issue reported in HIVE-19996.\r\n\r\nThis makes it quite interesting: the Beeline codes related to primary key in Hive that has never been utilized by Hive itself but is actively used by other components.\r\n\r\nNevertheless, I still recommend removing the usage of `DatabaseMetaData.getPrimaryKeys` in Beeline. First, fixing this exception on the Hive side is neither easy nor meaningful;  Second, as mentioned above, the purpose of retrieving primary keys in Beeline is solely for coloring the output results. Removing this code would not cause any compatibility issues and would actually improve Beeline's performance, as it avoids the heavyweight Thrift RPC call to the server for fetching primary keys.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-29T11:10:31.303+0000", "updated": "2025-10-29T11:10:31.303+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18034078", "id": "18034078", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "body": "Created a new ticket HIVE-29296 to remove the getPrimaryKeys codes from beeline module", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=zhangbutao", "name": "zhangbutao", "key": "zhangbutao", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10432", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10432", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10432", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10432"}, "displayName": "Butao Zhang", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-30T02:32:30.512+0000", "updated": "2025-10-30T02:32:30.512+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13629296/comment/18034368", "id": "18034368", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=InvisibleProgrammer", "name": "InvisibleProgrammer", "key": "JIRAUSER290460", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Zsolt Miskolczi", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi, \r\n\r\n \r\n\r\nThank you for bringing up this issue. \r\n\r\nFirstly, I totally agree with removing that functionality from Beeline entirely. I suggested the same when we met with the performance problem here: [https://lists.apache.org/thread/mk7b51bwcd53k5jcdsyyyvbrogsqm2bw]\r\n\r\nI hope https://issues.apache.org/jira/browse/HIVE-29296 will pass through the review. \r\n\r\n \r\n\r\nSecondly, I'm not arguing, just want to get a clear picture of the requirements of backward compatibility: If I understood the situation correctly, a change made just today, can break up the functionality with a version delivered yesterday. In software development, it is pretty standard. I know Beeline can be a special case, as it could be a standalone software, delivered independently from Hive. My question is: do we have some boundaries about how many releases Beeline should support backward? \r\n\r\n \r\n\r\nOther question: what is your opinion, does it make sense to detach Beeline on the repository level from Hive? If we don't only use it for Hive, and a given Beeline release has to support multiple versions of Hive, HBase, Impala, etc, maybe it is easier to do development and testing if it can be compiled without Hive. ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=InvisibleProgrammer", "name": "InvisibleProgrammer", "key": "JIRAUSER290460", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Zsolt Miskolczi", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-31T10:24:59.066+0000", "updated": "2025-10-31T10:24:59.066+0000"}], "maxResults": 13, "total": 13, "startAt": 0}, "customfield_12311820": "0|z1xrbs:", "customfield_12314139": null}}