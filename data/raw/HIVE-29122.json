{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13625588", "self": "https://issues.apache.org/jira/rest/api/2/issue/13625588", "key": "HIVE-29122", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12356025", "id": "12356025", "name": "4.2.0", "archived": false, "released": false}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12356025", "id": "12356025", "name": "4.2.0", "archived": false, "released": false}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=soumyakanti.das", "name": "soumyakanti.das", "key": "soumyakanti.das", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Soumyakanti Das", "active": true, "timeZone": "Etc/UTC"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12321300", "id": "12321300", "name": "Vectorization", "description": "Vectorized query execution"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=soumyakanti.das", "name": "soumyakanti.das", "key": "soumyakanti.das", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Soumyakanti Das", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=soumyakanti.das", "name": "soumyakanti.das", "key": "soumyakanti.das", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "Soumyakanti Das", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29122/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3398d49[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d524bac[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74f61aaf[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4b4630b6[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7a6150c1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@15be84a8[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5159d7d2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@2b609ecf[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5b77343a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3a8d6038[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@25f5c7fc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@acca36b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310843", "id": "12310843", "key": "HIVE", "name": "Hive", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292", "id": "10292", "description": "Scalable Distributed Computing", "name": "Hadoop"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Mon Aug 11 12:37:50 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-08-11T12:37:50.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29122/watchers", "watchCount": 1, "isWatching": false}, "created": "2025-08-05T23:59:21.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-26T06:03:08.000+0000", "timeoriginalestimate": null, "description": "Currently we get wrong results for FIRST_VALUE and LAST_VALUE functions with IGNORE NULLS when vectorization is enabled.\r\n\r\nConsider this table:\r\n{noformat}\r\nCREATE TABLE window_double_test (\r\n  id INT,\r\n  double_col DOUBLE\r\n);\r\n\r\nINSERT INTO window_double_test VALUES\r\n  (1, NULL),\r\n  (2, NULL),\r\n  (1, NULL),\r\n  (1, NULL),\r\n  (2, 25.5),\r\n  (3, NULL),\r\n  (6, 65.5),\r\n  (2, NULL),\r\n  (3, 32.5),\r\n  (4, NULL),\r\n  (3, 30.5),\r\n  (5, 50.5),\r\n  (4, 42.3),\r\n  (5, NULL),\r\n  (6, 65.2),\r\n  (7, NULL),\r\n  (NULL, 80.5),\r\n  (NULL, NULL);{noformat}\r\nNon-vectorized:\r\n{noformat}\r\nset hive.vectorized.execution.enabled=false;\r\nSELECT id, double_col,\r\n  FIRST_VALUE(double_col) IGNORE NULLS OVER(ORDER BY id) AS first_double,\r\n  LAST_VALUE(double_col) IGNORE NULLS OVER(ORDER BY id) AS last_double\r\nFROM window_double_test;\r\n\r\n\r\nid  double_col first_double last_double\r\n1 NULL NULL NULL\r\n1 NULL NULL NULL\r\n1 NULL NULL NULL\r\n2 NULL 25.5 25.5\r\n2 25.5 25.5 25.5\r\n2 NULL 25.5 25.5\r\n3 NULL 25.5 32.5\r\n3 30.5 25.5 32.5\r\n3 32.5 25.5 32.5\r\n4 NULL 25.5 42.3\r\n4 42.3 25.5 42.3\r\n5 50.5 25.5 50.5\r\n5 NULL 25.5 50.5\r\n6 65.2 25.5 65.5\r\n6 65.5 25.5 65.5\r\n7 NULL 25.5 65.5\r\nNULL  NULL 25.5 80.5\r\nNULL  80.5 25.5 80.5{noformat}\r\nVectorized:\r\n{noformat}\r\nset hive.vectorized.execution.enabled=true;\r\nSELECT id, double_col,\r\n  FIRST_VALUE(double_col) IGNORE NULLS OVER(ORDER BY id) AS first_double,\r\n  LAST_VALUE(double_col) IGNORE NULLS OVER(ORDER BY id) AS last_double\r\nFROM window_double_test;\r\n\r\n\r\nid  double_col first_double last_double\r\n1 NULL NULL NULL\r\n1 NULL NULL NULL\r\n1 NULL NULL NULL\r\n2 NULL NULL NULL\r\n2 25.5 NULL NULL\r\n2 NULL NULL NULL\r\n3 NULL NULL 32.5\r\n3 30.5 NULL 32.5\r\n3 32.5 NULL 32.5\r\n4 NULL NULL 42.3\r\n4 42.3 NULL 42.3\r\n5 50.5 NULL NULL\r\n5 NULL NULL NULL\r\n6 65.2 NULL 65.5\r\n6 65.5 NULL 65.5\r\n7 NULL NULL NULL\r\nNULL  NULL NULL 80.5\r\nNULL  80.5 NULL 80.5{noformat}\r\nWe can see the differences for id = 2, for example. Similar results can also be seen for int and decimal columns too. We don't see the same for a String column as only LONG, DECIMAL, and DOUBLE are supported, as can be seen in Vectorizer#validatePTFOperator.\r\n\r\nThere are other scenarios where it bypasses the Vectorizer, for example, if we explicitly use ROWS instead of the default RANGE, etc. Anything that skips vectorization produces correct results.", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12310320": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Vectorization - Support IGNORE NULLS for FIRST_VALUE and LAST_VALUE", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13625588/comment/18013214", "id": "18013214", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=krisztiankasa", "name": "krisztiankasa", "key": "krisztiankasa", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Krisztian Kasa", "active": true, "timeZone": "Etc/UTC"}, "body": "Merged to master. Thanks [~soumyakanti.das] for the patch and [~dkuzmenko] for the review.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=krisztiankasa", "name": "krisztiankasa", "key": "krisztiankasa", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Krisztian Kasa", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-08-11T12:37:50.902+0000", "updated": "2025-08-11T12:37:50.902+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "customfield_12311820": "0|z1x4dc:", "customfield_12314139": null}}