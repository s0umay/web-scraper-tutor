{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13631145", "self": "https://issues.apache.org/jira/rest/api/2/issue/13631145", "key": "ZOOKEEPER-4987", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/1", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg", "name": "Blocker", "id": "1"}, "labels": [], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12354432", "id": "12354432", "description": "", "name": "3.9.3", "archived": false, "released": true, "releaseDate": "2024-10-24"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312381", "id": "12312381", "name": "java client", "description": "The java client interface for ZooKeeper"}, {"self": "https://issues.apache.org/jira/rest/api/2/component/12312385", "id": "12312385", "name": "jute", "description": "Data marshalling code generator for ZooKeeper"}, {"self": "https://issues.apache.org/jira/rest/api/2/component/12333125", "id": "12333125", "name": "other"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4987/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@487b685b[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f463404[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@65617f8e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1bf99132[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@26cd67ea[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@fea7597[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6199e6eb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@36be8beb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7b0158e1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@271bccdb[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@99bc86d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4b38eb66[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Tue Oct 14 12:01:39 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4987/watchers", "watchCount": 2, "isWatching": false}, "created": "2025-10-09T13:36:31.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-10-14T12:01:39.000+0000", "timeoriginalestimate": null, "description": "Hi we have 2 microservices, 1. zookeeper based 2. kafka based\r\n\r\nFor zookeeper configuration , we have configured with below parameters related to tls - \r\n\r\n    ssl.protocol=TLSv1.3\r\n    ssl.quorum.protocol=TLSv1.3\r\n    ssl.enabledProtocols=TLSv1.3,TLSv1.2\r\n    ssl.quorum.enabledProtocols=TLSv1.3,TLSv1.2\r\n\r\nAlso jvm opts for zookeeper we have below opts - -Djdk.tls.client.protocols=TLSv1.3,TLSv1.2 -Dhttps.protocols=TLSv1.3,TLSv1.2\r\n\r\nFrom kafka side we are setting below 2 configuration parameters in properties file  which is used to start kafka server - \r\n\r\n  zookeeper.ssl.protocol: \"TLSv1.3\"\r\n  zookeeper.ssl.enabled.protocols: \"TLSv1.3,TLSv1.2\"\r\n\r\n \r\n\r\nfor kafka , we have below opts for jvm\r\n\r\n-Djdk.tls.client.protocols=TLSv1.3,TLSv1.2 -Dhttps.protocols=TLSv1.3,TLSv1.2\r\n\r\n \r\n\r\nZookeeper server version - 3.8.4\r\n\r\nKafka server version - 3.9.0\r\n\r\ninside kafka java class load path we are adding zookeeper server binary, because its zookeeper client component used by kafka for communicating with zookeeper server.\r\n\r\nSo that zookeeper client version is 3.9.2\r\n\r\n \r\n\r\nNow it was observed that, kafka uses TLSv1.3 to communicate with zookeeper which is okay, because zookeeper support both TLSv1.2 and TLSv1.3.\r\n\r\nBut if I dont set TLS1.3 related ciphers  and only set TLS1.2 related ciphers to zookeeper, ideally kafka also fallback to TLS1.2 and keep using TLSv1.2 for ssl handshake. But that doesnt happen.\r\n\r\nAs we have set only TLS1.2 related ciphers to zookeeper, zookeeper server falls back to TLS1.2 and expects that kafka should use TLS1.2 only but kafka still uses TLS1.3 and below error messages are printed in zookeeper logs - and kafka pods doesnt come up - \r\n\r\n \r\n\r\n{\"message\":\"Caused by: javax.net.ssl.SSLHandshakeException: The client supported protocol versions [TLSv1.3] are not accepted by server preferences [TLSv1.2]\",\"metadata\":\\{\"container_name\":\"zookeeper\",\"namespace\":\"namespace1\",\"pod_name\":\"zookeeper-0\"},\"service_id\":\"zookeeper\",\"severity\":\"info\",\"timestamp\":\"2025-10-09T08:50:15.443+00:00\",\"version\":\"1.2.0\"}\r\n{\"message\":\"\\tat java.base/sun.security.ssl.Alert.createSSLException(Alert.java:131)\",\"metadata\":\\{\"container_name\":\"zookeeper\",\"namespace\":\"namespace1\",\"pod_name\":\"zookeeper-0\"},\"service_id\":\"zookeeper\",\"severity\":\"info\",\"timestamp\":\"2025-10-09T08:50:15.443+00:00\",\"version\":\"1.2.0\"}\r\n{\"message\":\"\\tat java.base/sun.security.ssl.Alert.createSSLException(Alert.java:117)\",\"metadata\":\\{\"container_name\":\"zookeeper\",\"namespace\":\"namespace1\",\"pod_name\":\"zookeeper-0\"},\"service_id\":\"zookeeper\",\"severity\":\"info\",\"timestamp\":\"2025-10-09T08:50:15.443+00:00\",\"version\":\"1.2.0\"}\r\n\r\n \r\n\r\n \r\n\r\n ", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "zookeeper client fails to fallback to tls1.2 when tls1.3 ciphers are not correct / zookeeper client fails to fallback to tls1.3 when tls1.2 ciphers are not correct", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": "Dockerized environment\r\n\r\nusing jdk 17 \r\n\r\n ", "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13631145/comment/18029002", "id": "18029002", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~kezhuw] \r\n\r\nCould you please provide some support? that would be helpful \r\n\r\n \r\n\r\nThanks", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-10T10:39:05.087+0000", "updated": "2025-10-10T10:39:05.087+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631145/comment/18029444", "id": "18029444", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "body": "Hi [~tsaarni] \r\n\r\nCould you please provide some support? that would be helpful \r\n\r\n \r\n\r\nThanks in advance", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=xsasahu", "name": "xsasahu", "key": "xsasahu", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Santosh Kumar Sahu", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-13T09:19:33.236+0000", "updated": "2025-10-13T09:19:33.236+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13631145/comment/18029758", "id": "18029758", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tsaarni", "name": "tsaarni", "key": "JIRAUSER285792", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER285792&avatarId=49529", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER285792&avatarId=49529", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER285792&avatarId=49529", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER285792&avatarId=49529"}, "displayName": "Tero Saarni", "active": true, "timeZone": "Etc/UTC"}, "body": "The following Kafka settings work for the Zookeeper client when Zookeeper server was configured with the default enabled protocols (TLSv1.3 and TLSv1.2) but server is restricted to only TLSv1.2 ciphers:\r\n\r\nzookeeper.ssl.client.enable=true \r\nzookeeper.ssl.protocol = TLSv1.3 \r\nzookeeper.ssl.enabled.protocols = TLSv1.2, TLSv1.3 \r\nzookeeper.clientCnxnSocket=org.apache.zookeeper.ClientCnxnSocketNetty", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tsaarni", "name": "tsaarni", "key": "JIRAUSER285792", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER285792&avatarId=49529", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER285792&avatarId=49529", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER285792&avatarId=49529", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER285792&avatarId=49529"}, "displayName": "Tero Saarni", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-10-14T12:01:39.767+0000", "updated": "2025-10-14T12:01:39.767+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "customfield_12311820": "0|z1y2qg:", "customfield_12314139": null}}