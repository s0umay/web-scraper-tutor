{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13621180", "self": "https://issues.apache.org/jira/rest/api/2/issue/13621180", "key": "ZOOKEEPER-4940", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12355230", "id": "12355230", "description": "", "name": "3.9.4", "archived": false, "released": true, "releaseDate": "2025-08-29"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12354432", "id": "12354432", "description": "", "name": "3.9.3", "archived": false, "released": true, "releaseDate": "2024-10-24"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [{"id": "12705367", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12705367", "type": {"id": "12310460", "name": "Child-Issue", "inward": "is a child of", "outward": "is a parent of", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310460"}, "inwardIssue": {"id": "13622681", "key": "ZOOKEEPER-4949", "self": "https://issues.apache.org/jira/rest/api/2/issue/13622681", "fields": {"summary": "Clean up TLS CRL/OCSP configuration", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}}}}, {"id": "12704665", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12704665", "type": {"id": "12310560", "name": "Problem/Incident", "inward": "is caused by", "outward": "causes", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310560"}, "inwardIssue": {"id": "13485657", "key": "ZOOKEEPER-4622", "self": "https://issues.apache.org/jira/rest/api/2/issue/13485657", "fields": {"summary": "Add Netty-TcNative OpenSSL Support", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}}}}], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12329414", "id": "12329414", "name": "security"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "aggregateprogress": {"progress": 23400, "total": 23400, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 23400, "total": 23400, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4940/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 39, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973857", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2192960833\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   What about using `OpenSsl.isAvailable()` and `OpenSsl.isOcspSupported()` together?\n\n\n\n", "created": "2025-07-08T16:30:13.552+0000", "updated": "2025-07-08T16:30:13.552+0000", "started": "2025-07-08T16:30:13.551+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973857", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973859", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2192964233\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   In think we should rename this to `ssl.ocsp.stapling` and `ssl.quorum.ocsp.stapling`. As you mention in the description, the feature is only available when native OpenSSL library is in use, otherwise setting this is a no-op.\n\n\n\n", "created": "2025-07-08T16:32:03.353+0000", "updated": "2025-07-08T16:32:03.353+0000", "started": "2025-07-08T16:32:03.352+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973859", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973863", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2192989031\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   \"Trying to enable OCSP stapling, but the selected SSL provider {name} doesn't support it\"\n\n\n\n", "created": "2025-07-08T16:45:14.416+0000", "updated": "2025-07-08T16:45:14.416+0000", "started": "2025-07-08T16:45:14.416+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973863", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973864", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2192989031\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   \"Trying to enable OCSP stapling, but the selected SSL provider {name} doesn't support it. Ignored.\"\n\n\n\n", "created": "2025-07-08T16:45:29.667+0000", "updated": "2025-07-08T16:45:29.667+0000", "started": "2025-07-08T16:45:29.667+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973864", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973867", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2193127088\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   There are two distinct ways to enable (request) OCSP stapling depending on the TLS provider:\r\n   \r\n   https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ocsp.html#setting-up-a-java-client-to-use-ocsp-stapling\r\n   \r\n   \"ssl.ocsp.stapling\" would mask the fact that this is only for the netty tcnative/openssl provider.\r\n   \r\n   We could use \"ssl.tcnative.ocsp.stapling\"  or \"ssl.openssl.ocsp.stapling\" .\r\n   \n\n\n\n", "created": "2025-07-08T17:58:01.075+0000", "updated": "2025-07-08T17:58:01.075+0000", "started": "2025-07-08T17:58:01.073+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973867", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973868", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2193146205\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   There is no API to get the tcnative implementation name.\r\n   \r\n   The closest thing I could find is OpenSsl.versionString() .\n\n\n\n", "created": "2025-07-08T18:09:45.724+0000", "updated": "2025-07-08T18:09:45.724+0000", "started": "2025-07-08T18:09:45.723+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973868", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973869", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2193150616\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   I went for ssl.tcnative.ocsp.stapling for now, LMK if that's acceptable to you, @anmolnar .\n\n\n\n", "created": "2025-07-08T18:12:00.897+0000", "updated": "2025-07-08T18:12:00.897+0000", "started": "2025-07-08T18:12:00.896+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973869", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/973871", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2193162482\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   Would you like to add that to the log line ?\n\n\n\n", "created": "2025-07-08T18:18:11.244+0000", "updated": "2025-07-08T18:18:11.244+0000", "started": "2025-07-08T18:18:11.244+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "973871", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974874", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2211511647\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   What does `sslProvider.toString()` give?\n\n\n\n", "created": "2025-07-16T20:21:06.349+0000", "updated": "2025-07-16T20:21:06.349+0000", "started": "2025-07-16T20:21:06.349+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974874", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974875", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2211513984\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   We might want to add full support by setting the following JDK properties too:\r\n   \r\n   `jdk.tls.server.enableStatusRequestExtension` and `jdk.tls.client.enableStatusRequestExtension`\r\n   \r\n   wdyt?\n\n\n\n", "created": "2025-07-16T20:22:01.400+0000", "updated": "2025-07-16T20:22:01.400+0000", "started": "2025-07-16T20:22:01.399+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974875", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974876", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2211519787\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   @stoty did you see this?\n\n\n\n", "created": "2025-07-16T20:24:10.068+0000", "updated": "2025-07-16T20:24:10.068+0000", "started": "2025-07-16T20:24:10.068+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974876", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974894", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212148314\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   OpenSsl.isAvailable() is completely irrelevant. It only tells if the OpenSSL provider is present on the classpath (perhaps with some sanity checks).\r\n   We COULD make a different check for it, but Netty will handle this and error out anyway, so I don't see any added value.\r\n   \r\n   **The actual error that we want to fix is the error that we get when netty is configured to use the JRE PROVIDER and \r\n   we're calling enableOCSP().**\r\n   \r\n   OpenSsl.isOcspSupported() is actually broken:\r\n   \r\n   `    sslCtx = SSLContext.make(SSL.SSL_PROTOCOL_TLSV1_2, SSL.SSL_MODE_SERVER);\r\n                   SSLContext.enableOcsp(sslCtx, false);\r\n                   supportsOcsp = true;\r\n   `\r\n   \r\n   As tcnative will simply ignore enableOcsp() if the native library does not support it, that call will return true for BoringSSL, so it only really tells us wheter calling enableOcsp() would cause the SSLContextContext creation to fail.\r\n   Additionally, all enableOcsp() does is set a member in the builder, the actual check only happens at build time.\r\n   \r\n   While this won't do anything useful for now, we can add a check for this in case tcnative behaviour changes in the future and some relevant check is added in enableOcsp()\r\n   \n\n\n\n", "created": "2025-07-17T03:53:31.775+0000", "updated": "2025-07-17T03:53:31.775+0000", "started": "2025-07-17T03:53:31.774+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974894", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974895", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212150000\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -123,7 +126,11 @@ public SslContext createNettySslContextForServer(ZKConfig config, KeyManager key\n             sslContextBuilder.trustManager(trustManager);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   see above\n\n\n\n", "created": "2025-07-17T03:53:48.609+0000", "updated": "2025-07-17T03:53:48.609+0000", "started": "2025-07-17T03:53:48.609+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974895", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974897", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212148314\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   OpenSsl.isAvailable() is completely irrelevant. It only tells if the OpenSSL provider is present on the classpath (perhaps with some sanity checks).\r\n   We COULD make a different check for it, but Netty will handle this and error out anyway (whether enableOcsp is called or not), so I don't see any added value.\r\n   \r\n   **The actual error that we want to fix is the error that we get when netty is configured to use the JRE PROVIDER and \r\n   we're calling enableOCSP().**\r\n   \r\n   OpenSsl.isOcspSupported() is actually broken:\r\n   \r\n   `    sslCtx = SSLContext.make(SSL.SSL_PROTOCOL_TLSV1_2, SSL.SSL_MODE_SERVER);\r\n                   SSLContext.enableOcsp(sslCtx, false);\r\n                   supportsOcsp = true;\r\n   `\r\n   \r\n   As tcnative will simply ignore enableOcsp() if the native library does not support it, that call will return true for BoringSSL, so it only really tells us wheter calling enableOcsp() would cause the SSLContextContext creation to fail.\r\n   Additionally, all enableOcsp() does is set a member in the builder, the actual check only happens at build time.\r\n   \r\n   While this won't do anything useful for now, we can add a check for this in case tcnative behaviour changes in the future and some relevant check is added in enableOcsp()\r\n   \n\n\n\n", "created": "2025-07-17T03:55:27.366+0000", "updated": "2025-07-17T03:55:27.366+0000", "started": "2025-07-17T03:55:27.366+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974897", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974900", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212244622\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   I want to move away from directly setting JDK global system properties, not add more.\r\n   \r\n   I would perhaps make sense the server which does not have other code running in it, but definitely not for the client. The ZK TLS config code is currently not structured to handle server-only settings well, adding server-only settings could also confuse users.\r\n   \r\n   In any case, we agreed to try and keep the individual changes as small as possible, so this is outside the scope of this particular ticket.\n\n\n\n", "created": "2025-07-17T04:47:46.734+0000", "updated": "2025-07-17T04:47:46.734+0000", "started": "2025-07-17T04:47:46.733+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974900", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974901", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212246941\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -99,6 +113,14 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n         }\n     }\n \n+    private void logTcnativeOcsp(boolean enable) {\n+        if (enable && !OpenSsl.isOcspSupported()) {\n+            // SslContextBuilder.enableOcsp() doesn't do anything, unless the default BoringSSL\n+            // tcnative dependency is replaced with an OpenSsl one.\n+            LOG.warn(\"Trying to enable OCSP for tcnative OpenSSL provider, but it is not supported. The setting will be ignored\");\n\nReview Comment:\n   The Enum default: \"JRE\"/\"OPENSSL\"/\"OPENSSL_REFCNT\"\r\n   \r\n   I have added the version string to the error message (which won't ever trigger unless tcnative fixes OpenSSL.isOcspSupported().\r\n   \n\n\n\n", "created": "2025-07-17T04:50:11.461+0000", "updated": "2025-07-17T04:50:11.461+0000", "started": "2025-07-17T04:50:11.461+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974901", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974902", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212244622\n\n\n##########\nzookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md:\n##########\n@@ -1776,6 +1776,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n     Specifies whether Online Certificate Status Protocol is enabled in client and quorum TLS protocols.\n     Default: false\n \n+* *ssl.tcnative.ocsp* and *ssl.quorum.tcnative.ocsp* :\n\nReview Comment:\n   I want to move away from directly setting JDK global system properties, not add more.\r\n   \r\n   It would perhaps make sense the server which does not have other code running in it, but definitely not for the client. The ZK TLS config code is currently not structured to handle server-only settings well, adding server-only settings could also confuse users.\r\n   \r\n   In any case, we agreed to try and keep the individual changes as small as possible, so this is outside the scope of this particular ticket.\n\n\n\n", "created": "2025-07-17T04:51:40.233+0000", "updated": "2025-07-17T04:51:40.233+0000", "started": "2025-07-17T04:51:40.233+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974902", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974904", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2212148314\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   OpenSsl.isAvailable() is completely irrelevant. It only tells if the OpenSSL provider is present on the classpath (perhaps with some sanity checks).\r\n   We COULD make a different check for it, but Netty will handle this and error out anyway (whether enableOcsp is called or not), so I don't see any added value.\r\n   \r\n   **The actual error that we want to fix is the error that we get when netty is configured to use the JRE PROVIDER and \r\n   we're calling enableOCSP().**\r\n   \r\n   I have some doubts about whether OpenSSL.enableOcsp() does what we would expect it to do, but as this is the API we have, we should use it. \r\n   \r\n   Even if it returns a wrong result (i.e. true for BoringSSL), that only means that the setting will be silently ignored. We can't fix that from our side.\r\n   \n\n\n\n", "created": "2025-07-17T05:34:34.002+0000", "updated": "2025-07-17T05:34:34.002+0000", "started": "2025-07-17T05:34:34.001+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974904", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974907", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "stoty commented on PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#issuecomment-3082667525\n\n   Thanks for the review @anmolnar .\r\n   \r\n   It turns out that I have misread the tcnative/boringssl code, and current BoringSSL DOES support ocsp stapling.\r\n   I have removed the comments and docs stating that BoringSSL does not support stapling.\r\n   \r\n   In any case, I have added checks for OpenSSL.isOcspSupported() and refactored the duplicate logic into a new method.\r\n   I have also added more logging and tried to make the logic simpler and easier to follow.\n\n\n", "created": "2025-07-17T05:59:22.796+0000", "updated": "2025-07-17T05:59:22.796+0000", "started": "2025-07-17T05:59:22.795+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974907", "issueId": "13621180"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/worklog/974983", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "anmolnar commented on code in PR #2270:\nURL: https://github.com/apache/zookeeper/pull/2270#discussion_r2213461306\n\n\n##########\nzookeeper-server/src/main/java/org/apache/zookeeper/common/ClientX509Util.java:\n##########\n@@ -79,7 +79,11 @@ public SslContext createNettySslContextForClient(ZKConfig config)\n             sslContextBuilder.trustManager(tm);\n         }\n \n-        sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\n+        SslProvider sslProvider = getSslProvider(config);\n+        sslContextBuilder.sslProvider(sslProvider);\n+        if (sslProvider == SslProvider.OPENSSL || sslProvider == SslProvider.OPENSSL_REFCNT) {\n\nReview Comment:\n   If it errors out only for JRE provider, why don't we check the other way around like `provider != JDK`. But anyways, let's keep this check if there's no better way.\n\n\n\n", "created": "2025-07-17T14:11:03.420+0000", "updated": "2025-07-17T14:11:03.420+0000", "started": "2025-07-17T14:11:03.419+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "974983", "issueId": "13621180"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": 23400, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@68795ac7[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@38b94bc4[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@40f1410c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3264c5bd[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@621c5b92[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@64e19c87[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ed25836[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3a8f397c[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3acf3574[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5222830e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6e8d7294[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2d8af2e0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 23400, "customfield_12312520": null, "customfield_12312521": "Tue Jul 29 20:04:32 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-07-29T20:04:32.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4940/watchers", "watchCount": 2, "isWatching": false}, "created": "2025-06-18T04:12:18.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-29T21:28:59.000+0000", "timeoriginalestimate": null, "description": "The problem is that ZK uncoditionally calls *io.netty.handler.ssl.SslContextBuilder.enableOcsp(boolean)*\r\nwhen _zookeeper.ssl.ocsp_ is set to true, even though Netty explicitly does not support that for the JRE provider.\r\n\r\nFor JRE OCSP is set in the javax.net.ssl.TrustManager object.\r\nI did not dig deep, but I presume that the OpenSSL provider ignores that, hence it needs another property.\r\n\r\n-To make this even more intersting, this setting doesn't actually do anything at all in Zookeeper.-\r\n-Zookeeper use netty-tcnative-boringssl-static , but this method is a NoOP for boringSSL, it is only supported by tcnative-\r\n-for OpenSSL.-\r\n-(I guess in theory the consumer could replace the tcnative implementation, in which case it would work as intended)-\r\n{noformat}\r\n[zk: ccycloud-1.nightly7310-og.root.comops.site:2182(CONNECTING) 0] 2025-06-18 04:06:01,013 [myid:] - WARN  [zkNetty-EpollEventLoopGroup-1-1:o.a.z.c.ClientX509Util@72] - zookeeper.ssl.keyStore.location not specified\r\n2025-06-18 04:06:01,074 [myid:] - WARN  [zkNetty-EpollEventLoopGroup-1-1:i.n.c.ChannelInitializer@97] - Failed to initialize a channel. Closing: [id: 0x1fac3cf9]\r\njava.lang.IllegalArgumentException: OCSP is not supported with this SslProvider: JDK\r\n\tat io.netty.handler.ssl.SslContext.newClientContextInternal(SslContext.java:837)\r\n\tat io.netty.handler.ssl.SslContextBuilder.build(SslContextBuilder.java:648)\r\n\tat org.apache.zookeeper.common.ClientX509Util.createNettySslContextForClient(ClientX509Util.java:93)\r\n\tat org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initSSL(ClientCnxnSocketNetty.java:449)\r\n\tat org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initChannel(ClientCnxnSocketNetty.java:438)\r\n\tat org.apache.zookeeper.ClientCnxnSocketNetty$ZKClientPipelineFactory.initChannel(ClientCnxnSocketNetty.java:424)\r\n\tat io.netty.channel.ChannelInitializer.initChannel(ChannelInitializer.java:129)\r\n\tat io.netty.channel.ChannelInitializer.handlerAdded(ChannelInitializer.java:112)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.callHandlerAdded(AbstractChannelHandlerContext.java:1130)\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(DefaultChannelPipeline.java:558)\r\n\tat io.netty.channel.DefaultChannelPipeline.access$100(DefaultChannelPipeline.java:45)\r\n\tat io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute(DefaultChannelPipeline.java:1410)\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers(DefaultChannelPipeline.java:1064)\r\n\tat io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded(DefaultChannelPipeline.java:599)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.register0(AbstractChannel.java:513)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.access$200(AbstractChannel.java:428)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$1.run(AbstractChannel.java:485)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:408)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:998)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:750)\r\n\r\n{noformat}", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "6.5h", "remainingEstimateSeconds": 0, "timeSpentSeconds": 23400}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Enabling zookeeper.ssl.ocsp with JRE TLS provider errors out", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17981671", "id": "17981671", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "body": "FYI [~andor]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-18T04:51:28.800+0000", "updated": "2025-06-18T04:51:28.800+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17982786", "id": "17982786", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "{quote}when_zookeeper.ssl.ocsp_is set to true\r\n{quote}\r\nThis sounds like a user error to me. Why do you want to set it if it's not supported by your runtime?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-18T18:33:50.051+0000", "updated": "2025-06-18T18:33:50.051+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17983440", "id": "17983440", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "body": "No.\r\nThis happens if you set ocsp to true and use the JRE provider , which is totally supported by the runtime.\r\n\r\nSetting the parameter causes the Tcnative provider to request a stapled OCSP response from the server.\r\nThe JRE provider has a system property for the same purpose, and no way to configure this on an Connection/SSLContext basis.\r\n\r\nSo Netty is kind of right by not accepting the parameter for JRE, but this is still a horrible API.\r\n\r\n(And this still doesn't do anything unless you replace the default tcnative implementation used by ZK)\r\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-19T05:21:58.234+0000", "updated": "2025-06-19T05:21:58.234+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17985130", "id": "17985130", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "Could you please share both the client and server configuration (config files and command line parameters) which is broken?\r\n\r\nWhat if we just put this setting behind an SslProvider check and don't set it if SslProvider == JDK?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-21T22:59:12.242+0000", "updated": "2025-06-21T22:59:12.242+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17985131", "id": "17985131", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "{quote}Setting the parameter causes the Tcnative provider to request a stapled OCSP response from the server.\r\n{quote}\r\nReally? We've never added OCSP stapling support to ZooKeeper. Based on the JDK documentation, it can be enabled on both client and server side by setting\r\n{noformat}\r\njdk.tls.client.enableStatusRequestExtension=true\r\njdk.tls.server.enableStatusRequestExtension=true{noformat}\r\nsystem properties, but ZooKeeper doesn't touch these. Therefore we only do CRL and client-side OCSP if revocation is enabled.\r\n\r\nIn which case we might not need to set it in SslContext at all. Have you found Netty's documentation of this property?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-21T23:10:22.869+0000", "updated": "2025-06-21T23:10:22.869+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/17985132", "id": "17985132", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "[Even better|https://netty.io/4.1/api/io/netty/handler/ssl/OpenSsl.html#isOcspSupported--]\r\n{code:java}\r\nif (OpenSsl.isOcspSupported()) {\r\n    sslContextBuilder.enableOcsp(config.getBoolean(getSslOcspEnabledProperty()));\r\n} {code}\r\nwhich will enable Ocsp stapling if set in the ZooKeeper configuration _and_ the provider supports it. For the JRE provider one must set it via the above mentioned properties. I'm not sure if we want to integrate that in ZooKeeper, though we already set some other system properties on the server side.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-06-21T23:19:17.965+0000", "updated": "2025-06-21T23:20:04.635+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/18003522", "id": "18003522", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "body": "I've just replied to the same issue on the PR.\r\n\r\njdk.tls.client.enableStatusRequestExtension=true\r\njdk.tls.server.enableStatusRequestExtension=true\r\n\r\nworks for the JRE TLS provider, while \r\n\r\nsslContextBuilder.enableOcsp() works for tcnative. (if supported)\r\n\r\nThe problem is that sslContextBuilder.enableOcsp() when the provider is JRE will just throw an exception, hence we need to check for the provider before calling it.\r\n\r\nOpenSsl.isOcspSupported() only tells us if the native library loaded by tcnative supports it, but that's unrelated to whether we're using tcnative or the JRE provider.\r\ni.e tcnative could have loaded an OpenSSL native library that supports OCSP, but if we set the JRE TLS provider for Netty, it still won't work.\r\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=stoty", "name": "stoty", "key": "stoty", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=stoty&avatarId=42544", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stoty&avatarId=42544", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stoty&avatarId=42544", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stoty&avatarId=42544"}, "displayName": "Istvan Toth", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-07-07T13:11:22.782+0000", "updated": "2025-07-07T13:11:22.782+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13621180/comment/18010731", "id": "18010731", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "body": "Issue resolved by pull request 2282\n[https://github.com/apache/zookeeper/pull/2282]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=andor", "name": "andor", "key": "andorm", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andorm&avatarId=32935", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andorm&avatarId=32935", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andorm&avatarId=32935", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andorm&avatarId=32935"}, "displayName": "Andor Molnar", "active": true, "timeZone": "Europe/Budapest"}, "created": "2025-07-29T20:04:32.202+0000", "updated": "2025-07-29T20:04:32.202+0000"}], "maxResults": 8, "total": 8, "startAt": 0}, "customfield_12311820": "0|z1wdlc:", "customfield_12314139": null}}