{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13607832", "self": "https://issues.apache.org/jira/rest/api/2/issue/13607832", "key": "ZOOKEEPER-4895", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12355230", "id": "12355230", "description": "", "name": "3.9.4", "archived": false, "released": true, "releaseDate": "2025-08-29"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/4", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg", "name": "Minor", "id": "4"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wangdan", "name": "wangdan", "key": "JIRAUSER292455", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER292455&avatarId=52737", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER292455&avatarId=52737", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER292455&avatarId=52737", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER292455&avatarId=52737"}, "displayName": "Dan Wang", "active": true, "timeZone": "Asia/Shanghai"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312380", "id": "12312380", "name": "c client", "description": "The c client interface to ZooKeeper"}, {"self": "https://issues.apache.org/jira/rest/api/2/component/12329414", "id": "12329414", "name": "security"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wangdan", "name": "wangdan", "key": "JIRAUSER292455", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER292455&avatarId=52737", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER292455&avatarId=52737", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER292455&avatarId=52737", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER292455&avatarId=52737"}, "displayName": "Dan Wang", "active": true, "timeZone": "Asia/Shanghai"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wangdan", "name": "wangdan", "key": "JIRAUSER292455", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER292455&avatarId=52737", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER292455&avatarId=52737", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER292455&avatarId=52737", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER292455&avatarId=52737"}, "displayName": "Dan Wang", "active": true, "timeZone": "Asia/Shanghai"}, "aggregateprogress": {"progress": 8400, "total": 8400, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 8400, "total": 8400, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4895/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 14, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/956155", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan opened a new pull request, #2223:\nURL: https://github.com/apache/zookeeper/pull/2223\n\n   C client has provided zoo_sasl_make_basic_callbacks() function to help users initialize SASL callbacks with the password in the specified file. The client would use this password directly for SASL authentication.\r\n   \r\n   However, considering the security of the production environment, the password in a file is usually encrypted. Also, security software also scans files in the system and will issue an alert if it detects an unencrypted password. Therefore, we need a mechanism to read the encrypted text from the file and decrypt it to obtain the real password.\r\n   \r\n   To achieve this, a helper function is introduced to decrypt the encrypted text in the file using a user-provided custom callback. A handback object is also introduced to provide necessary information for the decryption.\n\n\n", "created": "2025-02-08T04:23:59.881+0000", "updated": "2025-02-08T04:23:59.881+0000", "started": "2025-02-08T04:23:59.879+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "956155", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/956871", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2656334222\n\n   Hi @ztzg @kezhuw please help review the code, much appreciated !\n\n\n", "created": "2025-02-13T11:39:12.664+0000", "updated": "2025-02-13T11:39:12.664+0000", "started": "2025-02-13T11:39:12.663+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "956871", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/961299", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "cnauroth commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r1989809880\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n+\n+        /*\n+         * Write the null terminator immediately after the last character of the\n+         * content since it would be used as a null-terminated string once it is\n+         * the actual password.\n+         */\n+        buf[len] = '\\0';\n+        password = buf;\n+    }\n \n-        p = strrchr(buf, '\\n');\n-        if (p)\n-            *p = '\\0';\n+    if (secret_ctx->callback) {\n+        if (!password) {\n+            /*\n+             * The callback takes effect only when password_file is provided.\n+             */\n+            return SASL_BADPARAM;\n+        }\n \n-        password = buf;\n+        res = secret_ctx->callback(password, len, secret_ctx->context,\n+            new_passwd, sizeof(new_passwd));\n+        if (res != SASL_OK) {\n+            return res;\n+        }\n+\n+        memset(password, 0, len);\n+\n+        password = new_passwd;\n+    } else if (secret_ctx->password_file) {\n+        /*\n+         * The file's content is the actual password, which must consist only of\n+         * text characters (i.e., without null terminator). The first line would\n+         * be read as the password once there are multiple lines in the file.\n+         */\n+        p = strchr(password, '\\n');\n\nReview Comment:\n   I think there is a subtle change in behavior here from `strrchr` (find last occurrence) to `strchr` (find first occurrence). Is my understanding correct? This doesn't seem to be directly related to the new callback functionality, but it seems like a good bug fix.\n\n\n\n##########\nzookeeper-client/zookeeper-client-c/CMakeLists.txt:\n##########\n@@ -249,6 +249,7 @@ set(test_sources\n   tests/ThreadingUtil.cc\n   tests/TestZookeeperInit.cc\n   tests/TestZookeeperClose.cc\n+  tests/TestSASLAuth.cc\n\nReview Comment:\n   Great catch! This test suite has not been running regularly in our CI.\n\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n\nReview Comment:\n   Is this line necessary? It seems like `fh` is unused after this and will go out of scope.\n\n\n\n", "created": "2025-03-11T17:47:52.330+0000", "updated": "2025-03-11T17:47:52.330+0000", "started": "2025-03-11T17:47:52.328+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961299", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/961940", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r1997890812\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n\nReview Comment:\n   Indeed, as you mentioned, since the `fh` pointer will no longer be used later, there is no need to assign it to `null`. The reason for handling it this way is to prevent [**dangling pointer**](https://en.wikipedia.org/wiki/Dangling_pointer) issues; for example, we have similar handling in other parts of our code:  https://github.com/apache/zookeeper/blame/master/zookeeper-client/zookeeper-client-c/src/zk_sasl.c#L541.\n\n\n\n", "created": "2025-03-17T03:48:37.971+0000", "updated": "2025-03-17T03:48:37.971+0000", "started": "2025-03-17T03:48:37.970+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961940", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/961941", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r1997890950\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n+\n+        /*\n+         * Write the null terminator immediately after the last character of the\n+         * content since it would be used as a null-terminated string once it is\n+         * the actual password.\n+         */\n+        buf[len] = '\\0';\n+        password = buf;\n+    }\n \n-        p = strrchr(buf, '\\n');\n-        if (p)\n-            *p = '\\0';\n+    if (secret_ctx->callback) {\n+        if (!password) {\n+            /*\n+             * The callback takes effect only when password_file is provided.\n+             */\n+            return SASL_BADPARAM;\n+        }\n \n-        password = buf;\n+        res = secret_ctx->callback(password, len, secret_ctx->context,\n+            new_passwd, sizeof(new_passwd));\n+        if (res != SASL_OK) {\n+            return res;\n+        }\n+\n+        memset(password, 0, len);\n+\n+        password = new_passwd;\n+    } else if (secret_ctx->password_file) {\n+        /*\n+         * The file's content is the actual password, which must consist only of\n+         * text characters (i.e., without null terminator). The first line would\n+         * be read as the password once there are multiple lines in the file.\n+         */\n+        p = strchr(password, '\\n');\n\nReview Comment:\n   You understood it very accurately! The reason for this modification is mainly based on the comment in https://github.com/apache/zookeeper/blame/master/zookeeper-client/zookeeper-client-c/include/zookeeper.h#L661:  \r\n   `\\param password_file the name of a file whose first line is read in response to \\c SASL_CB_PASS, or NULL for none.`\r\n   Therefore, I replaced `strrchr` with `strchr`.  \r\n   \r\n   Do you think this modification is appropriate? If so, should I open a new pull request as a bug fix?\n\n\n\n", "created": "2025-03-17T03:48:57.986+0000", "updated": "2025-03-17T03:48:57.986+0000", "started": "2025-03-17T03:48:57.986+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961941", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/961942", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2728057511\n\n   > @empiredan , thank you for the patch. I entered just a few minor comments.\r\n   \r\n   @cnauroth Thank you so much for taking the time to review the code! I have tried to respond to your comments, and Iâ€™d be happy to continue the discussion if you have any further questions.\n\n\n", "created": "2025-03-17T03:51:45.848+0000", "updated": "2025-03-17T03:51:45.848+0000", "started": "2025-03-17T03:51:45.847+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "961942", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/962401", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "cnauroth commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r2001790171\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n\nReview Comment:\n   Understood, we can keep this for extra safety.\n\n\n\n##########\nzookeeper-client/zookeeper-client-c/src/zk_sasl.c:\n##########\n@@ -451,41 +453,87 @@ struct zsasl_secret_ctx {\n static int _zsasl_getsecret(sasl_conn_t *conn, void *context, int id,\n                             sasl_secret_t **psecret)\n {\n+    const size_t MAX_PASSWORD_LEN = 1023;\n     struct zsasl_secret_ctx *secret_ctx = (struct zsasl_secret_ctx *)context;\n-    char buf[1024];\n-    char *password;\n-    size_t len;\n+    char buf[MAX_PASSWORD_LEN + 1];\n+    char *password = NULL;\n+    size_t len = 0;\n+    int res = 0;\n+    char new_passwd[MAX_PASSWORD_LEN + 1];\n+    char *p = NULL;\n     sasl_secret_t *x;\n \n     /* paranoia check */\n-    if (!conn || !psecret || id != SASL_CB_PASS)\n+    if (!conn || !psecret || id != SASL_CB_PASS) {\n         return SASL_BADPARAM;\n+    }\n \n     if (secret_ctx->password_file) {\n-        char *p;\n         FILE *fh = fopen(secret_ctx->password_file, \"rt\");\n-        if (!fh)\n+        if (!fh) {\n             return SASL_FAIL;\n+        }\n \n-        if (!fgets(buf, sizeof(buf), fh)) {\n+        /*\n+         * The file's content may be the encrypted password with binary characters,\n+         * thus use fread().\n+         */\n+        len = fread(buf, sizeof(buf[0]), MAX_PASSWORD_LEN, fh);\n+        if (ferror(fh)) {\n             fclose(fh);\n             return SASL_FAIL;\n         }\n \n         fclose(fh);\n+        fh = NULL;\n+\n+        /*\n+         * Write the null terminator immediately after the last character of the\n+         * content since it would be used as a null-terminated string once it is\n+         * the actual password.\n+         */\n+        buf[len] = '\\0';\n+        password = buf;\n+    }\n \n-        p = strrchr(buf, '\\n');\n-        if (p)\n-            *p = '\\0';\n+    if (secret_ctx->callback) {\n+        if (!password) {\n+            /*\n+             * The callback takes effect only when password_file is provided.\n+             */\n+            return SASL_BADPARAM;\n+        }\n \n-        password = buf;\n+        res = secret_ctx->callback(password, len, secret_ctx->context,\n+            new_passwd, sizeof(new_passwd));\n+        if (res != SASL_OK) {\n+            return res;\n+        }\n+\n+        memset(password, 0, len);\n+\n+        password = new_passwd;\n+    } else if (secret_ctx->password_file) {\n+        /*\n+         * The file's content is the actual password, which must consist only of\n+         * text characters (i.e., without null terminator). The first line would\n+         * be read as the password once there are multiple lines in the file.\n+         */\n+        p = strchr(password, '\\n');\n\nReview Comment:\n   Thanks for confirming! I think it's fine to keep the change as part of this patch.\n\n\n\n", "created": "2025-03-18T18:58:11.193+0000", "updated": "2025-03-18T18:58:11.193+0000", "started": "2025-03-18T18:58:11.192+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "962401", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/962961", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r2008788390\n\n\n##########\nzookeeper-client/zookeeper-client-c/include/zookeeper.h:\n##########\n@@ -667,6 +667,69 @@ ZOOAPI zhandle_t *zookeeper_init_sasl(const char *host, watcher_fn fn,\n ZOOAPI sasl_callback_t *zoo_sasl_make_basic_callbacks(const char *user,\n   const char *realm, const char* password_file);\n \n+/**\n+ * \\brief signature of the callback function for SASL password.\n+ *\n+ * This callback is defined by user to decrypt the content of password file with\n+ * context into the actual password.\n+ *\n+ * \\param content the string read from the password file.\n+ * \\param content_len the size of the content in bytes.\n+ * \\param context the handback object that will be associated with the password\n+ *   file. The object is not used by zookeeper internally and can be null.\n+ * \\param buf the buffer where the resulting actual password is saved, NOTE that\n+ *   this callback must write the null terminator immediately after the last\n+ *   character of the actual password, otherwise the behaviour is undefined.\n\nReview Comment:\n   Is it better to shape the callback to type `int (*zoo_sasl_password_callback_t)(const char *content, size_t content_len, void *context, char *password_buf, size_t *password_buf_len)` for the decryption to pass back password len ? Fail to do so will result in sasl auth failure instead of `undefined`.\n\n\n\n", "created": "2025-03-22T15:12:04.111+0000", "updated": "2025-03-22T15:12:04.111+0000", "started": "2025-03-22T15:12:04.110+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "962961", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963188", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2748850389\n\n   > Looks good except possible `undefined` in `zoo_sasl_password_callback_t`. I think we probably should avoid `undefined` path from caller side.\r\n   \r\n   @kezhuw Thank you very much for helping review the code ! I completely agree that we should avoid undefined behavior.  \r\n   \r\n   Instead of requiring users to remember to manually add a null terminator at the end, returning the actual password length is more user-friendly, helps draw attention, and prevents potential undefined behavior.  \r\n   \r\n   As for the `buf_len` parameter, how about keeping it ? It mainly to remind users within the callback function that the buffer has a size limit and should not be accessed out of bounds.  \r\n   \r\n   The stack memory allocation approach is still retained because:  \r\n   1. Stack allocation is faster than heap allocation.  \r\n   2. A length of 1023 is more than sufficient for SASL passwords.\n\n\n", "created": "2025-03-24T17:12:50.007+0000", "updated": "2025-03-24T17:12:50.007+0000", "started": "2025-03-24T17:12:50.006+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963188", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963211", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#discussion_r2010704219\n\n\n##########\nzookeeper-client/zookeeper-client-c/include/zookeeper.h:\n##########\n@@ -667,6 +667,74 @@ ZOOAPI zhandle_t *zookeeper_init_sasl(const char *host, watcher_fn fn,\n ZOOAPI sasl_callback_t *zoo_sasl_make_basic_callbacks(const char *user,\n   const char *realm, const char* password_file);\n \n+/**\n+ * \\brief signature of the callback function for SASL password.\n+ *\n+ * This callback is defined by user to decrypt the content of password file with\n+ * context into the actual password.\n+ *\n+ * \\param content the string read from the password file.\n+ * \\param content_len the size of the content in bytes.\n+ * \\param context the handback object that will be associated with the password\n+ *   file. The object is not used by zookeeper internally and can be null.\n+ * \\param buf the buffer where the resulting actual password is saved, NOTE that\n+ *   this callback must write the null terminator immediately after the last\n+ *   character of the actual password, otherwise the behaviour is undefined.\n+ * \\param buf_len the size of buf in bytes, is also the max allowed length of\n+ *   the actual password (excluding the null terminator), which is 1023. The\n+ *   1-byte difference from 1024 accounts for the null (\\0) terminator. A length\n+ *   of 1023 is sufficient for storing the password.\n\nReview Comment:\n   Is here too many implementation details ?\r\n   \r\n   I think the contract is much clear now:\r\n   1. The max allowed password len is `buf_len`.\r\n   2. 1023 is indeed the max password length, but I think it does not deserve too much attention in api doc, as we have `buf_len`. \r\n   \r\n   Besides, after checked https://linux.die.net/man/3/sasl_getsecret_t, I think the null terminator does not actually matter. I think we can keep it, but again, does not deserve too much strokes.\n\n\n\n", "created": "2025-03-24T18:48:44.722+0000", "updated": "2025-03-24T18:48:44.722+0000", "started": "2025-03-24T18:48:44.721+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963211", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963253", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2749996853\n\n   > @empiredan Thank you for your contribution! I checked the refined `zoo_sasl_password_callback_t`, I think it is better than what I suggested.\r\n   > \r\n   > I left a comment about api doc. The rest looks good to me.\r\n   \r\n   Got it! Indeed, over-explaining could cause confusion for users, so simplifying the documentation makes sense.  \r\n   \r\n   The `sasl_secret_t` structure does not strictly require the `data` field to be null-terminated, but we are keeping it for the following reasons:\r\n   ```c\r\n   typedef struct sasl_secret {\r\n       unsigned long len;\r\n       unsigned char data[1];\t\t/* variable sized */\r\n   } sasl_secret_t;\r\n   ```\r\n   \r\n   1. There may be existing code that directly uses string functions to process the `data` field.  \r\n   2. The `unsigned char data[1];` flexible array provides a natural way to store the null terminator.  \r\n   3. The previous implementation used `strcpy((char *) x->data, password);` for copying, which inherently includes a `\\0` at the end. Therefore, it makes sense to preserve the null terminator.\n\n\n", "created": "2025-03-25T03:50:04.623+0000", "updated": "2025-03-25T03:50:04.623+0000", "started": "2025-03-25T03:50:04.623+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963253", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963316", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw merged PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223\n\n\n", "created": "2025-03-25T10:12:49.996+0000", "updated": "2025-03-25T10:12:49.996+0000", "started": "2025-03-25T10:12:49.996+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963316", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963318", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2750767248\n\n   @empiredan Thank you for your contribution! Merged to master and backported to branch-3.9 for security enhancement.\n\n\n", "created": "2025-03-25T10:18:10.466+0000", "updated": "2025-03-25T10:18:10.466+0000", "started": "2025-03-25T10:18:10.466+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963318", "issueId": "13607832"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/worklog/963326", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "empiredan commented on PR #2223:\nURL: https://github.com/apache/zookeeper/pull/2223#issuecomment-2750895788\n\n   @cnauroth @kezhuw Thank you both very much !\n\n\n", "created": "2025-03-25T11:05:59.605+0000", "updated": "2025-03-25T11:05:59.605+0000", "started": "2025-03-25T11:05:59.605+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "963326", "issueId": "13607832"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/2", "id": "2", "description": "A new feature of the product, which has yet to be developed.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype", "name": "New Feature", "subtask": false, "avatarId": 21141}, "timespent": 8400, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@314a6cd2[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2e22cf[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1af5c1c0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6bbca00b[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@39a04dc1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@194cc0da[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d03f9f2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@2331a8a1[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@18442743[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@67716e81[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@550fd7f4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7bd50954[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 8400, "customfield_12312520": null, "customfield_12312521": "Tue Mar 25 10:13:49 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-03-25T10:13:49.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4895/watchers", "watchCount": 2, "isWatching": false}, "created": "2025-02-08T04:21:58.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-29T21:28:59.000+0000", "timeoriginalestimate": null, "description": "C client has provided zoo_sasl_make_basic_callbacks() function to help users initialize SASL callbacks with the password in the specified file. The client would use this password directly for SASL authentication.\r\n\r\nHowever, considering the security of the production environment, the password in a file is usually encrypted. Also, security software also scans files in the system and will issue an alert if it detects an unencrypted password. Therefore, we need a mechanism to read the encrypted text from the file and decrypt it to obtain the real password.\r\n\r\nTo achieve this, a helper function is introduced to decrypt the encrypted text in the file using a user-provided custom callback. A handback object is also introduced to provide necessary information for the decryption.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "2h 20m", "remainingEstimateSeconds": 0, "timeSpentSeconds": 8400}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Introduce a helper function for C client to generate password for SASL authentication", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/comment/17925132", "id": "17925132", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wangdan", "name": "wangdan", "key": "JIRAUSER292455", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER292455&avatarId=52737", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER292455&avatarId=52737", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER292455&avatarId=52737", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER292455&avatarId=52737"}, "displayName": "Dan Wang", "active": true, "timeZone": "Asia/Shanghai"}, "body": "For the pull request please see https://github.com/apache/zookeeper/pull/2223.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=wangdan", "name": "wangdan", "key": "JIRAUSER292455", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER292455&avatarId=52737", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER292455&avatarId=52737", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER292455&avatarId=52737", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER292455&avatarId=52737"}, "displayName": "Dan Wang", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2025-02-08T04:24:44.754+0000", "updated": "2025-02-08T04:24:44.754+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13607832/comment/17938166", "id": "17938166", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "Issue resolved by pull request 2223\n[https://github.com/apache/zookeeper/pull/2223]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-03-25T10:13:49.576+0000", "updated": "2025-03-25T10:13:49.576+0000"}], "maxResults": 2, "total": 2, "startAt": 0}, "customfield_12311820": "0|z1u3ps:", "customfield_12314139": null}}