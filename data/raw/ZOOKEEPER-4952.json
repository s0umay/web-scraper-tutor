{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13624161", "self": "https://issues.apache.org/jira/rest/api/2/issue/13624161", "key": "ZOOKEEPER-4952", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12349587", "id": "12349587", "description": "", "name": "3.8.0", "archived": false, "released": true, "releaseDate": "2022-03-07"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12351304", "id": "12351304", "name": "3.9.0", "archived": false, "released": true, "releaseDate": "2023-08-03"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12352866", "id": "12352866", "description": "", "name": "3.8.2", "archived": false, "released": true, "releaseDate": "2023-07-18"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353400", "id": "12353400", "description": "", "name": "3.8.3", "archived": false, "released": true, "releaseDate": "2023-10-09"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353480", "id": "12353480", "name": "3.9.1", "archived": false, "released": true, "releaseDate": "2023-10-09"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353693", "id": "12353693", "description": "", "name": "3.8.4", "archived": false, "released": true, "releaseDate": "2024-03-05"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12353694", "id": "12353694", "description": "", "name": "3.9.2", "archived": false, "released": true, "releaseDate": "2024-03-12"}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12354432", "id": "12354432", "description": "", "name": "3.9.3", "archived": false, "released": true, "releaseDate": "2024-10-24"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liwang", "name": "liwang", "key": "liwang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Li Wang", "active": true, "timeZone": "America/Los_Angeles"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/5", "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png", "name": "Resolved", "id": "5", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12334405", "id": "12334405", "name": "metric system"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liwang", "name": "liwang", "key": "liwang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Li Wang", "active": true, "timeZone": "America/Los_Angeles"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=liwang", "name": "liwang", "key": "liwang", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Li Wang", "active": true, "timeZone": "America/Los_Angeles"}, "aggregateprogress": {"progress": 10200, "total": 10200, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 10200, "total": 10200, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4952/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 17, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975535", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang opened a new pull request, #2279:\nURL: https://github.com/apache/zookeeper/pull/2279\n\n   Implemented `PrometheusRejectedExecutionHandler` and override the `rejectedExecution()` API to fix the large memory footprint and long GC pause of RejectedExecutionException handler.  No more RejectedExecutionException() will be thrown.\r\n   \r\n   This enhancement increased read throughput by 140% based on perf comparison test result.\n\n\n", "created": "2025-07-21T20:24:38.164+0000", "updated": "2025-07-21T20:24:38.164+0000", "started": "2025-07-21T20:24:38.164+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975535", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975870", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2225592721\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   Why drop the rate limit logger ?\r\n   \r\n   I would expect rejections are periodically events but not a lifetime event.\n\n\n\n", "created": "2025-07-23T13:20:07.122+0000", "updated": "2025-07-23T13:20:07.122+0000", "started": "2025-07-23T13:20:07.122+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975870", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975877", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3108731274\n\n   > This enhancement increased read throughput by 140% according to our perf comparison tests result.\r\n   \r\n   Is it possible to add the perf code to tests so others can evaluate it ? I saw three in our codebase.\r\n   1. https://github.com/apache/zookeeper/blob/9d1d25cd75295b4529ce5348ba0cfce9ef4fefd7/zookeeper-server/src/test/java/org/apache/zookeeper/server/DeserializationPerfTest.java#L65-L72\r\n   2. https://github.com/apache/zookeeper/blob/9d1d25cd75295b4529ce5348ba0cfce9ef4fefd7/zookeeper-server/src/test/java/org/apache/zookeeper/server/util/RequestPathMetricsCollectorTest.java#L416-L449\r\n   3. https://github.com/apache/zookeeper/blob/9d1d25cd75295b4529ce5348ba0cfce9ef4fefd7/zookeeper-server/src/test/java/org/apache/zookeeper/audit/ZKAuditLoggerPerformance.java#L139-L141\n\n\n", "created": "2025-07-23T13:53:54.915+0000", "updated": "2025-07-23T13:53:54.915+0000", "started": "2025-07-23T13:53:54.915+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975877", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975918", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2226190582\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   The rate limit logger was dropped based on the following two considerations:\r\n   \r\n   1. To avoid the unnecessary overhead of logging the same warn msg repeatedly even it's rate limited\r\n   2. It's important to know whether rejection happens, but don't see too much benefits for knowing when the rejection stops and restarts.\r\n   \r\n   We can add the rate limit logger back if there is a strong preference to having it. \n\n\n\n", "created": "2025-07-23T17:08:43.149+0000", "updated": "2025-07-23T17:08:43.149+0000", "started": "2025-07-23T17:08:43.148+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975918", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975919", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2226190582\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   The rate limit logger was dropped based on the following two considerations:\r\n   \r\n   1. To avoid the unnecessary overhead of logging the same warn msg repeatedly even it's rate limited\r\n   2. It's important to know whether rejection happens, but don't see too much benefits for knowing when the rejection stops and restarts.\r\n   \r\n   We can add the rate limit logger back if there is a strong preference to have it. @kezhuw  \n\n\n\n", "created": "2025-07-23T17:09:08.169+0000", "updated": "2025-07-23T17:09:08.169+0000", "started": "2025-07-23T17:09:08.169+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975919", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975920", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2226190582\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   The rate limit logger was dropped based on the following two considerations:\r\n   \r\n   1. To avoid the unnecessary overhead of logging the same warn msg repeatedly even it's rate limited\r\n   2. It's important to know whether rejection happens, but don't see too many benefits of knowing when the rejection stops and restarts.\r\n   \r\n   I am ok with either way, so let me know if there is a strong preference to have it back. @kezhuw  \n\n\n\n", "created": "2025-07-23T17:12:28.699+0000", "updated": "2025-07-23T17:12:28.699+0000", "started": "2025-07-23T17:12:28.698+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975920", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975944", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2226456903\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   > It's important to know whether rejection happens, but don't see too many benefits of knowing when the rejection stops and restarts.\r\n   \r\n   My concern is that: people could lost the rejection if we log it only once as it could be too far from inspection time. ZooKeeper servers in production are supposed to run for a long time, logs could be truncated or archived periodically. If we log it only once at the first occurence, then it would be hard or even impossible to notice that the metrics backend is overloading now.\r\n   \r\n   > To avoid the unnecessary overhead of logging the same warn msg repeatedly even it's rate limited\r\n   \r\n   Is it possible to optimize this as the log string is a const.\r\n   \r\n   I personally think rejection policy deserve rate limit as it could happen shortly and periodically due to system load.\n\n\n\n", "created": "2025-07-23T19:28:02.930+0000", "updated": "2025-07-23T19:28:02.930+0000", "started": "2025-07-23T19:28:02.929+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975944", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975970", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2227145903\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   Yeah, let me just add the rate limit logger.\r\n   \r\n   \n\n\n\n", "created": "2025-07-24T02:01:47.866+0000", "updated": "2025-07-24T02:01:47.866+0000", "started": "2025-07-24T02:01:47.866+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975970", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/975972", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3111749957\n\n   > Is it possible to add the perf code to tests so others can evaluate it \r\n   Do you mean to evaluate the performance improvement of this change?   \r\n   \r\n   Any tests that perform some write operation can be used if we set the max queue size to a very small number (e.g. 1), however, the challenge is how to measure and compare the perf improvement. This is not something can be simply done by printing out some duration like the sample tests.\r\n   \r\n   If we analyze how `AbortPolicy()` is implemented, it's quite obvious that this change can reduce GC overhead and memory footprint when queue size exceeds the max.   The perf improvement number is provided here for reference purpose.  We've done quite comprehensive comparison tests w/o the change.\r\n   \r\n   I would be very happy to provide any clarification on the perf improvement, but personally don't think it's possible to write a meaningful perf test for it in the current code base and don't feel it's necessary neither. \n\n\n", "created": "2025-07-24T02:31:29.713+0000", "updated": "2025-07-24T02:31:29.713+0000", "started": "2025-07-24T02:31:29.713+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "975972", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/976455", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3124442260\n\n   > I would be very happy to provide any clarification on the perf improvement, but personally don't think it's possible to write a meaningful perf test for it in the current code base and don't feel it's really necessary neither.\r\n   \r\n   I am ok for this, please go ahead!\n\n\n", "created": "2025-07-27T14:08:48.658+0000", "updated": "2025-07-27T14:08:48.658+0000", "started": "2025-07-27T14:08:48.658+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "976455", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980316", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2298937582\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   Added log with constant string.\r\n   RateLogger has been optimized to enable logging a constant msg efficiently.\n\n\n\n", "created": "2025-08-25T19:25:40.782+0000", "updated": "2025-08-25T19:25:40.782+0000", "started": "2025-08-25T19:25:40.782+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980316", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980341", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on code in PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#discussion_r2298937582\n\n\n##########\nzookeeper-metrics-providers/zookeeper-prometheus-metrics/src/main/java/org/apache/zookeeper/metrics/prometheus/PrometheusMetricsProvider.java:\n##########\n@@ -714,14 +714,21 @@ public Thread newThread(final Runnable runnable) {\n         }\n     }\n \n+    private static class PrometheusRejectedExecutionHandler implements RejectedExecutionHandler {\n+        private static boolean maxQueueSizeExceeded = false;\n+\n+        @Override\n+        public void rejectedExecution(final Runnable r, final ThreadPoolExecutor e) {\n+            if (!maxQueueSizeExceeded) {\n+                maxQueueSizeExceeded = true;\n+                LOG.warn(\"Prometheus metrics queue size exceeded the max\");\n\nReview Comment:\n   - Enhanced `RateLogger `  reduce string concatenation overhead.\r\n   - Added the rate logger back to visibility when exceeding max  happens\n\n\n\n", "created": "2025-08-25T22:38:02.379+0000", "updated": "2025-08-25T22:38:02.379+0000", "started": "2025-08-25T22:38:02.378+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980341", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980345", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3222066651\n\n   Hi @kezhuw The rate logger has been added back with optimized RateLogger for reducing string concatenations. Would you mind taking a look at it? Thanks. \n\n\n", "created": "2025-08-25T23:46:41.198+0000", "updated": "2025-08-25T23:46:41.198+0000", "started": "2025-08-25T23:46:41.197+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980345", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980797", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang merged PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279\n\n\n", "created": "2025-08-27T21:47:39.557+0000", "updated": "2025-08-27T21:47:39.557+0000", "started": "2025-08-27T21:47:39.556+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980797", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980798", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3229848169\n\n   Thanks @kezhuw I will go ahead to merge it. \n\n\n", "created": "2025-08-27T21:47:56.663+0000", "updated": "2025-08-27T21:47:56.663+0000", "started": "2025-08-27T21:47:56.662+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980798", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980799", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "li4wang commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3229852477\n\n   @kezhuw Do you know if we  need to open a separate JIRA and PR if we want to include this in the upcoming 3.10.0 release?\n\n\n", "created": "2025-08-27T21:50:06.131+0000", "updated": "2025-08-27T21:50:06.131+0000", "started": "2025-08-27T21:50:06.130+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980799", "issueId": "13624161"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13624161/worklog/980826", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2279:\nURL: https://github.com/apache/zookeeper/pull/2279#issuecomment-3232367030\n\n   Hi @li4wang, master will be 3.10.0.\n\n\n", "created": "2025-08-28T07:55:36.687+0000", "updated": "2025-08-28T07:55:36.687+0000", "started": "2025-08-28T07:55:36.687+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "980826", "issueId": "13624161"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}, "timespent": 10200, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@42d8ebdc[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@b6f8a9d[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f6e402c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3822003e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4dec7fc3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@69804abc[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@54520880[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7cd9c1c4[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@52e5bbfb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@395bceb1[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d09d712[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4f6cee96[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 10200, "customfield_12312520": null, "customfield_12312521": "2025-07-21 18:22:45.0", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-08-28T07:54:52.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4952/watchers", "watchCount": 1, "isWatching": false}, "created": "2025-07-21T18:22:45.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-28T07:55:36.000+0000", "timeoriginalestimate": null, "description": "As part of ZOOKEEPER-4289,  Prometheus summary reporting is handled as an async operation using ThreadPoolExecutor.\r\n\r\nThe default RejectedExecutionHandler used by ThreadPoolExecutor is AbortPolicy, which performs toString() on both the Runnable object and exception object. This can significantly impact performance when too many exceptions occur after the max queue size exceeds.\r\n\r\n{code:java}\r\npublic static class AbortPolicy implements RejectedExecutionHandler {\r\n        /**\r\n         * Creates an {@code AbortPolicy}.\r\n         */\r\n        public AbortPolicy() { }\r\n\r\n        /**\r\n         * Always throws RejectedExecutionException.\r\n         *\r\n         * @param r the runnable task requested to be executed\r\n         * @param e the executor attempting to execute this task\r\n         * @throws RejectedExecutionException always\r\n         */\r\n        public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\r\n            throw new RejectedExecutionException(\"Task \" + r.toString() +\r\n                                                 \" rejected from \" +\r\n                                                 e.toString());\r\n        }\r\n    }\r\n\r\n{code}\r\n\r\nWe can reduce the GC overhead and improve performance by implementing a PrometheusRejectExceptionHandler and overriding the rejectedExecution() API.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "2h 50m", "remainingEstimateSeconds": 0, "timeSpentSeconds": 10200}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Reduce the GC overhead of Prometheus reject exception handling", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [], "maxResults": 0, "total": 0, "startAt": 0}, "customfield_12311820": "0|z1wvl4:", "customfield_12314139": null}}