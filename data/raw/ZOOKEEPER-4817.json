{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13573028", "self": "https://issues.apache.org/jira/rest/api/2/issue/13573028", "key": "ZOOKEEPER-4817", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": [], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "6.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4817/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@1757f73c[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a2ad316[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@8318cdc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@545f5caf[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@16b246ae[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@dd18528[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@902af22[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@27963089[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@231585e3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@22ecbc6c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3e8b7cac[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@280f118c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Tue Dec 03 08:17:25 UTC 2024", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4817/watchers", "watchCount": 2, "isWatching": false}, "created": "2024-03-23T00:16:14.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2024-12-03T08:17:25.000+0000", "timeoriginalestimate": null, "description": "Recently, we encounter an confused issue. The client disconnection warning disappears in system log. However, sometimes, this message appears in system log. There is a cluster consisting of three node. A client sends many creation requests and then read the node created by the first request. The client read operation failed. We watch the system log. Sometimes, there is a client disconnection warning. Sometimes, there is not. This incomplete system log mislead client judgement on the problem.\r\n\r\nAfter investigating, when NIOServerCnxn.doIO is stuck in any IO point in this function and the stuck time exceeds 20s, the client disconnection warning will disappear. If the stuck time is less than 20s, the client disconnection warning will appear in system log. \r\n\r\nWe find that the root cause is that selectorThread is set as the daemon thread. When one node encounter the fail-slow nic, the client disconnects with the node. If the NIOServerCnxn.doIO is stuck and the stuck time exceeds 20s, the corresponding selectorThread will be killed by JVM. Hence, the client disconnection warning is missed.\r\n\r\nAttached logs(20s) contain CancelledKeyException, but logs(25) do not contain.\r\n\r\nAre there any comments to figure out this issues and improve the diagnosability of ZooKeeper？ I will very appreciate them.", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [{"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069889", "id": "13069889", "filename": "system1_20s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.616+0000", "size": 57725, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069889/system1_20s.log"}, {"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069888", "id": "13069888", "filename": "system1_25s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.577+0000", "size": 53212, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069888/system1_25s.log"}, {"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069887", "id": "13069887", "filename": "system2_20s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.634+0000", "size": 56219, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069887/system2_20s.log"}, {"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069886", "id": "13069886", "filename": "system2_25s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.643+0000", "size": 54396, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069886/system2_25s.log"}, {"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069885", "id": "13069885", "filename": "system3_20s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.563+0000", "size": 51886, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069885/system3_20s.log"}, {"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069884", "id": "13069884", "filename": "system3_25s.log", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T08:01:36.573+0000", "size": 51794, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069884/system3_25s.log"}], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Client disconnection warning is missed in system log sometimes.", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13573028/comment/17861097", "id": "17861097", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "body": "[~kezhuw] hi, cloud you help me figure out this phenomenon?", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-07-01T09:17:12.643+0000", "updated": "2024-07-01T09:17:12.643+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573028/comment/17885700", "id": "17885700", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "{quote}\r\nWe find that the root cause is that selectorThread is set as the daemon thread. When one node encounter the fail-slow nic, the client disconnects with the node. If the NIOServerCnxn.doIO is stuck and the stuck time exceeds 20s, the corresponding selectorThread will be killed by JVM. Hence, the client disconnection warning is missed.\r\n{quote}\r\n\r\nWhat did you mean by \"be killed by JVM\" ? And I am not sure, if the whole server is going to shut, how does \"CancelledKeyException\" matter ? I may mislead something.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2024-09-29T12:31:27.516+0000", "updated": "2024-09-29T12:31:27.516+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13573028/comment/17902543", "id": "17902543", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "body": "I try to trace the thread of NIOServerCnxn. I found that the thread ID of NIOServerCnxn in the node2 changes when the stuck time exceeds 20s. Hence, i guess that the thread of NIOServerCnxn may be killed by JVM due to some reasons.  Additionally, the system logs show that the server is still alive. Do you have any suggestion to figure out this problem? Thanks.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=gendong1", "name": "gendong1", "key": "JIRAUSER304604", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34055", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34055", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34055", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34055"}, "displayName": "mutu", "active": true, "timeZone": "Asia/Shanghai"}, "created": "2024-12-03T08:17:25.729+0000", "updated": "2024-12-03T08:17:25.729+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "customfield_12311820": "0|z1o5zs:", "customfield_12314139": null}}