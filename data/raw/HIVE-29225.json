{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13629768", "self": "https://issues.apache.org/jira/rest/api/2/issue/13629768", "key": "HIVE-29225", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/2", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg", "name": "Critical", "id": "2"}, "labels": ["hive-4.2.0-candidate", "pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12343343", "id": "12343343", "name": "4.0.0", "archived": false, "released": true, "releaseDate": "2024-03-29"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=sercan.tekin", "name": "sercan.tekin", "key": "JIRAUSER283532", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Sercan Tekin", "active": true, "timeZone": "Europe/Kiev"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/10002", "description": "A patch for this issue has been uploaded to JIRA by a contributor.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/document.png", "name": "Patch Available", "id": "10002", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4", "id": 4, "key": "indeterminate", "colorName": "yellow", "name": "In Progress"}}, "components": [], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=sercan.tekin", "name": "sercan.tekin", "key": "JIRAUSER283532", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Sercan Tekin", "active": true, "timeZone": "Europe/Kiev"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=sercan.tekin", "name": "sercan.tekin", "key": "JIRAUSER283532", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"}, "displayName": "Sercan Tekin", "active": true, "timeZone": "Europe/Kiev"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29225/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@605b348c[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@66c1fff2[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@501b1b57[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@394c50c9[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@118fcdfc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@153b7274[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1df21227[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@46e3c348[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@296c1645[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@670a79ce[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6ae43c22[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@32c55bb5[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310843", "id": "12310843", "key": "HIVE", "name": "Hive", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310843&avatarId=11935", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310843&avatarId=11935", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310843&avatarId=11935", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310843&avatarId=11935"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10292", "id": "10292", "description": "Scalable Distributed Computing", "name": "Hadoop"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Tue Oct 28 22:09:29 UTC 2025", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/HIVE-29225/watchers", "watchCount": 2, "isWatching": false}, "created": "2025-09-24T02:07:06.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-10-30T00:09:41.000+0000", "timeoriginalestimate": null, "description": "Once a job or application finishes, the corresponding lock file is released, and YARN no longer reports any active jobs or applications. At this point, Hive assumes the associated scratch directory is no longer needed and proceeds to delete it upon *ClearDanglingScratchDir* service is invoked.\r\n\r\nHowever, in some cases, Hive may still be streaming output to the client after the application is marked as finished. This causes the scratch directory to be deleted prematurely, even though it is still required for ongoing output.\r\n\r\nAs a result, queries can fail with *IOException* errors because the scratch directory is removed while Hive is still using it.\r\n{code:java}\r\norg.apache.hive.service.cli.HiveSQLException: java.io.IOException: java.io.IOException: 2049.323.265264 /user/mapr/tmp/hive/mapr/ecfdf7a4-91ba-4832-a408-8d459f90ac4b/hive_2025-07-23_12-57-08_793_7535333864129536266-1/-mr-10001/.hive-staging_hive_2025-07-23_12-57-08_793_7535333864129536266-1/-ext-10002/000008_0 (Input/output error)\r\n{code}\r\n\r\n---\r\n\r\n*STEPS TO REPRODUCE:*\r\n1. Add the following properties into hive-site.xml and restart Hive services:\r\n{code:java}\r\n<property>\r\n  <name>hive.scratchdir.lock</name>\r\n  <value>true</value>\r\n</property>\r\n<property>\r\n  <name>tez.session.am.dag.submit.timeout.secs</name>\r\n  <value>10</value>\r\n</property>\r\n{code}\r\n\r\n2. Generate the data using the following commands:\r\n{code:java}\r\nfor i in {1..1000000}; do echo \"\" >> /tmp/file1.txt; done\r\nfor i in {1..8}; do cat /tmp/file1.txt >> /tmp/file2.txt; cat /tmp/file2.txt >> /tmp/file1.txt; done\r\n{code}\r\n\r\n3. Create Hive table and load data into it:\r\n{code:java}\r\nCREATE TABLE i (id INT);\r\nLOAD DATA LOCAL INPATH '/tmp/file2.txt' INTO TABLE i;\r\n{code}\r\n\r\n4. Connect to HiveServer2 using Beeline and execute the following queries:\r\n{code:java}\r\nSET hive.fetch.task.conversion=none;\r\nSELECT * FROM i;\r\n{code}\r\n\r\n5. Open a new session to the same host. After the query from step 4 starts returning the results, wait 30 seconds and execute the command below:\r\n{code:java}\r\nhive --service cleardanglingscratchdir -v\r\n{code}\r\n\r\n6. ”hive --service cleardanglingscratchdir -v” deletes the scratchdir used by the query and the query fails during the next 20-30 seconds with the following error:\r\n{code:java}\r\n...\r\n| NULL  |\r\norg.apache.hive.service.cli.HiveSQLException: java.io.IOException: java.io.IOException: 2049.323.265264 /user/mapr/tmp/hive/mapr/ecfdf7a4-91ba-4832-a408-8d459f90ac4b/hive_2025-07-23_12-57-08_793_7535333864129536266-1/-mr-10001/.hive-staging_hive_2025-07-23_12-57-08_793_7535333864129536266-1/-ext-10002/000008_0 (Input/output error)\r\n0: jdbc:hive2://node1:10000/>\r\n{code}\r\n\r\n", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12310320": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12356025", "id": "12356025", "name": "4.2.0", "archived": false, "released": false}], "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Premature deletion of scratch directories during output streaming", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13629768/comment/18033692", "id": "18033692", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=difin", "name": "difin", "key": "JIRAUSER295017", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34054", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34054", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34054", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34054"}, "displayName": "Dmitriy Fingerman", "active": true, "timeZone": "America/Toronto"}, "body": "Hi [~sercan.tekin], please set the affected version(s).", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=difin", "name": "difin", "key": "JIRAUSER295017", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34054", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34054", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34054", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34054"}, "displayName": "Dmitriy Fingerman", "active": true, "timeZone": "America/Toronto"}, "created": "2025-10-28T22:09:29.522+0000", "updated": "2025-10-28T22:09:29.522+0000"}], "maxResults": 1, "total": 1, "startAt": 0}, "customfield_12311820": "0|z1xu8o:", "customfield_12314139": null}}