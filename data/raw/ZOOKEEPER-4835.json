{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13580632", "self": "https://issues.apache.org/jira/rest/api/2/issue/13580632", "key": "ZOOKEEPER-4835", "fields": {"fixVersions": [], "resolution": null, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "labels": [], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "1.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": null, "customfield_12312330": null, "versions": [], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [], "customfield_12312339": null, "customfield_12313825": null, "assignee": null, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "components": [], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": null, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "aggregateprogress": {"progress": 0, "total": 0}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 0, "total": 0}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4835/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 0, "worklogs": []}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/4", "id": "4", "description": "An improvement or enhancement to an existing feature or task.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype", "name": "Improvement", "subtask": false, "avatarId": 21140}, "timespent": null, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@23a2a7cd[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@ab0aa1c[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4b815e83[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@446eeda5[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1d9ec8e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@2446e423[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@65f2c36e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@564209b0[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@18b1326a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@b45baa3[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@785fe116[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3e967824[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": null, "customfield_12312520": null, "customfield_12312521": "Tue May 28 14:43:09 UTC 2024", "customfield_12314422": null, "customfield_12314421": null, "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": null, "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4835/watchers", "watchCount": 2, "isWatching": false}, "created": "2024-05-28T06:22:39.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2024-05-28T14:43:09.000+0000", "timeoriginalestimate": null, "description": "ZK should not mandate the inclusion of Netty if Netty features aren't being used.  There are very few usages of Netty from ZK files that are not named Netty, so this looks pretty easy.", "customfield_10010": null, "timetracking": {}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [{"self": "https://issues.apache.org/jira/rest/api/2/attachment/13069135", "id": "13069135", "filename": "zk-netty-violations.txt", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "created": "2024-05-28T06:31:27.335+0000", "size": 8767, "mimeType": "text/plain", "content": "https://issues.apache.org/jira/secure/attachment/13069135/zk-netty-violations.txt"}], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Netty should be an optional dependency", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13580632/comment/17849897", "id": "17849897", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "body": "I attempted to conclusively confirm how viable excluding Netty might be.  I came upon ArchUnit[1] and wrote a little test[2] to look for ZK classes that don't have Netty in the name yet call such a class or that which call Netty directly.  The results show X509 utilities are intertwined with Netty.  And furthermore the methods ZooKeeper.getClientCnxnSocket and ZooKeeperServer.getOutstandingHandshakeNum and UnifiedServerSocket$UnifiedSocket.detectMode() refer to Netty.  Thus it seems not safe to exclude Netty today but if the ZK project wanted to invest in better separation, it seems close at hand.\r\n\r\n[1] ArchUnit: https://www.archunit.org/\r\n[2] my test: https://gist.github.com/dsmiley/8a34cf16dd5827e5396e6da24e19afd2", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "created": "2024-05-28T06:24:28.099+0000", "updated": "2024-05-28T06:24:28.099+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13580632/comment/17849931", "id": "17849931", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=eolivelli", "name": "eolivelli", "key": "eolivelli", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10450", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"}, "displayName": "Enrico Olivelli", "active": true, "timeZone": "Europe/Rome"}, "body": "I think that this is doable.\r\n\r\nThat said when you use TLS you need Netty and I am pretty sure that many users are using TLS.\r\n\r\n \r\n\r\nI think that the main value is to have something that ensures that the zookeeper client really works without any Netty class in the classpath. It is possible that in the future someone uses some utility from Netty.\r\n\r\n \r\n\r\n ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=eolivelli", "name": "eolivelli", "key": "eolivelli", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10450", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10450", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10450", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10450"}, "displayName": "Enrico Olivelli", "active": true, "timeZone": "Europe/Rome"}, "created": "2024-05-28T08:12:41.020+0000", "updated": "2024-05-28T08:12:41.020+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13580632/comment/17850052", "id": "17850052", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "body": "Note that TLS can be achieved completely independently via Mesh/Istio.\r\n{quote} that the zookeeper client really works without any Netty\r\n{quote}\r\nIt's not clear how to make a \"client\" vs \"server\" distinction within the codebase to enforce that it's okay for the \"server\" to talk to Netty but not the \"client\".  Plenty of packages are in common (utils).  Anyway, as the ArchUnit test shows, it's really pretty close to making a class name based distinction of which classes can talk to Netty.  ", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=dsmiley", "name": "dsmiley", "key": "dsmiley", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=dsmiley&avatarId=10110", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dsmiley&avatarId=10110", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dsmiley&avatarId=10110", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dsmiley&avatarId=10110"}, "displayName": "David Smiley", "active": true, "timeZone": "America/New_York"}, "created": "2024-05-28T14:43:09.841+0000", "updated": "2024-05-28T14:43:09.841+0000"}], "maxResults": 3, "total": 3, "startAt": 0}, "customfield_12311820": "0|z1pgdk:", "customfield_12314139": null}}