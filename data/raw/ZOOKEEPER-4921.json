{"expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields", "id": "13616163", "self": "https://issues.apache.org/jira/rest/api/2/issue/13616163", "key": "ZOOKEEPER-4921", "fields": {"fixVersions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12353481", "id": "12353481", "name": "3.10.0", "archived": false, "released": false}, {"self": "https://issues.apache.org/jira/rest/api/2/version/12355230", "id": "12355230", "description": "", "name": "3.9.4", "archived": false, "released": true, "releaseDate": "2025-08-29"}], "resolution": {"self": "https://issues.apache.org/jira/rest/api/2/resolution/1", "id": "1", "description": "A fix for this issue is checked into the tree and tested.", "name": "Fixed"}, "customfield_12312322": null, "customfield_12312323": null, "customfield_12310420": "9223372036854775807", "customfield_12312320": null, "customfield_12312321": null, "customfield_12312328": null, "customfield_12312329": null, "customfield_12312326": null, "customfield_12310300": null, "customfield_12312327": null, "customfield_12312324": null, "customfield_12312720": null, "customfield_12312325": null, "lastViewed": null, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/2", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg", "name": "Critical", "id": "2"}, "labels": ["pull-request-available"], "customfield_12312333": null, "customfield_12312334": null, "customfield_12313422": "false", "customfield_12310310": "0.0", "customfield_12312331": null, "customfield_12312332": null, "aggregatetimeoriginalestimate": null, "timeestimate": 0, "customfield_12312330": null, "versions": [{"self": "https://issues.apache.org/jira/rest/api/2/version/12354432", "id": "12354432", "description": "", "name": "3.9.3", "archived": false, "released": true, "releaseDate": "2024-10-24"}], "customfield_12311120": null, "customfield_12313826": null, "issuelinks": [{"id": "12701812", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12701812", "type": {"id": "12310560", "name": "Problem/Incident", "inward": "is caused by", "outward": "causes", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310560"}, "inwardIssue": {"id": "13437158", "key": "ZOOKEEPER-4508", "self": "https://issues.apache.org/jira/rest/api/2/issue/13437158", "fields": {"summary": "ZooKeeper client run to endless loop in ClientCnxn.SendThread.run if all server down", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/3", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg", "name": "Major", "id": "3"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}}}}, {"id": "12701918", "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12701918", "type": {"id": "10030", "name": "Reference", "inward": "is related to", "outward": "relates to", "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"}, "inwardIssue": {"id": "13616408", "key": "ZOOKEEPER-4923", "self": "https://issues.apache.org/jira/rest/api/2/issue/13616408", "fields": {"summary": "Support individual timeout to establish a brand-new session", "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/1", "description": "The issue is open and ready for the assignee to start work on it.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png", "name": "Open", "id": "1", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2", "id": 2, "key": "new", "colorName": "blue-gray", "name": "To Do"}}, "priority": {"self": "https://issues.apache.org/jira/rest/api/2/priority/1", "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg", "name": "Blocker", "id": "1"}, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/2", "id": "2", "description": "A new feature of the product, which has yet to be developed.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype", "name": "New Feature", "subtask": false, "avatarId": 21141}}}}], "customfield_12312339": null, "customfield_12313825": null, "assignee": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "customfield_12312337": null, "customfield_12313823": null, "customfield_12312338": null, "customfield_12311920": null, "customfield_12313822": null, "customfield_12312335": null, "customfield_12313821": null, "customfield_12312336": null, "customfield_12313820": null, "status": {"self": "https://issues.apache.org/jira/rest/api/2/status/6", "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.", "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png", "name": "Closed", "id": "6", "statusCategory": {"self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3", "id": 3, "key": "done", "colorName": "green", "name": "Done"}}, "components": [{"self": "https://issues.apache.org/jira/rest/api/2/component/12312381", "id": "12312381", "name": "java client", "description": "The java client interface for ZooKeeper"}], "archiveddate": null, "customfield_12312026": null, "customfield_12312023": null, "customfield_12312024": null, "aggregatetimeestimate": 0, "customfield_12312022": null, "customfield_12310921": null, "customfield_12310920": "9223372036854775807", "customfield_12312823": null, "creator": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "subtasks": [], "reporter": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "aggregateprogress": {"progress": 3600, "total": 3600, "percent": 100}, "customfield_12313520": null, "customfield_12310250": null, "progress": {"progress": 3600, "total": 3600, "percent": 100}, "customfield_12313924": null, "votes": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4921/votes", "votes": 0, "hasVoted": false}, "worklog": {"startAt": 0, "maxResults": 20, "total": 6, "worklogs": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/968008", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw opened a new pull request, #2252:\nURL: https://github.com/apache/zookeeper/pull/2252\n\n   This partially rollback ZOOKEEPER-4508 to keep consistent with versions prior to 3.9.3 (excluded), so to maintain compatibility with third party libraries.\r\n   \r\n   Refs: ZOOKEEPER-4508, ZOOKEEPER-4921, ZOOKEEPER-4923 and https://lists.apache.org/thread/nfb9z7rhgglbjzfxvg4z2m3pks53b3c1\n\n\n", "created": "2025-04-29T13:55:15.308+0000", "updated": "2025-04-29T13:55:15.308+0000", "started": "2025-04-29T13:55:15.307+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "968008", "issueId": "13616163"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/968016", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2252:\nURL: https://github.com/apache/zookeeper/pull/2252#issuecomment-2839076094\n\n   This is the 3.9 of #2253.\n\n\n", "created": "2025-04-29T14:08:53.703+0000", "updated": "2025-04-29T14:08:53.703+0000", "started": "2025-04-29T14:08:53.702+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "968016", "issueId": "13616163"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/969229", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw merged PR #2252:\nURL: https://github.com/apache/zookeeper/pull/2252\n\n\n", "created": "2025-05-11T02:18:19.286+0000", "updated": "2025-05-11T02:18:19.286+0000", "started": "2025-05-11T02:18:19.286+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "969229", "issueId": "13616163"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/969230", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2252:\nURL: https://github.com/apache/zookeeper/pull/2252#issuecomment-2869354482\n\n   Hi @tisonkun, I have merged this to branch-3.9.\r\n   \r\n   Besides, I have marked ZOOKEEPER-4921 as resolved with fix version 3.9.4, as 3.9.5 has not been created. Feel free to decide the final ship version as the release manager.\r\n   \r\n   Refs: https://lists.apache.org/thread/sq5djdm5ttbscbtdw5ykp5vl4dfb8p56\n\n\n", "created": "2025-05-11T02:28:52.231+0000", "updated": "2025-05-11T02:28:52.231+0000", "started": "2025-05-11T02:28:52.231+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "969230", "issueId": "13616163"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/971889", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw opened a new pull request, #2265:\nURL: https://github.com/apache/zookeeper/pull/2265\n\n   This partially rollback ZOOKEEPER-4508 to keep consistent with versions prior to 3.9.3 (excluded), so to maintain compatibility with third party libraries.\r\n   \r\n   Refs: ZOOKEEPER-4508, ZOOKEEPER-4921, ZOOKEEPER-4923 and https://lists.apache.org/thread/nfb9z7rhgglbjzfxvg4z2m3pks53b3c1\n\n\n", "created": "2025-06-05T01:16:57.464+0000", "updated": "2025-06-05T01:16:57.464+0000", "started": "2025-06-05T01:16:57.464+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "971889", "issueId": "13616163"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/worklog/971890", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot", "name": "githubbot", "key": "githubbot", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "ASF GitHub Bot", "active": true, "timeZone": "Etc/UTC"}, "comment": "kezhuw commented on PR #2265:\nURL: https://github.com/apache/zookeeper/pull/2265#issuecomment-2942389965\n\n   This is 3.9.4 version of #2252.  cc @tisonkun \n\n\n", "created": "2025-06-05T01:18:42.940+0000", "updated": "2025-06-05T01:18:42.940+0000", "started": "2025-06-05T01:18:42.940+0000", "timeSpent": "10m", "timeSpentSeconds": 600, "id": "971890", "issueId": "13616163"}]}, "archivedby": null, "customfield_12313920": null, "issuetype": {"self": "https://issues.apache.org/jira/rest/api/2/issuetype/1", "id": "1", "description": "A problem which impairs or prevents the functions of the product.", "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype", "name": "Bug", "subtask": false, "avatarId": 21133}, "timespent": 3600, "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@598a3cd4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4820e02c[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1fa57f91[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@504bcdc9[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7c32d3b8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6701f10a[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@53ec538c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5dc7e9bd[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@37824eae[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5f6360f5[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6ea228a6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@ccabece[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}", "customfield_12314141": null, "customfield_12314140": null, "project": {"self": "https://issues.apache.org/jira/rest/api/2/project/12310801", "id": "12310801", "key": "ZOOKEEPER", "name": "ZooKeeper", "projectTypeKey": "software", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12310801&avatarId=10011", "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310801&avatarId=10011", "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310801&avatarId=10011", "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310801&avatarId=10011"}, "projectCategory": {"self": "https://issues.apache.org/jira/rest/api/2/projectCategory/10484", "id": "10484", "description": "Apache ZooKeeper related", "name": "ZooKeeper"}}, "aggregatetimespent": 3600, "customfield_12312520": null, "customfield_12312521": "Sun May 11 02:20:55 UTC 2025", "customfield_12314422": null, "customfield_12314421": ["Java", "Scala"], "customfield_12314146": null, "customfield_12314420": null, "customfield_12314145": null, "customfield_12314144": null, "customfield_12314143": null, "resolutiondate": "2025-05-11T02:20:55.000+0000", "workratio": -1, "customfield_12312923": null, "customfield_12312920": null, "customfield_12312921": null, "watches": {"self": "https://issues.apache.org/jira/rest/api/2/issue/ZOOKEEPER-4921/watchers", "watchCount": 3, "isWatching": false}, "created": "2025-04-23T17:51:59.000+0000", "customfield_12310192": null, "customfield_12310191": null, "customfield_12310230": null, "updated": "2025-08-29T21:29:00.000+0000", "timeoriginalestimate": null, "description": "After upgrading the Java Zookeeper client to version 3.9.3, we observed that it is not resilient to brief network disruptions, such as a short VPN blip. In such cases, the client attempts to reconnect only once, and if unsuccessful, the session expires.\r\n{quote}Apr 23, 2025 10:19:23 AM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process\r\nINFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1\r\n{quote}\r\nIn contrast, the previous version (3.9.2) would continuously retry until the network connection was restored, maintaining the session more reliably.\r\n\r\nI believe it's a new issue with this change: https://issues.apache.org/jira/browse/ZOOKEEPER-4508\r\n\r\n \r\n\r\nStep to repro:\r\n # Open VPN.\r\n # Start the application which connects to the Zookeeper server with the VPN.\r\n # Disable VPN for a couple of minutes.\r\n # Observe the application.\r\n # Enable the VPN again.\r\n\r\n{quote}3.9.3:\r\n\"message\" : \"Session 0x0 for server XXX, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.\",\r\n  \"stackTrace\" : \"o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 5590ms for session id 0x0\r\n        at o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)\r\n{quote}\r\n3.9.2: Application will be reconnected successfully.", "customfield_10010": null, "timetracking": {"remainingEstimate": "0h", "timeSpent": "1h", "remainingEstimateSeconds": 0, "timeSpentSeconds": 3600}, "customfield_12314523": null, "customfield_12314127": null, "customfield_12314522": null, "customfield_12314126": null, "customfield_12314521": null, "customfield_12314125": null, "customfield_12314520": null, "customfield_12314124": null, "customfield_12312340": null, "attachment": [], "customfield_12314123": null, "customfield_12312341": null, "customfield_12312220": null, "customfield_12314122": null, "customfield_12314121": null, "customfield_12314120": null, "customfield_12314129": null, "customfield_12314524": null, "customfield_12314128": null, "summary": "Zookeeper Client 3.9.3 Fails to Reconnect After Network Failures", "customfield_12314130": null, "customfield_12310291": null, "customfield_12310290": null, "customfield_12311024": null, "customfield_12314138": null, "customfield_12314137": null, "environment": null, "customfield_12314136": null, "customfield_12314135": null, "customfield_12311020": null, "customfield_12314134": null, "duedate": null, "customfield_12314132": null, "customfield_12314131": null, "comment": {"comments": [{"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946769", "id": "17946769", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "body": "cc [~andor] as I see your comment on the previous issue.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-04-23T17:53:36.844+0000", "updated": "2025-04-23T17:53:36.844+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946772", "id": "17946772", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=ctubbsii", "name": "ctubbsii", "key": "ctubbsii", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=ctubbsii&avatarId=15840", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ctubbsii&avatarId=15840", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ctubbsii&avatarId=15840", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ctubbsii&avatarId=15840"}, "displayName": "Christopher Tubbs", "active": true, "timeZone": "America/New_York"}, "body": "The Accumulo team has noticed this and has developed a solution, a \"ZooSession\" object that mostly mimics the API of ZooKeeper client object, and automatically reconnects. However, it needs additional work to be fully resilient to exceptions thrown due to transient failures. Some of that is encapsulated in a helper \"ZooReader\" and \"ZooReaderWriter\" objects which retry operations on transient errors, and plan to merge those into the ZooSession feature. I think if we can make it resilient enough to be generally useful, it is something that we could contribute directly to the ZooKeeper project. However, that requires some time to polish up the API and behavior, and we have a lot of other development tasks we're working on.\r\n\r\nBut, I think the idea is sound. It's very weird, after all, that the ZK client is useless after network failures. It's a bit like having to restart your browser every time you navigate to website with an error. That shouldn't be necessary.\r\n\r\nYou may want to take a look at the workarounds that the Accumulo project has come up with for handling these transient issues.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=ctubbsii", "name": "ctubbsii", "key": "ctubbsii", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=ctubbsii&avatarId=15840", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ctubbsii&avatarId=15840", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ctubbsii&avatarId=15840", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ctubbsii&avatarId=15840"}, "displayName": "Christopher Tubbs", "active": true, "timeZone": "America/New_York"}, "created": "2025-04-23T18:02:13.306+0000", "updated": "2025-04-23T18:02:13.306+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946897", "id": "17946897", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "Hi [~tranvanchuong1995], did you have more logs during repro steps ?\r\n\r\n>  Disable VPN for a couple of minutes.\r\n\r\nWhat is the ZooKeeper session timeout ? ZOOKEEPER-4508 enforced client side check to expire zookeeper session in case of unreachable of cluster to avoid endless reconnection(a.k.a. no {{Expired}} after lose connection to cluster). The timeout is {{sessionTimeout * 4 /3}}. The default max session timeout in zookeeper is 1 minute, \"a couple of minutes\" usually enough for a zookeeper session to expire.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-04-24T01:30:22.963+0000", "updated": "2025-04-24T01:30:22.963+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946903", "id": "17946903", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "{noformat}\r\n  \"stackTrace\" : \"o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 5590ms for session id 0x0\r\n{noformat}\r\n\r\nThis is the log when client decide to give up retry.\r\n1. This log comes from an unestablished zookeeper session as it prints \"session id 0x0\".\r\n2. The server is configured with a small session timeout as the default min expiration timeout in client is {{8000ms}} (it is {{4/3}} of the default min session timeout in server which is {{6000ms}}).\r\n\r\n", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-04-24T02:25:24.820+0000", "updated": "2025-04-24T02:25:24.820+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946907", "id": "17946907", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "body": "[~kezhuw] This is the full log of 3.9.3:\r\n\r\n{\r\n\"time\" : \"2025-04-23T18:51:35.611-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x100707c2dc261da for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.\",\r\n\"stackTrace\" : \"o.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 2667ms for session id 0x100707c2dc261da\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1259)\r\n\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:37.218-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Opening socket connection to server XXX/YYYY:2181.\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:37.219-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"SASL config status: Will not attempt to authenticate using SASL (unknown error)\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.355-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Client session timed out, have not heard from server in 8393ms for session id 0x100707c2dc261da\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.360-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x100707c2dc261da for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.\",\r\n\"stackTrace\" : \"o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 8393ms for session id 0x100707c2dc261da\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)\r\n\"\r\n}\r\nApr 23, 2025 6:51:41 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process\r\nINFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.588-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZkAnnouncer Mutator-EventThread\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"EventThread shut down for session: 0x100707c2dc261da\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.595-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ZooKeeper\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 watcher=com.twitter.finagle.common.zookeeper.ZooKeeperClient$3@6ecbbfdf\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.596-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxnSocket\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"jute.maxbuffer value is 1048575 Bytes\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.597-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"zookeeper.request.timeout value is 0. feature enabled=false\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.600-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Opening socket connection to server XXX/YYYY:2181.\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:41.601-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"SASL config status: Will not attempt to authenticate using SASL (unknown error)\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:45.613-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x0 for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.\",\r\n\"stackTrace\" : \"o.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 4005ms for session id 0x0\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1259)\r\n\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:46.730-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Opening socket connection to server XXX/YYYY:2181.\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:46.730-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"SASL config status: Will not attempt to authenticate using SASL (unknown error)\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:50.732-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Client session timed out, have not heard from server in 9134ms for session id 0x0\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T18:51:50.732-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x0 for server XXX/YYYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException or SessionTimeoutException.\",\r\n\"stackTrace\" : \"o.a.z.ClientCnxn$SessionTimeoutException: Client session timed out, have not heard from server in 9134ms for session id 0x0\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1253)\r\n\"\r\n}\r\nApr 23, 2025 6:51:50 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process\r\nINFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-04-24T02:33:25.769+0000", "updated": "2025-04-24T02:34:27.125+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946909", "id": "17946909", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "body": "With 3.9.2, it will retry really hard until we connect to the VPN:\r\n{\r\n\"time\" : \"2025-04-23T19:42:23.638-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x100707c2dc26281 for server XXX:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.\",\r\n\"stackTrace\" : \"j.l.IllegalArgumentException: Unable to canonicalize address XXX:2181 because it's not resolvable\r\nat o.a.z.SaslServerPrincipal.getServerPrincipal(SaslServerPrincipal.java:78)\r\nat o.a.z.SaslServerPrincipal.getServerPrincipal(SaslServerPrincipal.java:41)\r\nat o.a.z.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1142)\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1192)\r\n\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.506-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Opening socket connection to server XXX/YYY:2181.\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.507-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"SASL config status: Will not attempt to authenticate using SASL (unknown error)\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.519-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Socket connection established, initiating session, client: /10.4.9.178:61916, server: XXX/YYY:2181\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.536-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Unable to reconnect to ZooKeeper service, session 0x100707c2dc26281 has expired\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.537-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"WARN\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session 0x100707c2dc26281 for server XXX/YYY:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.\",\r\n\"stackTrace\" : \"o.a.z.ClientCnxn$SessionExpiredException: Unable to reconnect to ZooKeeper service, session 0x100707c2dc26281 has expired\r\nat o.a.z.ClientCnxn$SendThread.onConnected(ClientCnxn.java:1418)\r\nat o.a.z.ClientCnxnSocket.readConnectResult(ClientCnxnSocket.java:148)\r\nat o.a.z.ClientCnxnSocketNIO.doIO(ClientCnxnSocketNIO.java:86)\r\nat o.a.z.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:350)\r\nat o.a.z.ClientCnxn$SendThread.run(ClientCnxn.java:1274)\r\n\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.542-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-EventThread\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"EventThread shut down for session: 0x100707c2dc26281\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.543-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ZooKeeper\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 watcher=com.twitter.finagle.common.zookeeper.ZooKeeperClient$3@38b9cd1e\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.544-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxnSocket\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"jute.maxbuffer value is 1048575 Bytes\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.545-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor\",\r\n\"level\" : \"INFO\",\r\n\"message\" : \"zookeeper.request.timeout value is 0. feature enabled=false\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.546-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Opening socket connection to server XXX/YYY:2181.\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.547-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"SASL config status: Will not attempt to authenticate using SASL (unknown error)\"\r\n}\r\nApr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.ZooKeeperClient$3 process\r\nINFO: Zookeeper session expired. Event: WatchedEvent state:Expired type:None path:null zxid: -1\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.557-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Socket connection established, initiating session, client: /10.4.9.178:61917, server: XXX/YYY:2181\"\r\n}\r\n{\r\n\"time\" : \"2025-04-23T19:42:25.571-07:00\",\r\n\"logger_name\" : \"org.apache.zookeeper.ClientCnxn\",\r\n\"thread_name\" : \"ZookeeperClient-watcherProcessor-SendThread(XXX:2181)\",\r\n\"level\" : \"INFO\",\r\n\"myid\" : \"XXX:2181\",\r\n\"message\" : \"Session establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000\"\r\n}\r\nApr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.Group$ActiveMembership join\r\nINFO: Membership path is : /env-q/finagle/service/example-server/thrift/member_0000000003\r\nApr 23, 2025 7:42:25 PM com.twitter.finagle.common.zookeeper.Group$ActiveMembership join\r\nINFO: Set group member ID to member_0000000003", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-04-24T02:44:31.553+0000", "updated": "2025-04-24T02:44:31.553+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946919", "id": "17946919", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "[~tranvanchuong1995] Thank you for your sharing! You could upload log file directly to jira.\r\n\r\n3.9.3:\r\n{noformat}\r\no.a.z.ClientCnxn$ConnectionTimeoutException: Client connection timed out, have not heard from server in 2667ms for session id 0x100707c2dc261da\r\n{noformat}\r\n\r\n3.9.2:\r\n{noformat}\r\nSession 0x100707c2dc26281 for server XXX:2181, Closing socket connection. Attempting reconnect except it is a SessionExpiredException.\r\n{noformat}\r\n\r\nSessions will expired finally in your cases. In case of 3.9.3, it is *considered expired* by client, while in 3.9.2, it is *confirmed expired* by server. There is no much differences in these two cases from client's perspective except *the later will be delayed substantially if cluster is unreachable*, just like this case.\r\n\r\n{noformat}\r\nWith 3.9.2, it will retry really hard until we connect to the VPN:\r\n\r\n{\"2025-04-23T19:42:25.543-07:00\",\"Initiating client connection, connectString=XXX:2181 sessionTimeout=4000 \" }\r\n{\"2025-04-23T19:42:25.557-07:00\", \"Socket connection established, initiating session, client: /10.4.9.178:61917, server: XXX/YYY:2181\" }\r\n{\"2025-04-23T19:42:25.571-07:00\", \"Session establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000\" }\r\n{noformat}\r\n\r\nIt will retry hard(*actually endless*) to get reconnected and to know its expiration. The next client will success immediately in your case as network has been repaired.\r\n3.9.3:\r\n{noformat}\r\n2025-04-23T18:51:41.595-07:00,  Initiating client connection, connectString=XXX:2181 sessionTimeout=4000\r\n2025-04-23T18:51:41.600-07:00, Opening socket connection to server XXX/YYYY:2181\r\n2025-04-23T18:51:45.613-07:00, Client connection timed out, have not heard from server in 4005ms for session id 0x0\r\n\r\n2025-04-23T18:51:46.730-07:00, Opening socket connection to server XXX/YYYY:2181\r\n2025-04-23T18:51:50.732-07:00, Client session timed out, have not heard from server in 9134ms for session id 0x0\r\n{noformat}\r\n\r\nFrom the log, I can tell the it try twice before exhausting expiration timeout(a.k.a. 4/3 * 4000ms).\r\n\r\n3.9.2\r\n{noformat}\r\nSession establishment complete on server XXX/YYY:2181, session id = 0x100707c2dc26286, negotiated timeout = 4000\r\n{noformat}\r\n\r\nIn 3.9.2, the client will keeping retry(*actuall endless*) until a brand new session established while 3.9.3 does not. \r\n\r\n Those endless retry is what ZOOKEEPER-4508 try to fix so client can get prompt notification according to session timeout and react somehow.\r\n\r\nI think you could mimic 3.9.2 behavior by looping new session establishment so you could get a brand new session after network repaired.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-04-24T04:21:31.149+0000", "updated": "2025-04-24T04:21:31.149+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946925", "id": "17946925", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "body": "[~kezhuw] Are you saying that starting with version 3.9.3, the application is now responsible for managing session establishment itself? In our case, the Zookeeper library is embedded within the Twitter Finagle library, creating multiple layers of abstraction that make it nearly impossible for us to override this behavior.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-04-24T04:57:51.640+0000", "updated": "2025-04-24T04:57:51.640+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17946974", "id": "17946974", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "> Are you saying that starting with version 3.9.3, the application is now responsible for managing session establishment itself?\r\n\r\n{{org.apache.zookeeper.ZooKeeper}} manages a single session which tolerate network downtime within session timeout. Beyond that, applications(Finagle, Curator, etc.) have to manage themselves across sessions.\r\n\r\n> In our case, the Zookeeper library is embedded within the Twitter Finagle library, creating multiple layers of abstraction that make it nearly impossible for us to override this behavior.\r\n\r\nSeems that finagle's [ZooKeeperClient.get|https://github.com/twitter/finagle/blob/develop/finagle-serversets/src/main/java/com/twitter/finagle/common/zookeeper/ZooKeeperClient.java#L357] relies on the endless retrying during estalishing a brand new session. We could fix it there.\r\n\r\nAlternative, we could provide a option for zookeeper to loop until a customized timeout in new session establishment. I think it might be a common pattern to get {{Expired}} and then loop until connected.", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-04-24T08:14:07.820+0000", "updated": "2025-04-24T08:14:07.820+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17947070", "id": "17947070", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "> Alternative, we could provide a option for zookeeper to loop until a customized timeout in new session establishment. I think it might be a common pattern to get {{Expired}} and then loop until connected.\r\n\r\nI sent a dev mail to discuss this. https://lists.apache.org/thread/nfb9z7rhgglbjzfxvg4z2m3pks53b3c1", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-04-24T15:10:57.236+0000", "updated": "2025-04-24T15:10:57.236+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17947080", "id": "17947080", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "body": "[~kezhuw] this dev mail discussion looks really good. I am looking forward to hearing about the final decision. Thank you!", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=tranvanchuong1995", "name": "tranvanchuong1995", "key": "JIRAUSER309503", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"}, "displayName": "Chuong Tran", "active": true, "timeZone": "Etc/UTC"}, "created": "2025-04-24T16:10:39.570+0000", "updated": "2025-04-24T16:10:39.570+0000"}, {"self": "https://issues.apache.org/jira/rest/api/2/issue/13616163/comment/17950741", "id": "17950741", "author": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "body": "Issue resolved by pull request 2252\n[https://github.com/apache/zookeeper/pull/2252]", "updateAuthor": {"self": "https://issues.apache.org/jira/rest/api/2/user?username=kezhuw", "name": "kezhuw", "key": "kezhuw", "avatarUrls": {"48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kezhuw&avatarId=37929", "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kezhuw&avatarId=37929", "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kezhuw&avatarId=37929", "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kezhuw&avatarId=37929"}, "displayName": "Kezhu Wang", "active": true, "timeZone": "Etc/GMT-8"}, "created": "2025-05-11T02:20:55.063+0000", "updated": "2025-05-11T02:20:55.063+0000"}], "maxResults": 12, "total": 12, "startAt": 0}, "customfield_12311820": "0|z1vimo:", "customfield_12314139": null}}